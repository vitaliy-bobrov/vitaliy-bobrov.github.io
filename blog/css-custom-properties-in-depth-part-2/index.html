<!DOCTYPE html><html lang="en"><head>
    <title>CSS Custom Properties in Depth: Part 2 | Bobrov Dev</title>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Houdini " custom properties and values" spec gives us the strictly typed css variables. it has a significant potential as new technology is pretty unknown field. today, i'm going to have in-depth overview of what types available in first version spec, show usage on real examples.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="alternate" href="https://bobrov.dev/blog/css-custom-properties-in-depth-part-2/" hreflang="en">
    <link rel="canonical" href="https://bobrov.dev/blog/css-custom-properties-in-depth-part-2/">
    
    <!-- Disable tap highlight on IE -->
    <meta name="msapplication-tap-highlight" content="no">
    
    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Bobrov Dev">
    
    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Bobrov Dev">
    
    <!-- Tile icon for Win8 -->
    <meta name="msapplication-TileColor" content="#008ba3">
    
    <link rel="apple-touch-icon" sizes="180x180" href="/images/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="/images/icons/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/images/icons/favicon-16x16.png" sizes="16x16">
    
    <!-- Color the status bar on mobile devices -->
    <meta name="theme-color" content="#008ba3">
    
    <link rel="manifest" href="/manifest.json">
    
    <meta name="google-site-verification" content="-49tfdke4pxwhrBhLHu5VHTk-bb7g9jK_xQuD5Elq2Y">
    
    <!-- Preloads -->
    <link rel="preload" as="script" href="https://www.googletagmanager.com/gtag/js?id=UA-90372372-1">
    
    <!-- Styles -->
    <link rel="stylesheet" href="/css/styles.css">

    <meta property="fb:app_id" content="393821434298248">
    <meta property="article:author" content="https://www.facebook.com/bobrov1989">
    <meta property="og:url" content="https://bobrov.dev/blog/css-custom-properties-in-depth-part-2/">
    <meta property="og:type" content="article">
    <meta property="og:title" content="CSS Custom Properties in Depth: Part 2">
    <meta property="og:description" content="Houdini " custom properties and values" spec gives us the strictly typed css variables. it has a significant potential as new technology is pretty unknown field. today, i'm going to have in-depth overview of what types available in first version spec, show usage on real examples.">
    <meta property="og:image" content="https://bobrov.dev/images/posts/css-custom-properties-in-depth-2/css-custom-properties-in-depth-2-og.jpg">
    <meta property="og:image:url" content="https://bobrov.dev/images/posts/css-custom-properties-in-depth-2/css-custom-properties-in-depth-2-og.jpg">
    <meta property="og:image:type" content="image/jpeg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <script type="application/ld+json">
      {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "mainEntityOfPage": "True",
        "headline": "CSS Custom Properties in Depth: Part 2",
        "image": [
          "https://bobrov.dev/images/posts/css-custom-properties-in-depth-2/css-custom-properties-in-depth-2-og.jpg"
        ],
        "datePublished": "2018-07-16153169920000002:00:00+02",
        "dateModified": "2018-07-16153169920000002:00:00+02",
        "author": {
          "@type": "Person",
          "name": "Vitalii Bobrov"
        },
        "publisher": {
          "@type": "Organization",
          "name": "Bobrov Dev",
          "logo": {
            "@type": "ImageObject",
            "url": "https://bobrov.dev/images/logo.png",
            "width": "96",
            "height": "96"
          }
        },
        "description": "Houdini &quot;Custom Properties and Values&quot; spec gives us the strictly typed CSS variables. It has a significant potential and as new technology is a pretty unknown field. Today, I&#x27;m going to have the in-depth overview of what types available in the first version of the spec, and show the usage on real examples."
      }
    </script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-90372372-1"></script>
    <script>
      if (navigator.doNotTrack !== '1') {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-90372372-1');
      }
    </script>
    
  <meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@bobrov1989"><meta name="twitter:title" content="CSS Custom Properties in Depth: Part 2"><meta name="twitter:description" content="Houdini "Custom Properties and Values" spec gives us the strictly typed CSS variables. It has a significant potential and as new technology is a pretty unknown field. Today, I'm going to have the in-depth overview of what types available in the first version of the spec, and show the usage on real examples."><meta name="twitter:image" content="https://bobrov.dev/images/posts/css-custom-properties-in-depth-2/css-custom-properties-in-depth-2-og.jpg"><meta name="twitter:image:alt" content="CSS Custom Properties in Depth: Part 2"></head>
  <body class="mdlext-dark-color-theme mdl-layout__container">
    <div class="mdl-layout mdl-layout--no-desktop-drawer-button mdl-layout--fixed-header mdl-js-layout">
      <!-- Header -->
      <header class="mdl-layout__header is-casting-shadow" role="banner">
        <div class="mdl-layout__drawer-button" role="button" tabindex="0" aria-expanded="false">
          <svg class="mdl-svg drawer-icon">
            <use href="/images/sprite.svg#menu"/>
          </svg>
          Menu
        </div>
        <div class="mdl-layout__header-row">
          <!-- Title -->
          <span class="mdl-layout-title">
            <a class="site-link" href="https://bobrov.dev/" rel="nofollow">Bobrov Dev</a>
          </span>
      
          <div class="mdl-layout-spacer">
            <a href="https://bobrov.dev/" class="site-logo" title="Bobrov Dev" rel="nofollow">
              <picture class="site-logo__picture">
                <source media="(min-width: 1025px)" srcset="/images/logo.webp 1x, /images/logo@2x.webp 2x" type="image/webp">
                <source media="(min-width: 1025px)" srcset="/images/logo.png 1x, /images/logo@2x.png 2x">
                <source media="(min-width: 768px)" srcset="/images/logo-tablet.webp 1x, /images/logo-tablet@2x.webp 2x" type="image/webp">
                <source media="(min-width: 768px)" srcset="/images/logo-tablet.png 1x, /images/logo-tablet@2x.png 2x">
                <source srcset="/images/logo-mobile.webp 1x, /images/logo-mobile@2x.webp 2x" type="image/webp">
                <source srcset="/images/logo-mobile.png 1x, /images/logo-mobile@2x.png 2x">
                <img src="/images/logo.png" alt="Bobrov Dev Logo" loading="eager" class="site-logo__img">
              </picture>
            </a>
          </div>
      
          <!-- Navigation. We hide it in small screens. -->
          <nav class="mdl-navigation mdl-layout--large-screen-only" aria-label="Main navigation">
            <a class="mdl-navigation__link mdl-navigation__link_active" href="https://bobrov.dev/" rel="nofollow">Blog</a>
      
              <a class="mdl-navigation__link " href="https://bobrov.dev/speaker/">Speaker
              </a>
              <a class="mdl-navigation__link " href="https://bobrov.dev/about/">About
              </a>
          </nav>
        </div>
      </header>
      <div class="mdl-layout__drawer">
        <span class="mdl-layout-title">Bobrov Dev</span>
        <nav class="mdl-navigation" aria-label="Main navigation">
          <a class="mdl-navigation__link mdl-navigation__link_active" href="https://bobrov.dev/" rel="nofollow" aria-current="page">Blog</a>
      
            <a class="mdl-navigation__link " href="https://bobrov.dev/speaker/">Speaker
            </a>
            <a class="mdl-navigation__link " href="https://bobrov.dev/about/">About
            </a>
      
          <button class="mdl-button mdl-button--raised js-add-to-home" disabled>
            Add to home screen
          </button>
        </nav>
      </div>

      <!-- Content -->
      <div class="mdl-layout__content js-lazy-container">
        <main class="mdl-grid posts-grid">
          <article class="mdl-card mdl-shadow--3dp mdl-cell post mdl-cell--12-col">
            <header class="mdl-card__media post__media">
                
    <picture class="safe-picture ">
      <source media="(min-width: 1025px)" srcset="/images/posts/css-custom-properties-in-depth-2/css-custom-properties-in-depth-2.webp 1x, /images/posts/css-custom-properties-in-depth-2/css-custom-properties-in-depth-2@2x.webp 2x" type="image/webp">
      <source media="(min-width: 1025px)" srcset="/images/posts/css-custom-properties-in-depth-2/css-custom-properties-in-depth-2.jpg 1x, /images/posts/css-custom-properties-in-depth-2/css-custom-properties-in-depth-2@2x.jpg 2x">
      <source media="(min-width: 768px)" srcset="/images/posts/css-custom-properties-in-depth-2/css-custom-properties-in-depth-2-tablet.webp 1x, /images/posts/css-custom-properties-in-depth-2/css-custom-properties-in-depth-2-tablet@2x.webp 2x" type="image/webp">
      <source media="(min-width: 768px)" srcset="/images/posts/css-custom-properties-in-depth-2/css-custom-properties-in-depth-2-tablet.jpg 1x, /images/posts/css-custom-properties-in-depth-2/css-custom-properties-in-depth-2-tablet@2x.jpg 2x">
      <source srcset="/images/posts/css-custom-properties-in-depth-2/css-custom-properties-in-depth-2-mobile.webp 1x, /images/posts/css-custom-properties-in-depth-2/css-custom-properties-in-depth-2-mobile@2x.webp 2x" type="image/webp">
      <source srcset="/images/posts/css-custom-properties-in-depth-2/css-custom-properties-in-depth-2-mobile.jpg 1x, /images/posts/css-custom-properties-in-depth-2/css-custom-properties-in-depth-2-mobile@2x.jpg 2x">
      <img src="/images/posts/css-custom-properties-in-depth-2/css-custom-properties-in-depth-2.jpg" loading="eager" alt="CSS Custom Properties in Depth: Part 2" class="safe-picture__img">
    </picture>

                <div class="safe-gradient"></div>

                <h1 class="post__title">
                  CSS Custom Properties in Depth: Part 2
                </h1>
              </header>

              <section class="post__info post-info">
                <div class="post-info__data">
                  <picture class="post-info__avatar">
                    <source srcset="/images/authors/bobrov/avatar.webp 1x, /images/authors/bobrov/avatar@2x.webp 2x" type="image/webp">
                    <source srcset="/images/authors/bobrov/avatar.jpg 1x, /images/authors/bobrov/avatar@2x.jpg 2x">
                    <img src="/images/authors/bobrov/avatar.jpg" loading="lazy" alt="Vitalii Bobrov Photo" class="mdl-list__item-avatar">
                  </picture>

                  <div class="post-info__data-wrapper">
                    <div class="post-info__author">
                      Vitalii Bobrov
                    </div>

                    <time datetime="2018-07-16" class="post-info__date">
                      16 July 2018
                    </time>
                  </div>
                </div>

                <div class="post-info__side">
                  <div class="post-info__categories">
                      <a href="/category/css" class="mdl-chip post-info__category">
                          <span class="mdl-chip__text">CSS</span>
                      </a>
                      <a href="/category/houdini" class="mdl-chip post-info__category">
                          <span class="mdl-chip__text">Houdini</span>
                      </a>
                  </div>
                </div>
              </section>

              
    <div class="mdl-card__menu post-share">
      <button id="share-menu-0" class="mdl-button mdl-button--icon ripple post-share__button js-share-btn" title="Share this post" aria-label="Share this post" data-share-title="CSS Custom Properties in Depth: Part 2" data-share-text="CSS Custom Properties in Depth: Part 2 by @bobrov1989" data-share-url="https://bobrov.dev/blog/css-custom-properties-in-depth-part-2/">
        <span class="ripple-ink"></span>
        <svg class="mdl-svg post-share__icon">
          <use href="/images/sprite.svg#share"/>
        </svg>
        Share post
      </button>
      <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu share-menu js-share-menu">
        <li class="mdl-menu__item share-menu__item">
          <a href="https://www.facebook.com/sharer.php?u=https://bobrov.dev/blog/css-custom-properties-in-depth-part-2/" class="share-menu__link" target="_blank" rel="nofollow noreferrer noopener">
            <svg class="share-menu__icon">
              <use href="/images/sprite.svg#facebook"/>
            </svg>
            Facebook
          </a>
        </li>
        <li class="mdl-menu__item share-menu__item">
          <a href="https://twitter.com/home?status=https://bobrov.dev/blog/css-custom-properties-in-depth-part-2/" class="share-menu__link" target="_blank" rel="nofollow noreferrer noopener">
            <svg class="share-menu__icon">
              <use href="/images/sprite.svg#twitter"/>
            </svg>
            Twitter
          </a>
        </li>
        <li class="mdl-menu__item share-menu__item">
          <a href="https://linkedin.com/shareArticle?url=https://bobrov.dev/blog/css-custom-properties-in-depth-part-2/" class="share-menu__link" target="_blank" rel="nofollow noreferrer noopener">
            <svg class="share-menu__icon">
              <use href="/images/sprite.svg#linkedin"/>
            </svg>
            LinkedIn
          </a>
        </li>
      </ul>
    </div>

              <section class="post__contents">
                <p>Houdini “Custom Properties and Values” spec gives us the strictly typed CSS variables. It has a significant potential and as new technology is a pretty unknown field. Today, I’m going to have the in-depth overview of what types available in the first version of the spec, and show the usage on real examples.</p>
<p class="post__series">The topic split into two parts. Now you are reading the second one. You can check out the first part <a href="https://bobrov.dev/blog/css-custom-properties-in-depth/">here</a>.</p>
<h2>Available types</h2>
<p>As I have written in the previous part, not all of the types are available for custom properties. In the initial specification, we have the only limited set of them. Let me introduce each of the possible types.</p>
<h3><strong>Note:</strong></h3>
<p><em>Work with <code>registerProperty</code> requires you to enable “Experimental Web Platform features”</em> – <code>chrome://flags/#enable-experimental-web-platform-features</code> <em>to try it in Chrome.</em></p>
<h3>length</h3>
<p>Length type stands for CSS sizing values, like pixel, em, rem, vw, vh, etc. We can declare a custom property that expects that type with JavaScript:</p>
<pre class="language-js"><code class="language-js"><span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">registerProperty</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'--size'</span><span class="token punctuation">,</span>
  syntax<span class="token punctuation">:</span> <span class="token string">'<length>'</length></span><span class="token punctuation">,</span>
  inherits<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  initialValue<span class="token punctuation">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>If the assigned property value is invalid, the initial one is used.</p>
<pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.block</span> </span><span class="token punctuation">{</span>
  <span class="token property">--size</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--size<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* computed value 0px. */</span>
  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--size<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* computed value 0px. */</span>
<span class="token punctuation">}</span>
</code></pre>
<p>To make value valid we need to add units:</p>
<pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.block</span> </span><span class="token punctuation">{</span>
  <span class="token property">--size</span><span class="token punctuation">:</span> <span class="token number">20</span>px<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--size<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Unfortunately, we can’t use CSS variables in functions like <code>calc</code> as is. They work as just strings, and example below won’t work as expected:</p>
<pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.block</span> </span><span class="token punctuation">{</span>
  <span class="token property">--size-variable</span><span class="token punctuation">:</span> <span class="token number">20</span>px<span class="token punctuation">;</span> <span class="token comment">/* Not registered as <length>. */</length></span>
  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token number">50</span>vw - <span class="token function">var</span><span class="token punctuation">(</span>--size-variable<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--size-variable<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>However, with the custom property it works like a charm:</p>
<pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.block</span> </span><span class="token punctuation">{</span>
  <span class="token property">--size</span><span class="token punctuation">:</span> <span class="token number">20</span>px<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token number">50</span>vw - <span class="token function">var</span><span class="token punctuation">(</span>--size<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* 50vw - 20px. */</span>
  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Examples above look pretty similar to the usage of the variables in SASS. However, you should remember that in SASS variables are static and replaced at compile time.</p>
<pre class="language-scss"><code class="language-scss"><span class="token selector">.block </span><span class="token punctuation">{</span>
  <span class="token property"><span class="token variable">$size</span></span><span class="token punctuation">:</span> <span class="token number">20</span>px<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token variable">$size</span><span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token variable">$size</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>But we can access and dynamicaly change custom properties with few lines of JS:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.block'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> styleMap <span class="token operator">=</span> el<span class="token punctuation">.</span><span class="token function">computedStyleMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> computedProp <span class="token operator">=</span> styleMap<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'--size'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>computedProp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// CSSUnitValue {value: 20, unit: "px"}</span>

el<span class="token punctuation">.</span>style<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">'--size'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">CSSUnitValue</span><span class="token punctuation">(</span>computedProp<span class="token punctuation">.</span>value<span class="token punctuation">,</span> <span class="token string">'em'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> propValue <span class="token operator">=</span> el<span class="token punctuation">.</span>style<span class="token punctuation">.</span><span class="token function">getPropertyValue</span><span class="token punctuation">(</span><span class="token string">'--size'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>propValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// "20em"</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>CSSUnitValue<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>propValue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// CSSUnitValue {value: 20, unit: "em"}</span>

<span class="token keyword">const</span> attributeProp <span class="token operator">=</span> el<span class="token punctuation">.</span>attributeStyleMap<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'--size'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>attributeProp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// CSSUnparsedValue {0: "20em", length: 1}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>CSSUnitValue<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>attributeProp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// CSSUnitValue {value: 20, unit: "em"}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span><span class="token function">computedStyleMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'--size'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// CSSUnitValue {value: 288, unit: "px"}</span>
</code></pre>
<p>What is going on? We are using <code>computedStyleMap</code> method on DOM node to get resolved custom property. To assign new value we use <code>style.setProperty</code>, that creates property declaration inline. Then we use <code>style.getPropertyValue</code> that returns the string representation. As now we have the property declared in style attribute we can use <code>attributeStyleMap</code> that returns unparsed value. Both <code>computedStyleMap</code> and <code>attributeStyleMap</code> are properties sets, but <code>computedStyleMap</code> is read-only. Resolved length property always return the pixels value.</p>
<p>Manipulations with CSS units, like parsing, converting or creating values are part of CSS Typed OM specification. It is a separate colossal topic to speak about. You can get an overview from <a href="https://developers.google.com/web/updates/2018/03/cssom" target="_blank" rel="nofollow noreferrer noopener">this article</a>.</p>
<h3>percentage</h3>
<p>Usually working with responsive web design (RWD) we are trying to avoid pixel dependent units. Instead of them, we prefer relative ones, like percentages. Luckily we can declare percentage syntax for custom properties.</p>
<pre class="language-js"><code class="language-js"><span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">registerProperty</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'--lightness'</span><span class="token punctuation">,</span>
  syntax<span class="token punctuation">:</span> <span class="token string">'<percentage>'</percentage></span><span class="token punctuation">,</span>
  inherits<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  initialValue<span class="token punctuation">:</span> <span class="token string">'0%'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Please note that for unit values, like length or percentage you are not allowed to use zero value without units. It might be confusing because CSS allows you to do so. Even more it is kind of a good practice to use zero without units, because <code>0px === 0em === 0%</code>. That is why in the <code>--lightness</code> property defines the initial value specified as <code>0%</code> not just <code>0</code>.</p>
<p>One of the great examples where custom properties shine – the control of the part of a CSS declaration. Let me show it:</p>
<pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.link</span> </span><span class="token punctuation">{</span>
  <span class="token property">--lightness</span><span class="token punctuation">:</span> <span class="token number">50%</span><span class="token punctuation">;</span>
  <span class="token property">--saturation</span><span class="token punctuation">:</span> <span class="token number">50%</span><span class="token punctuation">;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">hsl</span><span class="token punctuation">(</span><span class="token number">0</span>, <span class="token function">var</span><span class="token punctuation">(</span>--saturation<span class="token punctuation">)</span>, <span class="token function">var</span><span class="token punctuation">(</span>--lightness<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector"><span class="token class">.link</span><span class="token pseudo-class">:focus</span> </span><span class="token punctuation">{</span>
  <span class="token property">--lightness</span><span class="token punctuation">:</span> <span class="token number">80%</span><span class="token punctuation">;</span>
  <span class="token property">--saturation</span><span class="token punctuation">:</span> <span class="token number">20%</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>In the example above we have separate control under different HSL color components – lightness and saturation. Let’s try to access them in JavaScript:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.link'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> styleMap <span class="token operator">=</span> el<span class="token punctuation">.</span><span class="token function">computedStyleMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>styleMap<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'--lightness'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// CSSUnitValue {value: 50, unit: "percent"}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>styleMap<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'--saturation'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// CSSUnitValue {value: 50, unit: "percent"}</span>
</code></pre>
<p>So we can get resolved property value, and it returns a beautiful object with the unit property set as a percent and numeric value. It is pretty cool to have such an object in JS instead operating with strings. For example in animation implementation.</p>
<h3>length-percentage</h3>
<p>As you might notice from its name, <code>length-percentage</code> is a kind of type alias for CSS length and percentage values. Here is the registration example:</p>
<pre class="language-js"><code class="language-js"><span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">registerProperty</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'--relative-size'</span><span class="token punctuation">,</span>
  syntax<span class="token punctuation">:</span> <span class="token string">'<length-percentage>'</length-percentage></span><span class="token punctuation">,</span>
  inherits<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  initialValue<span class="token punctuation">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Let’s try to reproduce the same type differently:</p>
<pre class="language-js"><code class="language-js"><span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">registerProperty</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'--relative-size'</span><span class="token punctuation">,</span>
  syntax<span class="token punctuation">:</span> <span class="token string">'<length> | <percentage>'</percentage></length></span><span class="token punctuation">,</span>
  inherits<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  initialValue<span class="token punctuation">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Both of our custom properties declarations are equivalent. Now we could use it in styles:</p>
<pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.zero</span> </span><span class="token punctuation">{</span>
  <span class="token property">--relative-size</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--relative-size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector"><span class="token class">.percent</span> </span><span class="token punctuation">{</span>
  <span class="token property">--relative-size</span><span class="token punctuation">:</span> <span class="token number">50%</span><span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--relative-size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector"><span class="token class">.length</span> </span><span class="token punctuation">{</span>
  <span class="token property">--relative-size</span><span class="token punctuation">:</span> <span class="token number">50</span>vw<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--relative-size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Now, lets try to access the value from JavaScript:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> zeroEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.zero'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> zeroStyleMap <span class="token operator">=</span> zeroEl<span class="token punctuation">.</span><span class="token function">computedStyleMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>zeroStyleMap<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'--relative-size'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// CSSUnitValue {value: 0, unit: "px"}</span>

<span class="token keyword">const</span> percentEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.percent'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> percentStyleMap <span class="token operator">=</span> percentEl<span class="token punctuation">.</span><span class="token function">computedStyleMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>percentStyleMap<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'--relative-size'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// CSSUnitValue {value: 50, unit: "percent"}</span>

<span class="token keyword">const</span> lengthEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.length'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> lengthStyleMap <span class="token operator">=</span> lengthEl<span class="token punctuation">.</span><span class="token function">computedStyleMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>lengthStyleMap<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'--relative-size'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// CSSUnitValue {value: 672, unit: "px"}</span>
</code></pre>
<p>As you can see, we got all non-percent values in pixels. The more interesting thing with length-percentage syntax is that it accepts expressions as a value:</p>
<pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.calculated</span> </span><span class="token punctuation">{</span>
  <span class="token property">--relative-size</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token number">100</span>vw - <span class="token number">20</span>px<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--relative-size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Such expressions resolved differently according to the context they used it. In particular example above <code>calc</code>, each operand will be converted to pixels and then evaluated. Such convert happened cause we used our property as the value for <code>width</code>. But it will use it as a value for <code>hsl</code> saturation component which accepts the only percentage we can use only percentages inside <code>calc</code> expression.</p>
<h3>integer</h3>
<p>Integer type is represents numeric values without a fractional component. Let’s declare property using that type:</p>
<pre class="language-js"><code class="language-js"><span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">registerProperty</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'--sides'</span><span class="token punctuation">,</span>
  syntax<span class="token punctuation">:</span> <span class="token string">'<integer>'</integer></span><span class="token punctuation">,</span>
  inherits<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  initialValue<span class="token punctuation">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>If we try to assign float as an initial value, registration will fail with the error:</p>
<pre class="language-js"><code class="language-js"><span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">registerProperty</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'--sides'</span><span class="token punctuation">,</span>
  syntax<span class="token punctuation">:</span> <span class="token string">'<integer>'</integer></span><span class="token punctuation">,</span>
  inherits<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  initialValue<span class="token punctuation">:</span> <span class="token number">0.1</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Uncaught DOMException: Failed to execute 'registerProperty' on 'CSS':</span>
<span class="token comment">// The initial value provided does not parse for the given syntax.</span>
</code></pre>
<p>There is no way to set the range of possible values for interger property for now, but hopefully it will come in the next specification versions. Here is how we can access value in JS:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.zero'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> styleMap <span class="token operator">=</span> zeroEl<span class="token punctuation">.</span><span class="token function">computedStyleMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>styleMap<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'--sides'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// CSSUnitValue {value: 0, unit: "number"}</span>
</code></pre>
<p>As you can see even when we give property type of integer, Typed OM returns us type number.</p>
<h3>number</h3>
<p>As you can guess number type is similar to integer one but allows to set float values as well:</p>
<pre class="language-js"><code class="language-js"><span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">registerProperty</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'--progress'</span><span class="token punctuation">,</span>
  syntax<span class="token punctuation">:</span> <span class="token string">'<number>'</number></span><span class="token punctuation">,</span>
  inherits<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  initialValue<span class="token punctuation">:</span> <span class="token number">0.5</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Nothing extraordinary here, it works the same way as integer type.</p>
<h3>color</h3>
<p>Color – most used type in CSS, it makes the Web brighter.</p>
<pre class="language-js"><code class="language-js"><span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">registerProperty</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'--fill'</span><span class="token punctuation">,</span>
  syntax<span class="token punctuation">:</span> <span class="token string">'<color>'</color></span><span class="token punctuation">,</span>
  inherits<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  initialValue<span class="token punctuation">:</span> <span class="token string">'transparent'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>You can use any color values that available in CSS: HEX, RGBA, RGBA, HSL, etc. With typed custom property the browser will recognise that variable is not just a string but color value. So it will know how to interpolate value for transitions and animations.</p>
<h3>image</h3>
<p>Image syntax is the most intriguing one, as it opens the door to do crazy stuff with images. The canvas implementation for CSS Paint API doesn’t support methods to read pixels from the element for security reasons. I don’t think anybody wants 3rd party stylesheet could read his sensitive data. So the only way to draw images inside custom paint is to use image passed as input property or argument. Below is the registration of the image custom property:</p>
<pre class="language-js"><code class="language-js"><span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">registerProperty</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'--image'</span><span class="token punctuation">,</span>
  syntax<span class="token punctuation">:</span> <span class="token string">'<img>'</span><span class="token punctuation">,</span>
  inherits<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  initialValue<span class="token punctuation">:</span> <span class="token string">'url()'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Let’s try to set and use our <code>--image</code> property with CSS Paint API:</p>
<pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.placeholder</span> </span><span class="token punctuation">{</span>
  <span class="token property">--image</span><span class="token punctuation">:</span> <span class="token url">url('/some/image/url.png')</span><span class="token punctuation">;</span>
  <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">paint</span><span class="token punctuation">(</span>image-placeholder<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class="language-js"><code class="language-js"><span class="token constant">CSS</span><span class="token punctuation">.</span>paintWorklet<span class="token punctuation">.</span><span class="token function">addModule</span><span class="token punctuation">(</span><span class="token string">'image-placeholder.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Now I’m going to implement <code>image-placeholder</code> painter:</p>
<pre class="language-js"><code class="language-js"><span class="token comment">// image-placeholder.js</span>

<span class="token keyword">class</span> <span class="token class-name">ImagePlaceholder</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token keyword">get</span> <span class="token function">inputProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">'--image'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

   <span class="token function">paint</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token punctuation">{</span>width<span class="token punctuation">,</span> height<span class="token punctuation">}</span><span class="token punctuation">,</span> props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> img <span class="token operator">=</span> props<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'--image'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> radius <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>

    <span class="token keyword">switch</span> <span class="token punctuation">(</span>img<span class="token punctuation">.</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">'ready'</span><span class="token punctuation">:</span>
        <span class="token comment">// The image is loaded! Draw the image.</span>
        ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> geom<span class="token punctuation">.</span>width<span class="token punctuation">,</span> geom<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>

      <span class="token keyword">case</span> <span class="token string">'pending'</span><span class="token punctuation">:</span>
        <span class="token comment">// The image is loading, draw placeholder.</span>
        ctx<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span><span class="token function">strokeRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>

        ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>

      <span class="token keyword">case</span> <span class="token string">'invalid'</span><span class="token punctuation">:</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span>
        <span class="token comment">// The image is invalid (e.g. it didn’t load), draw circle.</span>
        ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'red'</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span>radius<span class="token punctuation">,</span> radius<span class="token punctuation">,</span> radius<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">registerPaint</span><span class="token punctuation">(</span><span class="token string">'image-placeholder'</span><span class="token punctuation">,</span> ImagePlaceholder<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>The image property syntax still not implemented, but according to the spec we <code>paint</code> is called on image loading stages. So we have access to the <code>state</code> of an image. The state could have few values: ready, pending and invalid. The names of states are speaking itself.</p>
<p>In our example, we are relying on an image state. If the image still loading (its state pending), we draw placeholder. If it is ready, we draw the image. Moreover, red circle on errors – invalid state.</p>
<p>Hopefully, implementation will arrive in the browsers this year. Image custom properties will open immense horizons.</p>
<h3>url</h3>
<p>URL type is similar to the image, with one difference it is not restricted to media MIME types. This type still in development as well, below is an example registration:</p>
<pre class="language-js"><code class="language-js"><span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">registerProperty</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'--file'</span><span class="token punctuation">,</span>
  syntax<span class="token punctuation">:</span> <span class="token string">'<url> | none'</url></span><span class="token punctuation">,</span>
  inherits<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  initialValue<span class="token punctuation">:</span> <span class="token string">'none'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Theoretically, it will allow requesting any files to use in other Houdini APIs. My first thought was to use it for JSON files fetching. Imagine we have bar chart custom painter and we can request dataset in JSON format for it. Sounds awesome? Can’t wait for the working implementation.</p>
<h3>angle</h3>
<p>Angles are rarely used in CSS, usually in special properties, like transforms. However, in combination with CSS Paint API, it gives strictly typed and values to use with 2D canvas context. In CSS we have few valid angle units: degrees, radians, gradians and turns (<code>deg</code>, <code>rad</code>, <code>grad</code>, <code>turn</code>). All of them could use as a value for angle syntax. Below is the example:</p>
<pre class="language-js"><code class="language-js"><span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">registerProperty</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'--angle'</span><span class="token punctuation">,</span>
  syntax<span class="token punctuation">:</span> <span class="token string">'<angle>'</angle></span><span class="token punctuation">,</span>
  inherits<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  initialValue<span class="token punctuation">:</span> <span class="token string">'0deg'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3>time</h3>
<p>Time usually used with transitions and animations. It accepts seconds and milliseconds (<code>s</code> and <code>ms</code> respectively). Use case: we can use time custom property for animation duration control. Here is the example how to register property:</p>
<pre class="language-js"><code class="language-js"><span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">registerProperty</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'--duration'</span><span class="token punctuation">,</span>
  syntax<span class="token punctuation">:</span> <span class="token string">'<time>'</time></span><span class="token punctuation">,</span>
  inherits<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  initialValue<span class="token punctuation">:</span> <span class="token string">'0s'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3>resolution</h3>
<p>CSS resolution has few possible unit values: dots per inch, dots per centimeter and dots per pixel unit. In CSS they look like: <code>dpi</code>, <code>dpcm</code> and <code>dppx</code> respectively. The possible use case is adjusting canvas resolution to a user device screen. You can register such property this way:</p>
<pre class="language-js"><code class="language-js"><span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">registerProperty</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'--resolution'</span><span class="token punctuation">,</span>
  syntax<span class="token punctuation">:</span> <span class="token string">'<resolution>'</resolution></span><span class="token punctuation">,</span>
  inherits<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  initialValue<span class="token punctuation">:</span> <span class="token string">'1dppx'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3>transform-function</h3>
<p>Transform function is a single tranformation CSS declaration like <code>translate</code>, <code>rotate</code> or <code>scale</code>. It is building block for transform declaration. We can combine few custom propertis to get resulting transform. Below is an example:</p>
<pre class="language-js"><code class="language-js"><span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">registerProperty</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'--transform-rotation'</span><span class="token punctuation">,</span>
  syntax<span class="token punctuation">:</span> <span class="token string">'<transform-function>'</transform-function></span><span class="token punctuation">,</span>
  inherits<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  initialValue<span class="token punctuation">:</span> <span class="token string">'rotate(0deg)'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">registerProperty</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'--transform-scale'</span><span class="token punctuation">,</span>
  syntax<span class="token punctuation">:</span> <span class="token string">'<transform-function>'</transform-function></span><span class="token punctuation">,</span>
  inherits<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  initialValue<span class="token punctuation">:</span> <span class="token string">'scale(1)'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>And composition of custom properties in CSS:</p>
<pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.transformed-element</span> </span><span class="token punctuation">{</span>
  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--transform-rotation<span class="token punctuation">)</span> <span class="token function">var</span><span class="token punctuation">(</span>--transform-scale<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">animation</span><span class="token punctuation">:</span> trans <span class="token number">1</span>s<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token atrule"><span class="token rule">@keyframes</span> trans</span> <span class="token punctuation">{</span>
  <span class="token selector">0% </span><span class="token punctuation">{</span>
    <span class="token property">--transform-rotation</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token number">0</span>deg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token property">--transform-scale</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token selector">40% </span><span class="token punctuation">{</span>
    <span class="token property">--transform-rotation</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token number">45</span>deg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token selector">60% </span><span class="token punctuation">{</span>
    <span class="token property">--transform-scale</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">1.2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token selector">80% </span><span class="token punctuation">{</span>
    <span class="token property">--transform-rotation</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token number">90</span>deg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token property">--transform-scale</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">1.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token selector">100% </span><span class="token punctuation">{</span>
    <span class="token property">--transform-rotation</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token number">0</span>deg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token property">--transform-scale</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>In the example we are manipulating different transform functions separately.</p>
<h3>transform-list</h3>
<p>Transform list is just stands for the list of <code>transform-function</code>s separated by space. Below the example:</p>
<pre class="language-js"><code class="language-js"><span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">registerProperty</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'--transformations'</span><span class="token punctuation">,</span>
  syntax<span class="token punctuation">:</span> <span class="token string">'<transform-list>'</transform-list></span><span class="token punctuation">,</span>
  inherits<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  initialValue<span class="token punctuation">:</span> <span class="token string">'rotate(90deg) translateX(5rem)'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>We can achieve the same resulting property registration using another syntax:</p>
<pre class="language-js"><code class="language-js"><span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">registerProperty</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'--transformations'</span><span class="token punctuation">,</span>
  syntax<span class="token punctuation">:</span> <span class="token string">'<transform-function>+'</transform-function></span><span class="token punctuation">,</span>
  inherits<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  initialValue<span class="token punctuation">:</span> <span class="token string">'rotate(90deg) translateX(5rem)'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3>custom-ident</h3>
<p>Custom indent is a special type that gives us the ability to use own keywords as a value of a custom property. This custom value will be validated by the CSS engine for us. Here is the registration example:</p>
<pre class="language-js"><code class="language-js"><span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">registerProperty</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'--keyword'</span><span class="token punctuation">,</span>
  syntax<span class="token punctuation">:</span> <span class="token string">'left-side | right-side'</span><span class="token punctuation">,</span>
  inherits<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  initialValue<span class="token punctuation">:</span> <span class="token string">'left-side'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>You should remember that <code>custom-indent</code> is case sensitive. That means that <code>left-side</code> value is not equal to <code>LEFT-SIDE</code> value, and will be invalidated.</p>
<pre class="language-js"><code class="language-js"><span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">registerProperty</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'--keyword'</span><span class="token punctuation">,</span>
  syntax<span class="token punctuation">:</span> <span class="token string">'left-side | right-side'</span><span class="token punctuation">,</span>
  inherits<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  initialValue<span class="token punctuation">:</span> <span class="token string">'LEFT-SIDE'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>CSS allows us to use property values in any case we want. It is a good practice to write styles in lowercase, but browser won’t judge you if you decide to used uppercase one.</p>
<h2>How to use custom properties today?</h2>
<p>First of all, we should remember that CSS ignores declarations that it can’t parse. In addition to that, it uses “last win” approach – latest declaration overrides previous one. So we can simply put CSS rule with a fallback value before <code>var()</code> function usage:</p>
<pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.fallback</span> </span><span class="token punctuation">{</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token hexcode">#fff</span><span class="token punctuation">;</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--bg-color, <span class="token hexcode">#fff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Old browsers that have no implementation for custom properties ignore second <code>background-color</code> rule and use the first one.</p>
<p>We can do fallback more explicitly, using supports at-rule:</p>
<pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.variable-bg</span> </span><span class="token punctuation">{</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token hexcode">#fff</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token atrule"><span class="token rule">@supports</span><span class="token punctuation">(</span><span class="token property">--foo</span><span class="token punctuation">:</span> bar<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
  <span class="token selector"><span class="token class">.variable-bg</span> </span><span class="token punctuation">{</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--bg-color, <span class="token hexcode">#fff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>But you should remember that not all browsers know about <code>@supports</code>. The more sad thing that we are just checking for simple CSS variables, there is no guarantee that the browser will understand typed properties. To address our check to custom properties, we need to use JS, at least for now. For example, we can add some class name to the root element:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">'registerProperty'</span> <span class="token keyword">in</span> <span class="token constant">CSS</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'no-custom-props'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>So we can use this class name to target our fallback:</p>
<pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.no-custom-props</span> <span class="token class">.variable-bg</span> </span><span class="token punctuation">{</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token hexcode">#fff</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector"><span class="token class">.variable-bg</span> </span><span class="token punctuation">{</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--bg-color, <span class="token hexcode">#fff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h2>Future</h2>
<p>There is a <a href="https://github.com/w3c/css-houdini-drafts/issues/137" target="_blank" rel="nofollow noreferrer noopener">great proposal</a> to “CSS Properties and Values API Level 2” specification that allows registering custom properties inside stylesheets. It is logical to declare a custom property in the same place where it should be used. The other good reason to do it in CSS – not revalidate variables again after registration of the property used. The proposed syntax looks like this:</p>
<pre class="language-css"><code class="language-css"><span class="token atrule"><span class="token rule">@property</span> --highlight-color</span> <span class="token punctuation">{</span>
  <span class="token property">syntax</span><span class="token punctuation">:</span> <span class="token string">'<color>'</color></span><span class="token punctuation">;</span>
  <span class="token property">initial-value</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
  <span class="token property">inherits</span><span class="token punctuation">:</span> true<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Note that it is not part of the spec yet. Even more, it is just discussion of possibility to include something similar in the next specification level. The syntax could be completely different in the future, and it is not implemented in any browser.</p>
<p>In the current draft, it looks pretty straight-forward. We need to use property at-rule, followed by property name. Then inside <code>@property</code> block we use the same options: <code>syntax</code>, <code>inherits</code> and <code>initial-value</code> (in CSS-like notation). This should be equal to:</p>
<pre class="language-js"><code class="language-js"><span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">registerProperty</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'--highlight-color'</span><span class="token punctuation">,</span>
  syntax<span class="token punctuation">:</span> <span class="token string">'<color>'</color></span><span class="token punctuation">,</span>
  initialValue<span class="token punctuation">:</span> <span class="token string">'red'</span><span class="token punctuation">,</span>
  inherits<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>I loved the idea and decided to create a PostCSS plugin that will use custom property declarations in CSS to generate JavaScript fallback, that registers all of them using <code>CSS.registerProperty</code>.</p>
<p class="star-me"><a href="https://github.com/vitaliy-bobrov/postcss-register-custom-props" target="_blank" rel="nofollow noreferrer noopener">Star on GitHub</a></p>
<h2>Conclusion</h2>
<p>Custom properties and value are powerful and a big game-changer in CSS. I can’t even imagine all the possible use-cases for them. It is an ocean of possibilities. For example, you can use them to implement <a href="https://jakearchibald.com/2016/css-loading-with-custom-props/" target="_blank" rel="nofollow noreferrer noopener">lazy-loaded styles</a>! Alternatively, implement a customizable website theme. Share your ideas on Twitter and over comments here.</p>
<h3>Resources</h3>
<ul><li><a href="https://drafts.csswg.org/css-values-4/" target="_blank" rel="nofollow noreferrer noopener">CSS Values and Units Module Level 4</a></li>
<li><a href="https://drafts.css-houdini.org/css-properties-values-api/​" target="_blank" rel="nofollow noreferrer noopener">CSS Properties and Values API Level 1</a></li>
</ul>

              </section>
          </article>

            <div class="mdl-card mdl-shadow--3dp mdl-cell mdl-cell--12-col comments-widget">
              <div id="commento"></div>
            </div>

        </main>

        <!-- Snackbar -->
        <div aria-live="assertive" aria-atomic="true" aria-relevant="text" class="mdl-snackbar mdl-js-snackbar">
          <div class="mdl-snackbar__text"></div>
          <button type="button" class="mdl-snackbar__action"></button>
        </div>

        <!-- Footer -->
        <footer role="contentinfo" class="mdl-mini-footer page-footer">
          <section class="mdl-mini-footer--left-section page-footer__left-section">
            <a href="https://twitter.com/bobrov1989" target="_blank" rel="nofollow noreferrer noopener" class="mdl-mini-footer--social-btn" title="Twitter">
              <svg class="mdl-mini-footer--social-btn__icon">
                <use href="/images/sprite.svg#twitter"/>
              </svg>
              Follow Vitalii Bobrov on Twitter
            </a>
        
            <a href="https://github.com/vitaliy-bobrov" target="_blank" rel="nofollow noreferrer noopener" class="mdl-mini-footer--social-btn" title="GitHub">
              <svg class="mdl-mini-footer--social-btn__icon">
                <use href="/images/sprite.svg#github"/>
              </svg>
              View Vitalii Bobrov profile on GitHub
            </a>
          </section>
        
          <section class="mdl-copyright">
            <p>© 2021 Bobrov Dev</p>
          </section>
        
          <section class="mdl-mini-footer--right-section page-footer__right-section">
          </section>
        </footer>
      </div>

      <div class="mdl-layout__obfuscator"></div>
    </div>

    <!-- Scripts -->
    <script src="/js/main.min.js" async defer></script>
  

<script defer src="https://cdn.commento.io/js/commento.js" data-css-override="https://bobrov.dev/css/commento.css"></script></body></html>