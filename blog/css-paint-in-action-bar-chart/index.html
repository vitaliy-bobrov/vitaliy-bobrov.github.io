<!doctype html><html lang="en"><head><title>CSS Paint in Action: Bar Chart | Bobrov Dev</title><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="description" content="We are going to create data visualizations that could be used in production projects -- bar chart. More than 65% of humans are visual learners. Visualization makes it easier to understand, compare, and analyze data. Using CSS Paint API, we can encapsulate all logic related to drawing charts on canvas and expose the high-level declarative interface."><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="alternate" href="https://bobrov.dev/blog/css-paint-in-action-bar-chart/" hreflang="en"><link rel="canonical" href="https://bobrov.dev/blog/css-paint-in-action-bar-chart/"><meta name="msapplication-tap-highlight" content="no"><meta name="mobile-web-app-capable" content="yes"><meta name="application-name" content="Bobrov Dev"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="apple-mobile-web-app-title" content="Bobrov Dev"><meta name="msapplication-TileColor" content="#008ba3"><link rel="apple-touch-icon" sizes="180x180" href="/images/icons/apple-touch-icon.png"><link rel="icon" type="image/png" href="/images/icons/favicon-32x32.png" sizes="32x32"><link rel="icon" type="image/png" href="/images/icons/favicon-16x16.png" sizes="16x16"><meta name="theme-color" content="#008ba3"><link rel="manifest" href="/manifest.json"><meta name="google-site-verification" content="-49tfdke4pxwhrBhLHu5VHTk-bb7g9jK_xQuD5Elq2Y"><link rel="preload" as="script" href="https://www.googletagmanager.com/gtag/js?id=UA-90372372-1"><link rel="stylesheet" href="/css/styles.css"><meta property="fb:app_id" content="393821434298248"><meta property="article:author" content="https://www.facebook.com/bobrov1989"><meta property="og:url" content="https://bobrov.dev/blog/css-paint-in-action-bar-chart/"><meta property="og:type" content="article"><meta property="og:title" content="CSS Paint in Action: Bar Chart"><meta property="og:description" content="We are going to create data visualizations that could be used in production projects -- bar chart. More than 65% of humans are visual learners. Visualization makes it easier to understand, compare, and analyze data. Using CSS Paint API, we can encapsulate all logic related to drawing charts on canvas and expose the high-level declarative interface."><meta property="og:image" content="https://bobrov.dev/images/posts/css-paint-in-action-bar-chart/css-paint-in-action-bar-chart-og.jpg"><meta property="og:image:url" content="https://bobrov.dev/images/posts/css-paint-in-action-bar-chart/css-paint-in-action-bar-chart-og.jpg"><meta property="og:image:type" content="image/jpeg"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><script type="application/ld+json">{
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "mainEntityOfPage": "True",
        "headline": "CSS Paint in Action: Bar Chart",
        "image": [
          "https://bobrov.dev/images/posts/css-paint-in-action-bar-chart/css-paint-in-action-bar-chart-og.jpg"
        ],
        "datePublished": "2018-04-13152357760000002:00:00+02",
        "dateModified": "2018-11-07154154880000001:00:00+01",
        "author": {
          "@type": "Person",
          "name": "Vitalii Bobrov"
        },
        "publisher": {
          "@type": "Organization",
          "name": "Bobrov Dev",
          "logo": {
            "@type": "ImageObject",
            "url": "https://bobrov.dev/images/logo.png",
            "width": "96",
            "height": "96"
          }
        },
        "description": "We are going to create data visualizations that could be used in production projects -- bar chart. More than 65% of humans are visual learners. Visualization makes it easier to understand, compare, and analyze data. Using CSS Paint API, we can encapsulate all logic related to drawing charts on canvas and expose the high-level declarative interface."
      }</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-90372372-1"></script><script>if (navigator.doNotTrack !== '1') {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-90372372-1');
      }</script><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@bobrov1989"><meta name="twitter:title" content="CSS Paint in Action: Bar Chart"><meta name="twitter:description" content="We are going to create data visualizations that could be used in production projects -- bar chart. More than 65% of humans are visual learners. Visualization makes it easier to understand, compare, and analyze data. Using CSS Paint API, we can encapsulate all logic related to drawing charts on canvas and expose the high-level declarative interface."><meta name="twitter:image" content="https://bobrov.dev/images/posts/css-paint-in-action-bar-chart/css-paint-in-action-bar-chart-og.jpg"><meta name="twitter:image:alt" content="CSS Paint in Action: Bar Chart"></head><body class="mdlext-dark-color-theme mdl-layout__container"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="0" height="0" style="position:absolute"><defs><svg viewbox="0 0 24 24" id="arrow-back" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"/><path d="M20 11H7.8l5.6-5.6L12 4l-8 8 8 8 1.4-1.4L7.8 13H20v-2z"/></svg> <svg viewbox="0 0 24 24" id="arrow-forward" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"/></svg> <svg viewbox="0 0 24 24" id="comment" xmlns="http://www.w3.org/2000/svg"><path d="M22 4c0-1-1-2-2-2H4C3 2 2 3 2 4v12c0 1 1 2 2 2h14l4 4V4zm-4 10H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/><path fill="none" d="M0 0h24v24H0z"/></svg> <svg viewbox="0 0 512 512" id="facebook" xmlns="http://www.w3.org/2000/svg"><path fill="currentColor" d="M287 456V157c0-21 6-35 35-35h38V59c-7-1-29-3-55-3-54 0-91 33-91 94v306m143-254H152v72h196"/></svg> <svg viewbox="0 0 512 512" id="github" xmlns="http://www.w3.org/2000/svg"><path fill="currentColor" d="M119 255c17 30 49 48 102 53-8 6-17 17-18 30-10 6-29 8-44 3-21-7-29-48-61-42-7 1-6 6 0 10 10 6 21 16 26 30 12 31 37 39 77 33v45c0 14-20 18-20 25 0 3 7 3 12 3 10 0 32-9 32-23 0-12 0-52 1-59 0-15 8-20 8-20s1 82-2 92c-4 13-10 11-10 17 0 9 26 2 35-17 7-15 4-95 3-94h7s0 37 1 53c0 17-1 39 9 50 7 7 29 19 29 8 0-6-12-12-12-29v-79c10 0 8 26 8 26l1 48s-2 18 19 25c8 3 24 3 25-1s-20-11-20-25v-49c0-36-5-49-22-60 53-5 86-18 102-53 10-20 12-44 12-62 0-50-24-67-29-76 7-38-1-55-5-60-14-5-48 12-66 24-30-9-94-8-118 2-44-31-67-26-67-26s-15 27-4 66c-15 18-25 31-26 65 0 27 3 44 15 67z"/></svg> <svg viewbox="0 0 512 512" id="linkedin" xmlns="http://www.w3.org/2000/svg"><circle cx="104" cy="104" r="48" fill="currentColor"/><path d="M237 178v259M104 178v259" stroke="currentColor" stroke-width="86"/><path d="M279 293c0-26 18-53 48-53 31 0 43 24 43 59v138h86V289c0-80-42-116-99-116-45 0-67 25-78 42" fill="currentColor"/></svg> <svg viewbox="0 0 24 24" id="menu" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg> <svg viewbox="0 0 24 24" id="share" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"/><path d="M18 16c-.8 0-1.4.4-2 .8l-7-4v-1.5l7-4c.5.4 1.2.7 2 .7 1.7 0 3-1.3 3-3s-1.3-3-3-3-3 1.3-3 3v.7l-7 4C7.5 9.4 6.8 9 6 9c-1.7 0-3 1.3-3 3s1.3 3 3 3c.8 0 1.5-.3 2-.8l7.2 4.2v.6c0 1.6 1.2 3 2.8 3 1.6 0 3-1.4 3-3s-1.4-3-3-3z"/></svg> <svg viewbox="0 0 512 512" id="twitter" xmlns="http://www.w3.org/2000/svg"><path fill="currentColor" d="M456 133c-14 7-31 11-47 13 17-10 30-27 37-46-15 10-34 16-52 20-61-62-157-7-141 75-68-3-129-35-169-85-22 37-11 86 26 109-13 0-26-4-37-9 0 39 28 72 65 80-12 3-25 4-37 2 10 33 41 57 77 57-42 30-77 38-122 34 170 111 378-32 359-208 16-11 30-25 41-42z"/></svg></defs></svg><div class="mdl-layout mdl-layout--no-desktop-drawer-button mdl-layout--fixed-header mdl-js-layout"><header class="mdl-layout__header is-casting-shadow" role="banner"><div class="mdl-layout__drawer-button" role="button" tabindex="0" aria-expanded="false"><svg class="mdl-svg drawer-icon"><use xlink:href="#menu"/></svg> Menu</div><div class="mdl-layout__header-row"><span class="mdl-layout-title"><a class="site-link" href="https://bobrov.dev/" rel="nofollow">Bobrov Dev</a></span><div class="mdl-layout-spacer"><a href="https://bobrov.dev/" class="site-logo" title="Bobrov Dev" rel="nofollow"><picture class="site-logo__picture"><source media="(min-width: 1025px)" srcset="/images/logo.webp, /images/logo@2x.webp 2x" type="image/webp"><source media="(min-width: 1025px)" srcset="/images/logo.png, /images/logo@2x.png 2x"><source media="(min-width: 768px)" srcset="/images/logo-tablet.webp, /images/logo-tablet@2x.webp 2x" type="image/webp"><source media="(min-width: 768px)" srcset="/images/logo-tablet.png, /images/logo-tablet@2x.png 2x"><source srcset="/images/logo-mobile.webp, /images/logo-mobile@2x.webp 2x" type="image/webp"><source srcset="/images/logo-mobile.png, /images/logo-mobile@2x.png 2x"><img src="/images/logo.png" alt="Bobrov Dev Logo" loading="eager" class="site-logo__img"></picture></a></div><nav class="mdl-navigation mdl-layout--large-screen-only" aria-label="Main navigation"><a class="mdl-navigation__link mdl-navigation__link_active" href="https://bobrov.dev/" rel="nofollow">Blog</a> <a class="mdl-navigation__link" href="https://bobrov.dev/speaker/">Speaker </a><a class="mdl-navigation__link" href="https://bobrov.dev/about/">About</a></nav></div></header><div class="mdl-layout__drawer"><span class="mdl-layout-title">Bobrov Dev</span><nav class="mdl-navigation" aria-label="Main navigation"><a class="mdl-navigation__link mdl-navigation__link_active" href="https://bobrov.dev/" rel="nofollow" aria-current="page">Blog</a> <a class="mdl-navigation__link" href="https://bobrov.dev/speaker/">Speaker </a><a class="mdl-navigation__link" href="https://bobrov.dev/about/">About </a><button class="mdl-button mdl-button--raised js-add-to-home" disabled>Add to home screen</button></nav></div><div class="mdl-layout__content js-lazy-container"><main class="mdl-grid posts-grid"><article class="mdl-card mdl-shadow--3dp mdl-cell post mdl-cell--12-col"><header class="mdl-card__media post__media"><picture class="safe-picture"><source media="(min-width: 1025px)" srcset="/images/posts/css-paint-in-action-bar-chart/css-paint-in-action-bar-chart.webp, /images/posts/css-paint-in-action-bar-chart/css-paint-in-action-bar-chart@2x.webp 2x" type="image/webp"><source media="(min-width: 1025px)" srcset="/images/posts/css-paint-in-action-bar-chart/css-paint-in-action-bar-chart.jpg, /images/posts/css-paint-in-action-bar-chart/css-paint-in-action-bar-chart@2x.jpg 2x"><source media="(min-width: 768px)" srcset="/images/posts/css-paint-in-action-bar-chart/css-paint-in-action-bar-chart-tablet.webp, /images/posts/css-paint-in-action-bar-chart/css-paint-in-action-bar-chart-tablet@2x.webp 2x" type="image/webp"><source media="(min-width: 768px)" srcset="/images/posts/css-paint-in-action-bar-chart/css-paint-in-action-bar-chart-tablet.jpg, /images/posts/css-paint-in-action-bar-chart/css-paint-in-action-bar-chart-tablet@2x.jpg 2x"><source srcset="/images/posts/css-paint-in-action-bar-chart/css-paint-in-action-bar-chart-mobile.webp, /images/posts/css-paint-in-action-bar-chart/css-paint-in-action-bar-chart-mobile@2x.webp 2x" type="image/webp"><source srcset="/images/posts/css-paint-in-action-bar-chart/css-paint-in-action-bar-chart-mobile.jpg, /images/posts/css-paint-in-action-bar-chart/css-paint-in-action-bar-chart-mobile@2x.jpg 2x"><img src="/images/posts/css-paint-in-action-bar-chart/css-paint-in-action-bar-chart.jpg" loading="eager" alt="CSS Paint in Action: Bar Chart" class="safe-picture__img"></picture><div class="safe-gradient"></div><h1 class="post__title">CSS Paint in Action: Bar Chart</h1></header><section class="post__info post-info"><div class="post-info__data"><picture class="post-info__avatar"><source srcset="/images/authors/bobrov/avatar.webp, /images/authors/bobrov/avatar@2x.webp 2x" type="image/webp"><source srcset="/images/authors/bobrov/avatar.jpg, /images/authors/bobrov/avatar@2x.jpg 2x"><img src="/images/authors/bobrov/avatar.jpg" loading="lazy" alt="Vitalii Bobrov Photo" class="mdl-list__item-avatar"></picture><div class="post-info__data-wrapper"><div class="post-info__author">Vitalii Bobrov</div><time datetime="2018-04-13" class="post-info__date">13 April 2018</time></div></div><div class="post-info__side"><div class="post-info__categories"><a href="/category/css" class="mdl-chip post-info__category"><span class="mdl-chip__text">CSS</span> </a><a href="/category/houdini" class="mdl-chip post-info__category"><span class="mdl-chip__text">Houdini</span></a></div></div></section><div class="mdl-card__menu post-share"><button id="share-menu-0" class="mdl-button mdl-button--icon ripple post-share__button js-share-btn" title="Share this post" aria-label="Share this post" data-share-title="CSS Paint in Action: Bar Chart" data-share-text="CSS Paint in Action: Bar Chart by @bobrov1989" data-share-url="https://bobrov.dev/blog/css-paint-in-action-bar-chart/"><span class="ripple-ink"></span> <svg class="mdl-svg post-share__icon"><use xlink:href="#share"/></svg> Share post</button><ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu share-menu js-share-menu"><li class="mdl-menu__item share-menu__item"><a href="https://www.facebook.com/sharer.php?u=https://bobrov.dev/blog/css-paint-in-action-bar-chart/" class="share-menu__link" target="_blank" rel="nofollow noreferrer noopener"><svg class="share-menu__icon"><use xlink:href="#facebook"/></svg> Facebook</a></li><li class="mdl-menu__item share-menu__item"><a href="https://twitter.com/home?status=https://bobrov.dev/blog/css-paint-in-action-bar-chart/" class="share-menu__link" target="_blank" rel="nofollow noreferrer noopener"><svg class="share-menu__icon"><use xlink:href="#twitter"/></svg> Twitter</a></li><li class="mdl-menu__item share-menu__item"><a href="https://linkedin.com/shareArticle?url=https://bobrov.dev/blog/css-paint-in-action-bar-chart/" class="share-menu__link" target="_blank" rel="nofollow noreferrer noopener"><svg class="share-menu__icon"><use xlink:href="#linkedin"/></svg> LinkedIn</a></li></ul></div><section class="post__contents"><p>In my <a href="/blog/exploring-the-css-paint-api/">previous article</a>, we discovered CSS Paint API basics. Today, with this knowledge arsenal we are going to create data visualizations that could be used in production projects &#x2013; bar chart. More than 65% of humans are visual learners. Visualization makes it easier to understand, compare, and analyze data. Using CSS Paint API, we can encapsulate all logic related to drawing charts on canvas and expose the high-level declarative interface.</p><p>The most uncomplicated graph we can create is a bar chart &#x1F4CA;. It is the set of rectangles, possibly with a different background color, and the size of each box represents its value compared to the others. Usually, the maximum dataset value is taken as 100% on the target axis. So in our example, we will use the range from zero to the maximum amount of the given dataset for values axis, as in 90% cases this is what we need to implement. On the secondary axis, we will linearly distribute our bars and separate them with the gap in pixels specified by the passed argument.</p><p>To create a custom painter we need to follow three easy steps: declare a custom paint class, register paint, and load worklet. So let&#x2019;s start with the painter class definition:</p><pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">BarChartPainter</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token keyword">get</span> <span class="token function">inputProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
      <span class="token string">&apos;--bar-map&apos;</span><span class="token punctuation">,</span>
      <span class="token string">&apos;--bar-gap&apos;</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">paint</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> geom<span class="token punctuation">,</span> props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Here will be our paint implementation.</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>So, for now, our <code>paint</code> method does nothing &#x1F925;, the only thing we declared is the static <code>inputProperties</code> getter. This getter will return the list of CSS variable our painter relies on, that means that after each change of the value of these variables the browser will call the <code>paint</code> method.</p><h2>Dataset</h2><p>Our first variable stands for the dataset and we will use it to draw the chart. My first thought was to use Custom Properties API from Houdini for them and use something like the <code>&lt;color-stop&gt;</code> type. <code>&lt;color-stop&gt;</code> is the pair of percentage or length value and CSS color. Value and color are separated by spaces. The list of <code>&lt;color-stop&gt;</code> value is used on the <code>linear-gradient</code> function, to declare that we want to use a list of Typed OM values we need to add <code>+</code> at the end of type declaration &#x2013; <code>&lt;color-stop&gt;+</code>. Unfortunately, for now, <code>CSS.registerProperty</code> doesn&#x2019;t support lists and <code>&lt;color-stop&gt;</code> type.</p><pre class="language-js"><code class="language-js"><span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">registerProperty</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">&apos;--data-points&apos;</span><span class="token punctuation">,</span>
  syntax<span class="token punctuation">:</span> <span class="token string">&apos;&lt;color-stop&gt;&apos;</span><span class="token punctuation">,</span>
  inherits<span class="token punctuation">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">registerProperty</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">&apos;--data-colors&apos;</span><span class="token punctuation">,</span>
  syntax<span class="token punctuation">:</span> <span class="token string">&apos;&lt;color&gt;+&apos;</span><span class="token punctuation">,</span>
  inherits<span class="token punctuation">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Uncaught DOMException<span class="token punctuation">:</span> Failed to execute <span class="token string">&apos;registerProperty&apos;</span> on <span class="token string">&apos;CSS&apos;</span><span class="token punctuation">:</span>
The syntax provided is not a valid custom property syntax<span class="token punctuation">.</span>
</code></pre><p>Such an argument will cause <code>DOMException</code> errors. After my initial idea failed, I decided to follow with a CSS variable with a special syntax. CSS variables are just strings that will be interpolated in the place that they are used.</p><pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.hello-var</span> </span><span class="token punctuation">{</span>
  <span class="token property">--my-varialbe</span><span class="token punctuation">:</span> <span class="token string">&apos;hello world&apos;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector"><span class="token class">.hello-var</span><span class="token pseudo-element">:after</span> </span><span class="token punctuation">{</span>
  <span class="token property">content</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--my-varialbe<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>Text &#x201C;hello world&#x201D; will be used as the value for <code>after</code> pseudo-element <code>content</code> property. That is completely equivalent to:</p><pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.hello-var</span><span class="token pseudo-element">:after</span> </span><span class="token punctuation">{</span>
  <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">&apos;hello world&apos;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>So I decided to use <code>number</code> and <code>color</code> pairs delimited by a comma. Each number will represent the value for bar and color will be used for the background. This implementation has a big issue as we can&#x2019;t use commas in color or value. I think it is ok for now to stay with that, as I wouldn&#x2019;t want to complicate tutorial with <code>RexExp</code>. Here how our dataset should look like:</p><pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.bars</span> </span><span class="token punctuation">{</span>
  <span class="token property">--bar-map</span><span class="token punctuation">:</span> <span class="token number">50</span> <span class="token hexcode">#666</span>, <span class="token number">70</span> salmon, <span class="token number">35</span> <span class="token hexcode">#9ee7a1</span>, <span class="token number">15</span> <span class="token hexcode">#fff</span>, <span class="token number">25</span> orange<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h2>Data Parsing</h2><p>After the input format decision has been made we can implement a helper method to parse it in our painter class:</p><pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">BarChartPainter</span> <span class="token punctuation">{</span>
  <span class="token function">_parseData</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> input<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&apos;,&apos;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>entry <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">[</span>value<span class="token punctuation">,</span> color<span class="token punctuation">]</span> <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&apos; &apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token punctuation">{</span>
          value<span class="token punctuation">:</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">,</span>
          color<span class="token punctuation">:</span> color <span class="token operator">||</span> <span class="token string">&apos;black&apos;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>Nothing special here, we pass our CSS variable input and transform it into the list of objects. Additionally, we added fallbacks for the value and color. Next, we will add the helper method to get the maximum value from the given dataset:</p><pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">BarChartPainter</span> <span class="token punctuation">{</span>
  <span class="token function">_getMax</span><span class="token punctuation">(</span>dataset<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> dataset<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>maxVal<span class="token punctuation">,</span> entry<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> maxVal <span class="token operator">&lt;</span> entry<span class="token punctuation">.</span>value <span class="token operator">?</span> entry<span class="token punctuation">.</span>value <span class="token punctuation">:</span> maxVal<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h2>Drawing bars</h2><p>For the beginning let&#x2019;s make vertical bars, other orientation support will be in our &#x201C;To Do&#x201D; list. We are going to implement the main &#x2013; <code>paint</code> method:</p><pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">BarChartPainter</span> <span class="token punctuation">{</span>
  <span class="token function">paint</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token punctuation">{</span>width<span class="token punctuation">,</span> height<span class="token punctuation">}</span><span class="token punctuation">,</span> props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> gap <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>
      <span class="token punctuation">(</span>props<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;--bar-gap&apos;</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token number">10</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_parseData</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;--bar-map&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> max <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getMax</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> multiplier <span class="token operator">=</span> height <span class="token operator">/</span> max<span class="token punctuation">;</span>
    <span class="token keyword">const</span> barW <span class="token operator">=</span> <span class="token punctuation">(</span>width <span class="token operator">-</span> <span class="token punctuation">(</span>gap <span class="token operator">*</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> data<span class="token punctuation">.</span>length<span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> x <span class="token operator">=</span> i <span class="token operator">*</span> <span class="token punctuation">(</span>barW <span class="token operator">+</span> gap<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> barHeight <span class="token operator">=</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">*</span> multiplier<span class="token punctuation">;</span>
      <span class="token keyword">const</span> y <span class="token operator">=</span> height <span class="token operator">-</span> barHeight<span class="token punctuation">;</span>

      ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>color<span class="token punctuation">;</span>

      ctx<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> barW<span class="token punctuation">,</span> barHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>Let&#x2019;s take a look at this method line-by-line &#x1F9D0;. First of all, we are trying to get the <code>--bar-gap</code> variable and parse it as an integer. If there is no gap defined <code>props.get(&apos;--bar-gap&apos;)</code> will return <code>null</code> so we were providing a fallback value before calling <code>toString</code>. Then we are parsing our dataset stored in the <code>--bar-map</code> variable and getting the maximum value using helpers that we defined before. Then we are calculating how much height one value point should be by dividing the canvas height by the maximum value. After that, we are calculating the width of each bar. And finally, we are iterating our dataset and drawing rectangles for each of the values.</p><p>Now we are ready to register our paint:</p><pre class="language-js"><code class="language-js"><span class="token function">registerPaint</span><span class="token punctuation">(</span><span class="token string">&apos;bar-chart&apos;</span><span class="token punctuation">,</span> BarChartPainter<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>Here is the full content of our worklet JavaScript file:</p><pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">BarChartPainter</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token keyword">get</span> <span class="token function">inputProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
      <span class="token string">&apos;--bar-map&apos;</span><span class="token punctuation">,</span>
      <span class="token string">&apos;--bar-gap&apos;</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">_parseData</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> input<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&apos;,&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>entry <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">[</span>value<span class="token punctuation">,</span> color<span class="token punctuation">]</span> <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&apos; &apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        value<span class="token punctuation">:</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">,</span>
        color<span class="token punctuation">:</span> color <span class="token operator">||</span> <span class="token string">&apos;black&apos;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">_getMax</span><span class="token punctuation">(</span>dataset<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> dataset<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>maxVal<span class="token punctuation">,</span> entry<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> maxVal <span class="token operator">&lt;</span> entry<span class="token punctuation">.</span>value <span class="token operator">?</span> entry<span class="token punctuation">.</span>value <span class="token punctuation">:</span> maxVal<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">paint</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token punctuation">{</span>width<span class="token punctuation">,</span> height<span class="token punctuation">}</span><span class="token punctuation">,</span> props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> gap <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>
      <span class="token punctuation">(</span>props<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;--bar-gap&apos;</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token number">10</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_parseData</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;--bar-map&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> max <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getMax</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> multiplier <span class="token operator">=</span> height <span class="token operator">/</span> max<span class="token punctuation">;</span>
    <span class="token keyword">const</span> barW <span class="token operator">=</span> <span class="token punctuation">(</span>width <span class="token operator">-</span> <span class="token punctuation">(</span>gap <span class="token operator">*</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> data<span class="token punctuation">.</span>length<span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> x <span class="token operator">=</span> i <span class="token operator">*</span> <span class="token punctuation">(</span>barW <span class="token operator">+</span> gap<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> barHeight <span class="token operator">=</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">*</span> multiplier<span class="token punctuation">;</span>
      <span class="token keyword">const</span> y <span class="token operator">=</span> height <span class="token operator">-</span> barHeight<span class="token punctuation">;</span>

      ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>color<span class="token punctuation">;</span>

      ctx<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> barW<span class="token punctuation">,</span> barHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">registerPaint</span><span class="token punctuation">(</span><span class="token string">&apos;bar-chart&apos;</span><span class="token punctuation">,</span> BarChartPainter<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h2>Loading the worklet</h2><p>So to have the ability to use our custom painter in the stylesheet, we need to load our worklet:</p><pre class="language-js"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&apos;paintWorklet&apos;</span> <span class="token keyword">in</span> <span class="token constant">CSS</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token constant">CSS</span><span class="token punctuation">.</span>paintWorklet<span class="token punctuation">.</span><span class="token function">addModule</span><span class="token punctuation">(</span><span class="token string">&apos;paint.js&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>I called my file <code>paint.js</code> and then loaded it using the <code>CSS.paintWorklet.addModule</code> method. Not long ago <a href="https://twitter.com/dassurma" target="_blank" rel="nofollow noreferrer noopener">Surma</a>, main Houdini project supporter, published an interesting <a href="https://twitter.com/DasSurma/status/983305990731894785" target="_blank" rel="nofollow noreferrer noopener">cheat</a> on how to avoid additional HTTP requests to load worklets. We can&#x2019;t write worklet code as inline JavaScript because it shouldn&#x2019;t have access to the global scope. All worklets are executed in a separate browser context with insufficient functionality for security reasons. Inside this context we can use only a small subset of 2D canvas, a few global JS functions and helpers, like <code>parseInt</code> or <code>Math</code>, but not <code>setInterval</code>, <code>setTimeout</code> or <code>requestAnimationFrame</code>. The idea behind Surma&#x2019;s worklet embedding method is to write inline code inside the <code>script</code> tag but with different a language type, to avoid its execution. Then we can convert it to <code>Blob</code> objects and create an object URL from it. Here is the code example:</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">language</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>javascript+paint<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
  <span class="token keyword">class</span> <span class="token class-name">BarChartPainter</span> <span class="token punctuation">{</span>
    <span class="token function">paint</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> geom<span class="token punctuation">,</span> props<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">registerPaint</span><span class="token punctuation">(</span><span class="token string">&apos;bar-chart&apos;</span><span class="token punctuation">,</span> BarChartPainter<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
  <span class="token keyword">function</span> <span class="token function">blobWorklet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> src <span class="token operator">=</span> document
      <span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&apos;script[language$=&quot;paint&quot;]&apos;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>innerHTML<span class="token punctuation">;</span>
    <span class="token keyword">const</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>src<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>type<span class="token punctuation">:</span> <span class="token string">&apos;text/javascript&apos;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&apos;paintWorklet&apos;</span> <span class="token keyword">in</span> <span class="token constant">CSS</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token constant">CSS</span><span class="token punctuation">.</span>paintWorklet<span class="token punctuation">.</span><span class="token function">addModule</span><span class="token punctuation">(</span><span class="token function">blobWorklet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>Using this trick, we avoid sending additional HTTP requests to load CSS Paint worklet.</p><h2>Using worklet</h2><p>After our painter is registered and loaded we can call it in the CSS:</p><pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.bars</span> </span><span class="token punctuation">{</span>
  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">700</span>px<span class="token punctuation">;</span>
  <span class="token property">max-height</span><span class="token punctuation">:</span> <span class="token number">50</span>vh<span class="token punctuation">;</span>
  <span class="token property">--bar-map</span><span class="token punctuation">:</span> <span class="token number">50</span> <span class="token hexcode">#666</span>, <span class="token number">70</span> salmon, <span class="token number">35</span> <span class="token hexcode">#9ee7a1</span>, <span class="token number">15</span> <span class="token hexcode">#fff</span>, <span class="token number">25</span> orange<span class="token punctuation">;</span>
  <span class="token property">--bar-gap</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode">#111</span> <span class="token function">paint</span><span class="token punctuation">(</span>bar-chart<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token atrule"><span class="token rule">@supports</span> not <span class="token punctuation">(</span><span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">paint</span><span class="token punctuation">(</span>bar-chart<span class="token punctuation">)</span><span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
  <span class="token selector"><span class="token class">.bars</span><span class="token pseudo-element">:after</span> </span><span class="token punctuation">{</span>
    <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">&apos;Your browser does not support CSS Paint API :(&apos;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>We declared <code>--bar-map</code> and <code>--bar-gap</code> variables and called the custom paint using <code>paint(bar-chart)</code>. We set a solid background color as well. Also, I have added a feature detection with <code>@supports</code> rule. Using this if a browser doesn&#x2019;t support the CSS Paint API will show an appropriate message to the user.</p><h2>Improvements</h2><p>We have already created a bar chart MVP and now is the time to think about its improvements. Actually, there are a lot of points to improve, and I am not going to cover all of them. If you want to implement more feel free to fork my repository and do it, just don&#x2019;t forget to share your ideas in the comments below and social networks (on Twitter please ping <a href="https://twitter.com/bobrov1989" target="_blank" rel="nofollow noreferrer noopener">me</a>).</p><h3><strong>Note:</strong></h3><p><em>There is a bug related to Typed OM that used as input properties in worklet. For the demos below</em> <code>props.get(&apos;padding&apos;)</code> <em>returns</em> <code>CSSUnitValue</code> <em>object without</em> <code>unit</code> <em>and</em> <code>value</code> <em>properties. The only way is to use <code>toString</code> method on it. If you are facing any issues viewing demos, try to enable &#x201C;Experimental Web Platform features&#x201D;</em> &#x2013; <code>chrome://flags/#enable-experimental-web-platform-features</code> <em>to fix it.</em></p><p>So the first point I want to cover is to add the possibility to define offsets for our chart. And I&#x2019;m going to use the <code>padding</code> property for that. Here is the updated painter class:</p><pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">BarChartPainter</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token keyword">get</span> <span class="token function">inputProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
      <span class="token string">&apos;--bar-map&apos;</span><span class="token punctuation">,</span>
      <span class="token string">&apos;--bar-gap&apos;</span><span class="token punctuation">,</span>
      <span class="token string">&apos;padding-top&apos;</span><span class="token punctuation">,</span>
      <span class="token string">&apos;padding-right&apos;</span><span class="token punctuation">,</span>
      <span class="token string">&apos;padding-bottom&apos;</span><span class="token punctuation">,</span>
      <span class="token string">&apos;padding-left&apos;</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">paint</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> geom<span class="token punctuation">,</span> props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> gap <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>
      <span class="token punctuation">(</span>props<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;--bar-gap&apos;</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token number">10</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> padding <span class="token operator">=</span> <span class="token punctuation">{</span>
      top<span class="token punctuation">:</span> props<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;padding-top&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">,</span>
      right<span class="token punctuation">:</span> props<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;padding-right&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">,</span>
      bottom<span class="token punctuation">:</span> props<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;padding-bottom&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">,</span>
      left<span class="token punctuation">:</span> props<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;padding-left&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> width <span class="token operator">=</span> geom<span class="token punctuation">.</span>width <span class="token operator">-</span> padding<span class="token punctuation">.</span>left <span class="token operator">-</span> padding<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
    <span class="token keyword">const</span> height <span class="token operator">=</span> geom<span class="token punctuation">.</span>height <span class="token operator">-</span> padding<span class="token punctuation">.</span>top <span class="token operator">-</span> padding<span class="token punctuation">.</span>bottom<span class="token punctuation">;</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_parseData</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;--bar-map&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> max <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getMax</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> multiplier <span class="token operator">=</span> height <span class="token operator">/</span> max<span class="token punctuation">;</span>
    <span class="token keyword">const</span> barW <span class="token operator">=</span> <span class="token punctuation">(</span>width <span class="token operator">-</span> <span class="token punctuation">(</span>gap <span class="token operator">*</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> data<span class="token punctuation">.</span>length<span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> x <span class="token operator">=</span> i <span class="token operator">*</span> <span class="token punctuation">(</span>barW <span class="token operator">+</span> gap<span class="token punctuation">)</span> <span class="token operator">+</span> padding<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
      <span class="token keyword">const</span> barHeight <span class="token operator">=</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">*</span> multiplier<span class="token punctuation">;</span>
      <span class="token keyword">const</span> y <span class="token operator">=</span> height <span class="token operator">-</span> barHeight <span class="token operator">+</span> padding<span class="token punctuation">.</span>top<span class="token punctuation">;</span>

      ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>color<span class="token punctuation">;</span>

      ctx<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> barW<span class="token punctuation">,</span> barHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>Now we are using padding values to calculate bar width and height. Next, I want to add the possibility to change chart orientation. I will introduce the <code>--bar-placement</code> variable with possible values: top, bottom, left and right. Here is the final code:</p><pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">BarChartPainter</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token keyword">get</span> <span class="token function">inputProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
      <span class="token string">&apos;--bar-map&apos;</span><span class="token punctuation">,</span>
      <span class="token string">&apos;--bar-placement&apos;</span><span class="token punctuation">,</span>
      <span class="token string">&apos;--bar-gap&apos;</span><span class="token punctuation">,</span>
      <span class="token string">&apos;padding-top&apos;</span><span class="token punctuation">,</span>
      <span class="token string">&apos;padding-right&apos;</span><span class="token punctuation">,</span>
      <span class="token string">&apos;padding-bottom&apos;</span><span class="token punctuation">,</span>
      <span class="token string">&apos;padding-left&apos;</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">_parseData</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> input<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&apos;,&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>entry <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">[</span>value<span class="token punctuation">,</span> color<span class="token punctuation">]</span> <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&apos; &apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        value<span class="token punctuation">:</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">,</span>
        color<span class="token punctuation">:</span> color <span class="token operator">||</span> <span class="token string">&apos;black&apos;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">_getMax</span><span class="token punctuation">(</span>dataset<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> dataset<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>maxVal<span class="token punctuation">,</span> entry<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> maxVal <span class="token operator">&lt;</span> entry<span class="token punctuation">.</span>value <span class="token operator">?</span> entry<span class="token punctuation">.</span>value <span class="token punctuation">:</span> maxVal<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">paint</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> geom<span class="token punctuation">,</span> props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> position <span class="token operator">=</span> props<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;--bar-placement&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> gap <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;--bar-gap&apos;</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> padding <span class="token operator">=</span> <span class="token punctuation">{</span>
      top<span class="token punctuation">:</span> props<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;padding-top&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">,</span>
      right<span class="token punctuation">:</span> props<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;padding-right&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">,</span>
      bottom<span class="token punctuation">:</span> props<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;padding-bottom&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">,</span>
      left<span class="token punctuation">:</span> props<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;padding-left&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> vertical <span class="token operator">=</span> position <span class="token operator">===</span> <span class="token string">&apos;top&apos;</span> <span class="token operator">||</span> position <span class="token operator">===</span> <span class="token string">&apos;bottom&apos;</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> width <span class="token operator">=</span> geom<span class="token punctuation">.</span>width <span class="token operator">-</span> padding<span class="token punctuation">.</span>left <span class="token operator">-</span> padding<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
    <span class="token keyword">const</span> height <span class="token operator">=</span> geom<span class="token punctuation">.</span>height <span class="token operator">-</span> padding<span class="token punctuation">.</span>top <span class="token operator">-</span> padding<span class="token punctuation">.</span>bottom<span class="token punctuation">;</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_parseData</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;--bar-map&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> max <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getMax</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> domain <span class="token operator">=</span> vertical <span class="token operator">?</span> height <span class="token punctuation">:</span> width<span class="token punctuation">;</span>
    <span class="token keyword">const</span> baseWidth <span class="token operator">=</span> vertical <span class="token operator">?</span> width <span class="token punctuation">:</span> height<span class="token punctuation">;</span>
    <span class="token keyword">const</span> multiplier <span class="token operator">=</span> domain <span class="token operator">/</span> max<span class="token punctuation">;</span>
    <span class="token keyword">const</span> barW <span class="token operator">=</span> <span class="token punctuation">(</span>baseWidth <span class="token operator">-</span> <span class="token punctuation">(</span>gap <span class="token operator">*</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> data<span class="token punctuation">.</span>length<span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> x <span class="token operator">=</span> i <span class="token operator">*</span> <span class="token punctuation">(</span>barW <span class="token operator">+</span> gap<span class="token punctuation">)</span> <span class="token operator">+</span> padding<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
      <span class="token keyword">const</span> barH <span class="token operator">=</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">*</span> multiplier<span class="token punctuation">;</span>
      <span class="token keyword">const</span> y <span class="token operator">=</span> <span class="token punctuation">{</span>
        top<span class="token punctuation">:</span> padding<span class="token punctuation">.</span>top<span class="token punctuation">,</span>
        right<span class="token punctuation">:</span> domain <span class="token operator">-</span> barH <span class="token operator">+</span> padding<span class="token punctuation">.</span>left<span class="token punctuation">,</span>
        bottom<span class="token punctuation">:</span> domain <span class="token operator">-</span> barH <span class="token operator">+</span> padding<span class="token punctuation">.</span>top<span class="token punctuation">,</span>
        left<span class="token punctuation">:</span> padding<span class="token punctuation">.</span>left
      <span class="token punctuation">}</span><span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token punctuation">;</span>

      ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>color<span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>vertical<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> barW<span class="token punctuation">,</span> barH<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> x<span class="token punctuation">,</span> barH<span class="token punctuation">,</span> barW<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>And the updated styles:</p><pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.bars</span> </span><span class="token punctuation">{</span>
  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">700</span>px<span class="token punctuation">;</span>
  <span class="token property">max-height</span><span class="token punctuation">:</span> <span class="token number">50</span>vh<span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">30</span>px <span class="token number">10</span>px <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token property">--bar-placement</span><span class="token punctuation">:</span> bottom<span class="token punctuation">;</span>
  <span class="token property">--bar-gap</span><span class="token punctuation">:</span> <span class="token number">40</span><span class="token punctuation">;</span>
  <span class="token property">--bar-map</span><span class="token punctuation">:</span> <span class="token number">50</span> <span class="token hexcode">#666</span>, <span class="token number">70</span> salmon, <span class="token number">35</span> <span class="token hexcode">#9ee7a1</span>, <span class="token number">15</span> <span class="token hexcode">#fff</span>, <span class="token number">25</span> orange<span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode">#111</span> <span class="token function">paint</span><span class="token punctuation">(</span>bar-chart<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p></p><div class="remarkable-youtube-wrapper"><iframe class="remarkable-youtube js-lazy-load" data-src="https://www.youtube.com/embed/dn1bwJPQY5I?origin=https://bobrov.dev/&amp;rel=0" frameborder="0" allow="encrypted-media" allowfullscreen></iframe></div><p></p><p>As usual you can check <a href="https://github.com/vitaliy-bobrov/css-paint-demos/tree/master/src/bar" target="_blank" rel="nofollow noreferrer noopener">code</a> and <a href="https://bobrov.dev/css-paint-demos/bar/">demo</a>.</p><h2>Change the input format</h2><p>After thinking for some time, I decided to change the dataset input using &quot;JS in CSS&quot;. Yes, you read it correctly, I want to use JavaScript inside CSS. As I said before, our worklet code is executed in a secure and separate context and in this case, it is completely fine to use some JS as a CSS variable value. Then I&#x2019;m going to parse this value in a custom painter using <code>JSON.parse</code>. Let&#x2019;s look at stylesheet first:</p><pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.bars</span> </span><span class="token punctuation">{</span>
  <span class="token selector">height: 700px;
  max-height: 50vh;
  padding: 10px;
  background: <span class="token id">#111</span> paint(bar-chart);
  --bar-placement: bottom;
  --bar-gap: 40;
  --bar-map: [
    </span><span class="token punctuation">{</span>
      <span class="token string">&quot;value&quot;</span><span class="token punctuation">:</span> <span class="token number">55</span>,
      <span class="token string">&quot;color&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;rgba(250, 128, 114, .8)&quot;</span>
    <span class="token punctuation">}</span><span class="token selector">,
    </span><span class="token punctuation">{</span>
      <span class="token string">&quot;value&quot;</span><span class="token punctuation">:</span> <span class="token number">10</span>,
      <span class="token string">&quot;color&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;rgba(102, 51, 153, .9)&quot;</span>
    <span class="token punctuation">}</span><span class="token selector">,
    </span><span class="token punctuation">{</span>
      <span class="token string">&quot;value&quot;</span><span class="token punctuation">:</span> <span class="token number">120</span>,
      <span class="token string">&quot;color&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;hsl(39, 100%, 50%)&quot;</span>
    <span class="token punctuation">}</span><span class="token selector">,
    </span><span class="token punctuation">{</span>
      <span class="token string">&quot;value&quot;</span><span class="token punctuation">:</span> <span class="token number">36.8</span>,
      <span class="token string">&quot;color&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;#666&quot;</span>
    <span class="token punctuation">}</span><span class="token selector">,
    </span><span class="token punctuation">{</span>
      <span class="token string">&quot;value&quot;</span><span class="token punctuation">:</span> <span class="token number">97.5</span>,
      <span class="token string">&quot;color&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;#9ee7a1&quot;</span>
    <span class="token punctuation">}</span>
  ]<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>So I defined a JSON array with data objects in my CSS! This rule looks strange but more verbose than the special string before. So now I can remove the <code>_parseData</code> method from the painter class and use <code>JSON.parse</code> instead:</p><pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">BarChartPainter</span> <span class="token punctuation">{</span>
  <span class="token function">paint</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> geom<span class="token punctuation">,</span> props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>

    <span class="token comment">// Much simplier data parsing!</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;--bar-map&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>How is it useful? Now we can get CSS variables in JavaScript, change the data and animate it! Then we need to call <code>JSON.stringify</code> and set the new value. Without JavaScript we can swap the data, on hover for example:</p><pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.bars</span><span class="token pseudo-class">:hover</span> </span><span class="token punctuation">{</span>
  <span class="token selector">--bar-map: [
    </span><span class="token punctuation">{</span>
      <span class="token string">&quot;value&quot;</span><span class="token punctuation">:</span> <span class="token number">5</span>,
      <span class="token string">&quot;color&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;rgba(250, 128, 114, .8)&quot;</span>
    <span class="token punctuation">}</span><span class="token selector">,
    </span><span class="token punctuation">{</span>
      <span class="token string">&quot;value&quot;</span><span class="token punctuation">:</span> <span class="token number">100</span>,
      <span class="token string">&quot;color&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;rgba(102, 51, 153, .9)&quot;</span>
    <span class="token punctuation">}</span><span class="token selector">,
    </span><span class="token punctuation">{</span>
      <span class="token string">&quot;value&quot;</span><span class="token punctuation">:</span> <span class="token number">21</span>,
      <span class="token string">&quot;color&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;hsl(39, 100%, 50%)&quot;</span>
    <span class="token punctuation">}</span><span class="token selector">,
    </span><span class="token punctuation">{</span>
      <span class="token string">&quot;value&quot;</span><span class="token punctuation">:</span> <span class="token number">120</span>,
      <span class="token string">&quot;color&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;#666&quot;</span>
    <span class="token punctuation">}</span><span class="token selector">,
    </span><span class="token punctuation">{</span>
      <span class="token string">&quot;value&quot;</span><span class="token punctuation">:</span> <span class="token number">37</span>,
      <span class="token string">&quot;color&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;#9ee7a1&quot;</span>
    <span class="token punctuation">}</span>
  ]<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p></p><div class="remarkable-youtube-wrapper"><iframe class="remarkable-youtube js-lazy-load" data-src="https://www.youtube.com/embed/toWY6fmpmQg?origin=https://bobrov.dev/&amp;rel=0" frameborder="0" allow="encrypted-media" allowfullscreen></iframe></div><p></p><p><a href="https://github.com/vitaliy-bobrov/css-paint-demos/tree/master/src/bar-js-in-css" target="_blank" rel="nofollow noreferrer noopener">Code</a> and <a href="https://bobrov.dev/css-paint-demos/bar-js-in-css/">demo</a>.</p><p>Now let&#x2019;s try to animate the dataset in JavaScript:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&apos;.bars&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> style <span class="token operator">=</span> <span class="token function">getComputedStyle</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> initialValues <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>style<span class="token punctuation">.</span><span class="token function">getPropertyValue</span><span class="token punctuation">(</span><span class="token string">&apos;--bar-map&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>v <span class="token operator">=&gt;</span> v<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">TIME</span> <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">rand</span><span class="token punctuation">(</span>max<span class="token punctuation">,</span> min<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>max <span class="token operator">-</span> min <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> min<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">animate</span><span class="token punctuation">(</span>values<span class="token punctuation">,</span> time<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> start <span class="token operator">=</span> performance<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> style <span class="token operator">=</span> <span class="token function">getComputedStyle</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>style<span class="token punctuation">.</span><span class="token function">getPropertyValue</span><span class="token punctuation">(</span><span class="token string">&apos;--bar-map&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> fromData <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>v <span class="token operator">=&gt;</span> v<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> increments <span class="token operator">=</span> fromData<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token punctuation">(</span>v <span class="token operator">-</span> values<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> time<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">raf</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> count <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>now <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> value <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>s<span class="token punctuation">,</span>
        value<span class="token punctuation">:</span> fromData<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">(</span>increments<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> count<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    canvas<span class="token punctuation">.</span>style<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">&apos;--bar-map&apos;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>count <span class="token operator">&gt;</span> time<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> final <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
          <span class="token operator">...</span>s<span class="token punctuation">,</span>
          value<span class="token punctuation">:</span> values<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      canvas<span class="token punctuation">.</span>style<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">&apos;--bar-map&apos;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>final<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>raf<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&apos;mouseenter&apos;</span><span class="token punctuation">,</span> event <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> values <span class="token operator">=</span> initialValues<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token function">animate</span><span class="token punctuation">(</span>values<span class="token punctuation">,</span> <span class="token constant">TIME</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&apos;mouseleave&apos;</span><span class="token punctuation">,</span> event <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token function">animate</span><span class="token punctuation">(</span>initialValues<span class="token punctuation">,</span> <span class="token constant">TIME</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>So using <code>requestAnimationFrame</code> on mouse enter I animated the dataset from the initial value to the random data set and in opposite direction on mouse leave. Also, I&#x2019;ve added the <code>--bar-max</code> variable to set the range for the main axis from zero to this value.</p><p></p><div class="remarkable-youtube-wrapper"><iframe class="remarkable-youtube js-lazy-load" data-src="https://www.youtube.com/embed/kUgWZsoyjqU?origin=https://bobrov.dev/&amp;rel=0" frameborder="0" allow="encrypted-media" allowfullscreen></iframe></div><p></p><p><a href="https://github.com/vitaliy-bobrov/css-paint-demos/tree/master/src/bar-animate" target="_blank" rel="nofollow noreferrer noopener">Code</a> and <a href="https://bobrov.dev/css-paint-demos/bar-animate/">demo</a>.</p><p>After all, I&#x2019;ve tried to go further and fetch the JSON file with the custom property of <code>&lt;url&gt;</code> or <code>&lt;image&gt;</code> type. URL type doesn&#x2019;t seem to work, it just got the string value from it. Such resource fetched exclusively when used as a value for properties accepting URLs. The image appears to work but doesn&#x2019;t parse the JSON data as it has only mime types related to image formats in request headers.</p><h2>Recap</h2><p>Today we implemented a basic bar chart, then extend its functionality, tried to use JavaScript in CSS and animate data with <code>requestAnimationFrame</code>. I hope this was awesome, and as I still experimenting with Houdini APIs more exciting posts will come &#x1F60E;. Let&#x2019;s keep in touch &#x1F91F;!</p></section></article><div class="mdl-card mdl-shadow--3dp mdl-cell mdl-cell--12-col comments-widget"><div id="commento"></div></div></main><div aria-live="assertive" aria-atomic="true" aria-relevant="text" class="mdl-snackbar mdl-js-snackbar"><div class="mdl-snackbar__text"></div><button type="button" class="mdl-snackbar__action"></button></div><footer role="contentinfo" class="mdl-mini-footer page-footer"><section class="mdl-mini-footer--left-section page-footer__left-section"><a href="https://twitter.com/bobrov1989" target="_blank" rel="nofollow noreferrer noopener" class="mdl-mini-footer--social-btn" title="Twitter"><svg class="mdl-mini-footer--social-btn__icon"><use xlink:href="#twitter"/></svg> Follow Vitalii Bobrov on Twitter </a><a href="https://github.com/vitaliy-bobrov" target="_blank" rel="nofollow noreferrer noopener" class="mdl-mini-footer--social-btn" title="GitHub"><svg class="mdl-mini-footer--social-btn__icon"><use xlink:href="#github"/></svg> View Vitalii Bobrov profile on GitHub</a></section><section class="mdl-copyright"><p>&copy; 2020 Bobrov Dev</p></section><section class="mdl-mini-footer--right-section page-footer__right-section"></section></footer></div><div class="mdl-layout__obfuscator"></div></div><script src="/js/main.min.js" async defer></script><script defer src="https://cdn.commento.io/js/commento.js" data-css-override="https://bobrov.dev/css/commento.css"></script></body></html>