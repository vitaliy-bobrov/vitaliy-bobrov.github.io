<!doctype html><html lang="en"><head><title>Web Audio for Electric Guitar: Cabinet Emulation | Bobrov Dev</title><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="description" content="Want to know how to emulate top brand guitar amp or cabinet playing on electric guitar in a web browser? Read how to use convolution and Web Audio API to get a great sound."><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="alternate" href="https://bobrov.dev/blog/web-audio-for-electric-guitar-cabinet-emulation/" hreflang="en"><link rel="canonical" href="https://bobrov.dev/blog/web-audio-for-electric-guitar-cabinet-emulation/"><meta name="msapplication-tap-highlight" content="no"><meta name="mobile-web-app-capable" content="yes"><meta name="application-name" content="Bobrov Dev"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="apple-mobile-web-app-title" content="Bobrov Dev"><meta name="msapplication-TileColor" content="#008ba3"><link rel="apple-touch-icon" sizes="180x180" href="/images/icons/apple-touch-icon.png"><link rel="icon" type="image/png" href="/images/icons/favicon-32x32.png" sizes="32x32"><link rel="icon" type="image/png" href="/images/icons/favicon-16x16.png" sizes="16x16"><meta name="theme-color" content="#008ba3"><link rel="manifest" href="/manifest.json"><meta name="google-site-verification" content="-49tfdke4pxwhrBhLHu5VHTk-bb7g9jK_xQuD5Elq2Y"><link rel="preload" as="script" href="https://www.googletagmanager.com/gtag/js?id=UA-90372372-1"><link rel="stylesheet" href="/css/styles.css"><meta property="fb:app_id" content="393821434298248"><meta property="article:author" content="https://www.facebook.com/bobrov1989"><meta property="og:url" content="https://bobrov.dev/blog/web-audio-for-electric-guitar-cabinet-emulation/"><meta property="og:type" content="article"><meta property="og:title" content="Web Audio for Electric Guitar: Cabinet Emulation"><meta property="og:description" content="Want to know how to emulate top brand guitar amp or cabinet playing on electric guitar in a web browser? Read how to use convolution and Web Audio API to get a great sound."><meta property="og:image" content="https://bobrov.dev/images/posts/web-audio-for-electric-guitar-cabinet-emulation/web-audio-for-electric-guitar-cabinet-emulation-og.jpg"><meta property="og:image:url" content="https://bobrov.dev/images/posts/web-audio-for-electric-guitar-cabinet-emulation/web-audio-for-electric-guitar-cabinet-emulation-og.jpg"><meta property="og:image:type" content="image/jpeg"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><script type="application/ld+json">{
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "mainEntityOfPage": "True",
        "headline": "Web Audio for Electric Guitar: Cabinet Emulation",
        "image": [
          "https://bobrov.dev/images/posts/web-audio-for-electric-guitar-cabinet-emulation/web-audio-for-electric-guitar-cabinet-emulation-og.jpg"
        ],
        "datePublished": "2019-06-17156072960000002:00:00+02",
        "dateModified": "2019-07-17156332160000002:00:00+02",
        "author": {
          "@type": "Person",
          "name": "Vitalii Bobrov"
        },
        "publisher": {
          "@type": "Organization",
          "name": "Bobrov Dev",
          "logo": {
            "@type": "ImageObject",
            "url": "https://bobrov.dev/images/logo.png",
            "width": "96",
            "height": "96"
          }
        },
        "description": "Want to know how to emulate top brand guitar amp or cabinet playing on electric guitar in a web browser? Read how to use convolution and Web Audio API to get a great sound."
      }</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-90372372-1"></script><script>if (navigator.doNotTrack !== '1') {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-90372372-1');
      }</script><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@bobrov1989"><meta name="twitter:title" content="Web Audio for Electric Guitar: Cabinet Emulation"><meta name="twitter:description" content="Want to know how to emulate top brand guitar amp or cabinet playing on electric guitar in a web browser? Read how to use convolution and Web Audio API to get a great sound."><meta name="twitter:image" content="https://bobrov.dev/images/posts/web-audio-for-electric-guitar-cabinet-emulation/web-audio-for-electric-guitar-cabinet-emulation-og.jpg"><meta name="twitter:image:alt" content="Web Audio for Electric Guitar: Cabinet Emulation"></head><body class="mdlext-dark-color-theme mdl-layout__container"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="0" height="0" style="position:absolute"><defs><svg viewbox="0 0 24 24" id="arrow-back" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"/><path d="M20 11H7.8l5.6-5.6L12 4l-8 8 8 8 1.4-1.4L7.8 13H20v-2z"/></svg> <svg viewbox="0 0 24 24" id="arrow-forward" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"/></svg> <svg viewbox="0 0 24 24" id="comment" xmlns="http://www.w3.org/2000/svg"><path d="M22 4c0-1-1-2-2-2H4C3 2 2 3 2 4v12c0 1 1 2 2 2h14l4 4V4zm-4 10H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/><path fill="none" d="M0 0h24v24H0z"/></svg> <svg viewbox="0 0 512 512" id="facebook" xmlns="http://www.w3.org/2000/svg"><path fill="currentColor" d="M287 456V157c0-21 6-35 35-35h38V59c-7-1-29-3-55-3-54 0-91 33-91 94v306m143-254H152v72h196"/></svg> <svg viewbox="0 0 512 512" id="github" xmlns="http://www.w3.org/2000/svg"><path fill="currentColor" d="M119 255c17 30 49 48 102 53-8 6-17 17-18 30-10 6-29 8-44 3-21-7-29-48-61-42-7 1-6 6 0 10 10 6 21 16 26 30 12 31 37 39 77 33v45c0 14-20 18-20 25 0 3 7 3 12 3 10 0 32-9 32-23 0-12 0-52 1-59 0-15 8-20 8-20s1 82-2 92c-4 13-10 11-10 17 0 9 26 2 35-17 7-15 4-95 3-94h7s0 37 1 53c0 17-1 39 9 50 7 7 29 19 29 8 0-6-12-12-12-29v-79c10 0 8 26 8 26l1 48s-2 18 19 25c8 3 24 3 25-1s-20-11-20-25v-49c0-36-5-49-22-60 53-5 86-18 102-53 10-20 12-44 12-62 0-50-24-67-29-76 7-38-1-55-5-60-14-5-48 12-66 24-30-9-94-8-118 2-44-31-67-26-67-26s-15 27-4 66c-15 18-25 31-26 65 0 27 3 44 15 67z"/></svg> <svg viewbox="0 0 512 512" id="linkedin" xmlns="http://www.w3.org/2000/svg"><circle cx="104" cy="104" r="48" fill="currentColor"/><path d="M237 178v259M104 178v259" stroke="currentColor" stroke-width="86"/><path d="M279 293c0-26 18-53 48-53 31 0 43 24 43 59v138h86V289c0-80-42-116-99-116-45 0-67 25-78 42" fill="currentColor"/></svg> <svg viewbox="0 0 24 24" id="menu" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg> <svg viewbox="0 0 24 24" id="share" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"/><path d="M18 16c-.8 0-1.4.4-2 .8l-7-4v-1.5l7-4c.5.4 1.2.7 2 .7 1.7 0 3-1.3 3-3s-1.3-3-3-3-3 1.3-3 3v.7l-7 4C7.5 9.4 6.8 9 6 9c-1.7 0-3 1.3-3 3s1.3 3 3 3c.8 0 1.5-.3 2-.8l7.2 4.2v.6c0 1.6 1.2 3 2.8 3 1.6 0 3-1.4 3-3s-1.4-3-3-3z"/></svg> <svg viewbox="0 0 512 512" id="twitter" xmlns="http://www.w3.org/2000/svg"><path fill="currentColor" d="M456 133c-14 7-31 11-47 13 17-10 30-27 37-46-15 10-34 16-52 20-61-62-157-7-141 75-68-3-129-35-169-85-22 37-11 86 26 109-13 0-26-4-37-9 0 39 28 72 65 80-12 3-25 4-37 2 10 33 41 57 77 57-42 30-77 38-122 34 170 111 378-32 359-208 16-11 30-25 41-42z"/></svg></defs></svg><div class="mdl-layout mdl-layout--no-desktop-drawer-button mdl-layout--fixed-header mdl-js-layout"><header class="mdl-layout__header is-casting-shadow" role="banner"><div class="mdl-layout__drawer-button" role="button" tabindex="0" aria-expanded="false"><svg class="mdl-svg drawer-icon"><use xlink:href="#menu"/></svg> Menu</div><div class="mdl-layout__header-row"><span class="mdl-layout-title"><a class="site-link" href="https://bobrov.dev/" rel="nofollow">Bobrov Dev</a></span><div class="mdl-layout-spacer"><a href="https://bobrov.dev/" class="site-logo" title="Bobrov Dev" rel="nofollow"><picture class="site-logo__picture"><source media="(min-width: 1025px)" srcset="/images/logo.webp, /images/logo@2x.webp 2x" type="image/webp"><source media="(min-width: 1025px)" srcset="/images/logo.png, /images/logo@2x.png 2x"><source media="(min-width: 768px)" srcset="/images/logo-tablet.webp, /images/logo-tablet@2x.webp 2x" type="image/webp"><source media="(min-width: 768px)" srcset="/images/logo-tablet.png, /images/logo-tablet@2x.png 2x"><source srcset="/images/logo-mobile.webp, /images/logo-mobile@2x.webp 2x" type="image/webp"><source srcset="/images/logo-mobile.png, /images/logo-mobile@2x.png 2x"><img src="/images/logo.png" alt="Bobrov Dev Logo" loading="eager" class="site-logo__img"></picture></a></div><nav class="mdl-navigation mdl-layout--large-screen-only" aria-label="Main navigation"><a class="mdl-navigation__link mdl-navigation__link_active" href="https://bobrov.dev/" rel="nofollow">Blog</a> <a class="mdl-navigation__link" href="https://bobrov.dev/speaker/">Speaker </a><a class="mdl-navigation__link" href="https://bobrov.dev/about/">About</a></nav></div></header><div class="mdl-layout__drawer"><span class="mdl-layout-title">Bobrov Dev</span><nav class="mdl-navigation" aria-label="Main navigation"><a class="mdl-navigation__link mdl-navigation__link_active" href="https://bobrov.dev/" rel="nofollow" aria-current="page">Blog</a> <a class="mdl-navigation__link" href="https://bobrov.dev/speaker/">Speaker </a><a class="mdl-navigation__link" href="https://bobrov.dev/about/">About </a><button class="mdl-button mdl-button--raised js-add-to-home" disabled>Add to home screen</button></nav></div><div class="mdl-layout__content js-lazy-container"><main class="mdl-grid posts-grid"><article class="mdl-card mdl-shadow--3dp mdl-cell post mdl-cell--12-col"><header class="mdl-card__media post__media"><picture class="safe-picture"><source media="(min-width: 1025px)" srcset="/images/posts/web-audio-for-electric-guitar-cabinet-emulation/web-audio-for-electric-guitar-cabinet-emulation.webp, /images/posts/web-audio-for-electric-guitar-cabinet-emulation/web-audio-for-electric-guitar-cabinet-emulation@2x.webp 2x" type="image/webp"><source media="(min-width: 1025px)" srcset="/images/posts/web-audio-for-electric-guitar-cabinet-emulation/web-audio-for-electric-guitar-cabinet-emulation.jpg, /images/posts/web-audio-for-electric-guitar-cabinet-emulation/web-audio-for-electric-guitar-cabinet-emulation@2x.jpg 2x"><source media="(min-width: 768px)" srcset="/images/posts/web-audio-for-electric-guitar-cabinet-emulation/web-audio-for-electric-guitar-cabinet-emulation-tablet.webp, /images/posts/web-audio-for-electric-guitar-cabinet-emulation/web-audio-for-electric-guitar-cabinet-emulation-tablet@2x.webp 2x" type="image/webp"><source media="(min-width: 768px)" srcset="/images/posts/web-audio-for-electric-guitar-cabinet-emulation/web-audio-for-electric-guitar-cabinet-emulation-tablet.jpg, /images/posts/web-audio-for-electric-guitar-cabinet-emulation/web-audio-for-electric-guitar-cabinet-emulation-tablet@2x.jpg 2x"><source srcset="/images/posts/web-audio-for-electric-guitar-cabinet-emulation/web-audio-for-electric-guitar-cabinet-emulation-mobile.webp, /images/posts/web-audio-for-electric-guitar-cabinet-emulation/web-audio-for-electric-guitar-cabinet-emulation-mobile@2x.webp 2x" type="image/webp"><source srcset="/images/posts/web-audio-for-electric-guitar-cabinet-emulation/web-audio-for-electric-guitar-cabinet-emulation-mobile.jpg, /images/posts/web-audio-for-electric-guitar-cabinet-emulation/web-audio-for-electric-guitar-cabinet-emulation-mobile@2x.jpg 2x"><img src="/images/posts/web-audio-for-electric-guitar-cabinet-emulation/web-audio-for-electric-guitar-cabinet-emulation.jpg" loading="eager" alt="Web Audio for Electric Guitar: Cabinet Emulation" class="safe-picture__img"></picture><div class="safe-gradient"></div><h1 class="post__title">Web Audio for Electric Guitar: Cabinet Emulation</h1></header><section class="post__info post-info"><div class="post-info__data"><picture class="post-info__avatar"><source srcset="/images/authors/bobrov/avatar.webp, /images/authors/bobrov/avatar@2x.webp 2x" type="image/webp"><source srcset="/images/authors/bobrov/avatar.jpg, /images/authors/bobrov/avatar@2x.jpg 2x"><img src="/images/authors/bobrov/avatar.jpg" loading="lazy" alt="Vitalii Bobrov Photo" class="mdl-list__item-avatar"></picture><div class="post-info__data-wrapper"><div class="post-info__author">Vitalii Bobrov</div><time datetime="2019-06-17" class="post-info__date">17 June 2019</time></div></div><div class="post-info__side"><div class="post-info__categories"><a href="/category/guides" class="mdl-chip post-info__category"><span class="mdl-chip__text">Guides</span> </a><a href="/category/web-audio" class="mdl-chip post-info__category"><span class="mdl-chip__text">Web Audio</span></a></div></div></section><div class="mdl-card__menu post-share"><button id="share-menu-0" class="mdl-button mdl-button--icon ripple post-share__button js-share-btn" title="Share this post" aria-label="Share this post" data-share-title="Web Audio for Electric Guitar: Cabinet Emulation" data-share-text="Web Audio for Electric Guitar: Cabinet Emulation by @bobrov1989" data-share-url="https://bobrov.dev/blog/web-audio-for-electric-guitar-cabinet-emulation/"><span class="ripple-ink"></span> <svg class="mdl-svg post-share__icon"><use xlink:href="#share"/></svg> Share post</button><ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu share-menu js-share-menu"><li class="mdl-menu__item share-menu__item"><a href="https://www.facebook.com/sharer.php?u=https://bobrov.dev/blog/web-audio-for-electric-guitar-cabinet-emulation/" class="share-menu__link" target="_blank" rel="nofollow noreferrer noopener"><svg class="share-menu__icon"><use xlink:href="#facebook"/></svg> Facebook</a></li><li class="mdl-menu__item share-menu__item"><a href="https://twitter.com/home?status=https://bobrov.dev/blog/web-audio-for-electric-guitar-cabinet-emulation/" class="share-menu__link" target="_blank" rel="nofollow noreferrer noopener"><svg class="share-menu__icon"><use xlink:href="#twitter"/></svg> Twitter</a></li><li class="mdl-menu__item share-menu__item"><a href="https://linkedin.com/shareArticle?url=https://bobrov.dev/blog/web-audio-for-electric-guitar-cabinet-emulation/" class="share-menu__link" target="_blank" rel="nofollow noreferrer noopener"><svg class="share-menu__icon"><use xlink:href="#linkedin"/></svg> LinkedIn</a></li></ul></div><section class="post__contents"><p>It is hard to imagine a guitarist without any amplifier or guitar cabinet. Even more without any speakers, an electric guitar is hard to hear even at home. Today I want to show how to emulate guitar cabinet using Web Audio API. It is possible to recreate a sound made by top brand amp without the investment of thousands of dollars using convolution.</p><p>In the <a href="https://bobrov.dev/blog/web-audio-for-electric-guitar-how-to-connect-instrument/">previous post</a>, I described the process of getting sound from an electric guitar in a browser using Web Audio. Today I&#x2019;m continuing that series with guitar cabinet emulation.</p><p><em>This post is a part of &#x201C;Web Audio for Electric Guitar&#x201D; series, check out other posts as well!</em></p><h3 class="post__series">Web Audio for Electric Guitar Series:</h3><ol class="post__series"><li><a href="https://bobrov.dev/blog/web-audio-for-electric-guitar-how-to-connect-instrument/">How to Connect Instrument</a></li><li>Cabinet Emulation &#x2013; Current</li><li><a href="https://bobrov.dev/blog/web-audio-for-electric-guitar-distortion">Distortion</a></li></ol><p>While playing on electric guitar at home, it usually connected to an individual device &#x2013; amplifier or head with a cabinet. There are a lot of famous amp producers, and each of them has its own &#x201C;firm&#x201D; sound. However, using digital sound processing, it is possible to emulate them programmatically using a process called <em>convolution</em>. For simplicity, you can imagine convolution as a multiplication of two functions. When we are speaking about sound convolution mean the application of some sample to the live input. To simulate a guitar cabinet, we need to apply such a short sample recorded from real device to guitar sound. That samples called <em>impulse response</em> (IR).</p><h2>Impulse Response</h2><p>An impulse response is a recording of an amp impulse characteristics such as amplitude or frequency. For example, a photo is a snapshot of a light that the camera got on a film or digital matrix at some point. You can think about impulse response in the same way. It is a snapshot of a live speaker.</p><p class="js-lazy-load"><img src="/images/posts/web-audio-for-electric-guitar-cabinet-emulation/img/amp-config-panel.jpg" alt="AMP config panel"></p><p>Unfortunately, that snapshot is limited to only one particular setting is recorded. What I mean by this is that on the real amplifier, you have a bunch of controls like volume or equalizer, and depending on amp configuration, you get different impulse response. So you can only simulate a device with a particular configuration. However, we can implement equalizer using Web Audio as well. Equalization gives us some flexibility to get the sound shape we want.</p><h2>Convolver Node</h2><p>Now we have an idea what we want to perform, and it is time to learn how to implement that using Web Audio API. The API hides much heavy math behind nodes it provides. Convolution is not an exception &#x2013; we have a Convolver Node to apply impulse response to audio stream:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AudioContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> convolver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConvolverNode</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>The convolver node has a <code>buffer</code> option that is used to pass an impulse response audio buffer. You must load an audio file with the IR in a format browser understands. Modern browsers support different formats that happened because of those formats licensing. Modern browsers have excellent support of WAV (all except IE, that doesn&#x2019;t support Web Audio as well), AAC (Firefox supports it only in an MP4 container), MP3, FLAC, and OGG (all except IE and Safari). I considered staying with WAV as it is well-supported and is a lossless audio format. The quality is essential here because we are using a very short &#x2013; just a few bytes recordings and the compression could create artifacts in the output.</p><p>If you want to provide various file formats depending on the current browser you can check the support:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> audio <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&apos;audio&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>audio<span class="token punctuation">.</span><span class="token function">canPlayType</span><span class="token punctuation">(</span><span class="token string">&apos;audio/wav&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;maybe&quot;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>audio<span class="token punctuation">.</span><span class="token function">canPlayType</span><span class="token punctuation">(</span><span class="token string">&apos;audio/wav&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;The format is not supported!&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>All browsers, including IE 9+ support &#x2018;canPlayType&#x2019; method. It returns a string with 3 possible values: <code>&apos;maybe&apos;</code>, <code>&apos;probably&apos;</code>, and <code>&apos;&apos;</code>. Yes, it couldn&#x2019;t give you an exact answer &#x1F923;, only probabilistic one. The empty string means that the format is not supported. <code>&apos;maybe&apos;</code> &#x2013; can&#x2019;t answer without starting playback, and <code>&apos;probably&apos;</code> &#x2013; seems to be possible.</p><p class="js-lazy-load"><img src="/images/posts/web-audio-for-electric-guitar-cabinet-emulation/img/studio.jpg" alt="Real recording studio"></p><p>You might have a reasonable question where you can get those cabinets to impulse responses? You can &quot;do it your self&quot;&#x2122;&#xFE0F; &#x2013; but this variant requires you to have a cabinet itself and a bunch of additional equipment, like capacitor microphone, professional audio card, and so far and so forth. Luckily there are a lot of free high-quality impulse responses made by professional studios and enthusiasts. Just google for &quot;<a href="https://www.google.com/search?q=free+cabinet+impulse+response&amp;rlz=1C5CHFA_enUA690UA690&amp;oq=free+cabinet+impulse+response" target="_blank" rel="nofollow noreferrer noopener">free cabinet impulse response</a>&quot; to find and download one. If you are too lazy you can check the <a href="https://github.com/vitaliy-bobrov/js-rocks/tree/master/src/assets/impulses/cabinet" target="_blank" rel="nofollow noreferrer noopener">impulses</a> I&#x2019;m using for a &quot;<a href="https://js-rocks.web.app" target="_blank" rel="nofollow noreferrer noopener">JS Rocks</a>&quot; app.</p><p>After we have an IR to work with, we can load and apply it to the Convolver Node using audio context and Fetch API:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> convolver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConvolverNode</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&apos;impulse.wav&apos;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">arrayBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>buffer <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    context<span class="token punctuation">.</span><span class="token function">decodeAudioData</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> decoded <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    convolver<span class="token punctuation">.</span>buffer <span class="token operator">=</span> decoded<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p><em>Note: it is essential to disconnect/connect Convolver Node after a new buffer set if you want to re-use the same node few times. If you set a new buffer on the connected node the old buffer will be used, and possibly you get audio glitches.</em></p><p>We fetched the impulse response file, then transform the response into array buffer. We can&#x2019;t apply that buffer directly on convolver, before that we need to decode it using context. When convolver configured you can chain it in your audio processing graph:</p><pre class="language-js"><code class="language-js">guitarInput<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>convolver<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>destination<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>Some IR could have a low amplitude, so after you apply it, they might reduce the overall volume. In this case, you can boost it using a Gain Node:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> makeUpGain <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GainNode</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token comment">// Need to be adjusted to a particular IR.</span>
  gain<span class="token punctuation">:</span> <span class="token number">5</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

guitarInput
  <span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>convolver<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>makeUpGain<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>destination<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>The gain value needs to be adjusted manually for a particular impulse response. It is also good to expose that configuration in the user interface with some control like range input.</p><h2>Three-band Equalizer</h2><p>The last feature I want to add to cabinet emulation is a three-band equalizer. It gives us the tone control of the output. We want to create a configurable filter for bass, middle and treble frequencies. All below 500 Hz will is related to bass, between 500 Hz and 3 KHz to the middle, and above 3000 Hz to treble.</p><p class="js-lazy-load"><img src="/images/posts/web-audio-for-electric-guitar-cabinet-emulation/img/3-band-equalizer.jpg" alt="Three-band equalizer frequencies split"></p><p>How can we increase the output of particular frequencies using Web Audio? We have a great node for that &#x2013; Biquad Filter Node. It is an implementation of a group of filters, that could be specified by provided type value. For bass control, we pick a <code>&apos;lowshelf&apos;</code> filter. It will increase the level of all frequencies below passed one. For treble, we use the opposite type &#x2013; <code>&apos;highshelf&apos;</code>. It boosts everything above the passed value. Moreover, for middle, we choose <code>&apos;peaking&apos;</code> type. It boosts frequencies around passed value &#x2013; the range of the band controlled by the <code>Q</code> (filter quality) parameter. Attenuation or boost for each band changed by gain parameter. It is an amount of level change in dB applied to the frequencies, using negative values we attenuate it, using positive &#x2013; boosting.</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> bassNode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BiquadFilterNode</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> <span class="token string">&apos;lowshelf&apos;</span><span class="token punctuation">,</span>
  frequency<span class="token punctuation">:</span> <span class="token number">500</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> midNode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BiquadFilterNode</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> <span class="token string">&apos;peaking&apos;</span><span class="token punctuation">,</span>
  <span class="token constant">Q</span><span class="token punctuation">:</span> Math<span class="token punctuation">.</span><span class="token constant">SQRT1_2</span><span class="token punctuation">,</span>
  frequency<span class="token punctuation">:</span> <span class="token number">1500</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> trebleNode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BiquadFilterNode</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> <span class="token string">&apos;highshelf&apos;</span><span class="token punctuation">,</span>
  frequency<span class="token punctuation">:</span> <span class="token number">3000</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Decreasing bass level by 10 dB.</span>
bassNode<span class="token punctuation">.</span>gain<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">;</span>

<span class="token comment">// Increasing middle level by 15 dB.</span>
midNode<span class="token punctuation">.</span>gain<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span>

<span class="token comment">// No boost.</span>
trebleNode<span class="token punctuation">.</span>gain<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre><p>To prevent click on gain value updates it is possible to use <code>setTargetAtTime</code> update method:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> level <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> duration <span class="token operator">=</span> <span class="token number">0.01</span><span class="token punctuation">;</span>

midNode<span class="token punctuation">.</span>gain<span class="token punctuation">.</span><span class="token function">setTargetAtTime</span><span class="token punctuation">(</span>level<span class="token punctuation">,</span> context<span class="token punctuation">.</span>currentTime<span class="token punctuation">,</span> duration<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>Now we can connect all the nodes to have a flexible guitar cabinet emulation:</p><pre class="language-js"><code class="language-js">guitarInput
  <span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>convolver<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>makeUpGain<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>bassNode<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>midNode<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>trebleNode<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>destination<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>I&#x2019;ve recorded an example video showing how convolution affects the output sound. It might not have a significant impact on a clean signal, but if some distortion effect applied, it is much more noticeable.</p><p></p><div class="remarkable-youtube-wrapper"><iframe class="remarkable-youtube js-lazy-load" data-src="https://www.youtube.com/embed/0KK6D2h7RgU?origin=https://bobrov.dev/&amp;rel=0" frameborder="0" allow="encrypted-media" allowfullscreen></iframe></div><p></p><h2>Recap</h2><p>If you read that post to that point, you learned how to emulate a guitar amp using convolution, and create a three-band equalizer to configure tone. If you are playing guitar, you can check out the <a href="http://js-rocks.web.app" target="_blank" rel="nofollow noreferrer noopener">&#x201C;JS Rocks&#x201D;</a> Angular app I&#x2019;ve built. It has 9&#x203C;&#xFE0F; of ready-to-use cabinets and 7 effects for electric guitar created with Web Audio. Moreover, it sounds well &#x1F60E;. Stay tuned in the next post I&#x2019;m going to make a deep dive into <a href="https://bobrov.dev/blog/web-audio-for-electric-guitar-distortion">distortion effects</a>. Rock it with Web Audio &#x1F918;!</p></section></article><div class="mdl-card mdl-shadow--3dp mdl-cell mdl-cell--12-col comments-widget"><div id="commento"></div></div></main><div aria-live="assertive" aria-atomic="true" aria-relevant="text" class="mdl-snackbar mdl-js-snackbar"><div class="mdl-snackbar__text"></div><button type="button" class="mdl-snackbar__action"></button></div><footer role="contentinfo" class="mdl-mini-footer page-footer"><section class="mdl-mini-footer--left-section page-footer__left-section"><a href="https://twitter.com/bobrov1989" target="_blank" rel="nofollow noreferrer noopener" class="mdl-mini-footer--social-btn" title="Twitter"><svg class="mdl-mini-footer--social-btn__icon"><use xlink:href="#twitter"/></svg> Follow Vitalii Bobrov on Twitter </a><a href="https://github.com/vitaliy-bobrov" target="_blank" rel="nofollow noreferrer noopener" class="mdl-mini-footer--social-btn" title="GitHub"><svg class="mdl-mini-footer--social-btn__icon"><use xlink:href="#github"/></svg> View Vitalii Bobrov profile on GitHub</a></section><section class="mdl-copyright"><p>&copy; 2019 Bobrov Dev</p></section><section class="mdl-mini-footer--right-section page-footer__right-section"></section></footer></div><div class="mdl-layout__obfuscator"></div></div><script src="/js/main.min.js" async defer></script><script defer src="https://cdn.commento.io/js/commento.js" data-css-override="https://bobrov.dev/css/commento.css"></script></body></html>