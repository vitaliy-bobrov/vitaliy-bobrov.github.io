<!doctype html><html lang="en"><head><title>CSS Paint in Action: Bar Chart | Bobrov Blog</title><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="description" content="Want to know how to create bar chart with CSS Paint API?."><meta name="viewport" content="width=device-width,initial-scale=1,minimal-ui"><link rel="canonical" href="https://vitaliy-bobrov.github.io/blog/css-paint-in-action-charts"><meta name="msapplication-tap-highlight" content="no"><meta name="mobile-web-app-capable" content="yes"><meta name="application-name" content="Bobrov Blog"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="apple-mobile-web-app-title" content="Bobrov Blog"><meta name="msapplication-TileColor" content="#00bcd4"><link rel="apple-touch-icon" sizes="180x180" href="/images/icons/apple-touch-icon.png"><link rel="icon" type="image/png" href="/images/icons/favicon-32x32.png" sizes="32x32"><link rel="icon" type="image/png" href="/images/icons/favicon-16x16.png" sizes="16x16"><meta name="theme-color" content="#00bcd4"><link rel="manifest" href="/manifest.json"><meta name="google-site-verification" content="-49tfdke4pxwhrBhLHu5VHTk-bb7g9jK_xQuD5Elq2Y"><link rel="preload" as="script" href="https://www.google-analytics.com/analytics.js"><link rel="preload" as="font" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,500,700"><link rel="preload" as="font" href="https://fonts.googleapis.com/css?family=Roboto+Mono"><link rel="stylesheet" href="/css/styles.css"><meta property="fb:app_id" content="393821434298248"><meta property="article:author" content="https://www.facebook.com/bobrov1989"><meta property="og:url" content="https://vitaliy-bobrov.github.io/blog/css-paint-in-action-charts/"><meta property="og:type" content="article"><meta property="og:title" content="CSS Paint in Action: Bar Chart"><meta property="og:description" content="Want to know how to create bar chart with CSS Paint API?."><meta property="og:image" content="https://vitaliy-bobrov.github.io/images/posts/css-paint-in-action-bar-chart/css-paint-in-action-bar-chart-og.jpg"><meta property="og:image:url" content="https://vitaliy-bobrov.github.io/images/posts/css-paint-in-action-bar-chart/css-paint-in-action-bar-chart-og.jpg"><meta property="og:image:type" content="image/jpeg"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><script type="application/ld+json">{
        "@context": "http://schema.org",
        "@type": "NewsArticle",
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "https://google.com/article"
        },
        "headline": "CSS Paint in Action: Bar Chart",
        "image": [
          "https://vitaliy-bobrov.github.io/images/posts/css-paint-in-action-bar-chart/css-paint-in-action-bar-chart-og.jpg"
        ],
        "datePublished": "2018-03-19T01:00:00+01:00",
        "dateModified": "2018-03-19T01:00:00+01:00",
        "author": {
          "@type": "Person",
          "name": "Vitalii Bobrov"
        },
         "publisher": {
          "@type": "Organization",
          "name": "Bobrov Blog",
          "logo": {
            "@type": "ImageObject",
            "url": "https://vitaliy-bobrov.github.io/images/logo/.png",
            "width": "96",
            "height": "96"
          }
        },
        "description": "Want to know how to create bar chart with CSS Paint API?."
      }</script><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@bobrov1989"><meta name="twitter:title" content="CSS Paint in Action: Bar Chart"><meta name="twitter:description" content="Want to know how to create bar chart with CSS Paint API?."><meta name="twitter:image" content="https://vitaliy-bobrov.github.io/images/posts/css-paint-in-action-bar-chart/css-paint-in-action-bar-chart-og.jpg"><meta name="twitter:image:alt" content="CSS Paint in Action: Bar Chart"></head><body class="mdlext-dark-color-theme"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="0" height="0" style="position:absolute"><defs><svg viewbox="0 0 24 24" id="arrow-back" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"/><path d="M20 11H7.8l5.6-5.6L12 4l-8 8 8 8 1.4-1.4L7.8 13H20v-2z"/></svg> <svg viewbox="0 0 24 24" id="arrow-forward" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"/></svg> <svg viewbox="0 0 24 24" id="comment" xmlns="http://www.w3.org/2000/svg"><path d="M22 4c0-1-1-2-2-2H4C3 2 2 3 2 4v12c0 1 1 2 2 2h14l4 4V4zm-4 10H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/><path fill="none" d="M0 0h24v24H0z"/></svg> <svg viewbox="0 0 24 24" id="expand-less" xmlns="http://www.w3.org/2000/svg"><path d="M12 8l-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"/></svg> <svg viewbox="0 0 512 512" id="facebook" xmlns="http://www.w3.org/2000/svg"><path d="M287 456V157c0-21 6-35 35-35h38V59c-7-1-29-3-55-3-54 0-91 33-91 94v306m143-254H152v72h196"/></svg> <svg viewbox="0 0 512 512" id="github" xmlns="http://www.w3.org/2000/svg"><path d="M119 255c17 30 49 48 102 53-8 6-17 17-18 30-10 6-29 8-44 3-21-7-29-48-61-42-7 1-6 6 0 10 10 6 21 16 26 30 12 31 37 39 77 33v45c0 14-20 18-20 25 0 3 7 3 12 3 10 0 32-9 32-23 0-12 0-52 1-59 0-15 8-20 8-20s1 82-2 92c-4 13-10 11-10 17 0 9 26 2 35-17 7-15 4-95 3-94h7s0 37 1 53c0 17-1 39 9 50 7 7 29 19 29 8 0-6-12-12-12-29v-79c10 0 8 26 8 26l1 48s-2 18 19 25c8 3 24 3 25-1s-20-11-20-25v-49c0-36-5-49-22-60 53-5 86-18 102-53 10-20 12-44 12-62 0-50-24-67-29-76 7-38-1-55-5-60-14-5-48 12-66 24-30-9-94-8-118 2-44-31-67-26-67-26s-15 27-4 66c-15 18-25 31-26 65 0 27 3 44 15 67z"/></svg> <svg viewbox="0 0 512 512" id="google-plus" xmlns="http://www.w3.org/2000/svg"><path d="M56 257a126 126 0 0 1 212-96l-33 33c-21-13-49-24-75-14a80 80 0 1 0 54 151c21-8 35-28 41-48l-72-1v-44h122c1 36-3 74-27 102a127 127 0 0 1-222-83zm327-56h36l1 37h36v37h-36l-1 36h-36v-36h-37v-37h37z"/></svg> <svg viewbox="0 0 512 512" id="linkedin" xmlns="http://www.w3.org/2000/svg"><circle cx="104" cy="104" r="48"/><path d="M237 178v259M104 178v259" stroke="currentColor" stroke-width="86"/><path d="M279 293c0-26 18-53 48-53 31 0 43 24 43 59v138h86V289c0-80-42-116-99-116-45 0-67 25-78 42"/></svg> <svg viewbox="0 0 24 24" id="menu" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg> <svg viewbox="0 0 24 24" id="share" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"/><path d="M18 16c-.8 0-1.4.4-2 .8l-7-4v-1.5l7-4c.5.4 1.2.7 2 .7 1.7 0 3-1.3 3-3s-1.3-3-3-3-3 1.3-3 3v.7l-7 4C7.5 9.4 6.8 9 6 9c-1.7 0-3 1.3-3 3s1.3 3 3 3c.8 0 1.5-.3 2-.8l7.2 4.2v.6c0 1.6 1.2 3 2.8 3 1.6 0 3-1.4 3-3s-1.4-3-3-3z"/></svg> <svg viewbox="0 0 512 512" id="twitter" xmlns="http://www.w3.org/2000/svg"><path d="M456 133c-14 7-31 11-47 13 17-10 30-27 37-46-15 10-34 16-52 20-61-62-157-7-141 75-68-3-129-35-169-85-22 37-11 86 26 109-13 0-26-4-37-9 0 39 28 72 65 80-12 3-25 4-37 2 10 33 41 57 77 57-42 30-77 38-122 34 170 111 378-32 359-208 16-11 30-25 41-42z"/></svg></defs></svg><div class="mdl-layout mdl-layout--no-desktop-drawer-button mdl-layout--fixed-header mdl-js-layout"><header class="mdl-layout__header" role="banner"><div class="mdl-layout__header-row"><span class="mdl-layout-title"><a class="site-link" href="/">Bobrov Blog</a></span><div class="mdl-layout-spacer"><a href="/" class="site-logo" title="Bobrov Blog"><picture class="site-logo__picture"><source media="(min-width: 1025px)" srcset="/images/logo.webp, /images/logo@2x.webp 2x" type="image/webp"><source media="(min-width: 1025px)" srcset="/images/logo.png, /images/logo@2x.png 2x"><source media="(min-width: 768px)" srcset="/images/logo-tablet.webp, /images/logo-tablet@2x.webp 2x" type="image/webp"><source media="(min-width: 768px)" srcset="/images/logo-tablet.png, /images/logo-tablet@2x.png 2x"><source srcset="/images/logo-mobile.webp, /images/logo-mobile@2x.webp 2x" type="image/webp"><source srcset="/images/logo-mobile.png, /images/logo-mobile@2x.png 2x"><img src="/images/logo.png" alt="Bobrov Blog Logo" class="site-logo__img" itemprop="logo"></picture></a></div><nav class="mdl-navigation mdl-layout--large-screen-only"><a class="mdl-navigation__link" href="/">Blog</a> <a class="mdl-navigation__link" href="/speaker/">Speaker </a><a class="mdl-navigation__link" href="/about/">About</a></nav></div></header><div class="mdl-layout__drawer"><span class="mdl-layout-title">Bobrov Blog</span><nav class="mdl-navigation"><a class="mdl-navigation__link" href="/" aria-current="page">Blog</a> <a class="mdl-navigation__link" href="/speaker/">Speaker</a> <a class="mdl-navigation__link" href="/about/">About</a></nav></div><main class="mdl-layout__content js-to-top-container"><section class="mdl-grid posts-grid"><article class="mdl-card mdl-shadow--3dp mdl-cell post mdl-cell--12-col"><header class="mdl-card__media post__media"><picture class="safe-picture"><source media="(min-width: 1025px)" srcset="/images/posts/css-paint-in-action-bar-chart/css-paint-in-action-bar-chart.webp, /images/posts/css-paint-in-action-bar-chart/css-paint-in-action-bar-chart@2x.webp 2x" type="image/webp"><source media="(min-width: 1025px)" srcset="/images/posts/css-paint-in-action-bar-chart/css-paint-in-action-bar-chart.jpg, /images/posts/css-paint-in-action-bar-chart/css-paint-in-action-bar-chart@2x.jpg 2x"><source media="(min-width: 768px)" srcset="/images/posts/css-paint-in-action-bar-chart/css-paint-in-action-bar-chart-tablet.webp, /images/posts/css-paint-in-action-bar-chart/css-paint-in-action-bar-chart-tablet@2x.webp 2x" type="image/webp"><source media="(min-width: 768px)" srcset="/images/posts/css-paint-in-action-bar-chart/css-paint-in-action-bar-chart-tablet.jpg, /images/posts/css-paint-in-action-bar-chart/css-paint-in-action-bar-chart-tablet@2x.jpg 2x"><source srcset="/images/posts/css-paint-in-action-bar-chart/css-paint-in-action-bar-chart-mobile.webp, /images/posts/css-paint-in-action-bar-chart/css-paint-in-action-bar-chart-mobile@2x.webp 2x" type="image/webp"><source srcset="/images/posts/css-paint-in-action-bar-chart/css-paint-in-action-bar-chart-mobile.jpg, /images/posts/css-paint-in-action-bar-chart/css-paint-in-action-bar-chart-mobile@2x.jpg 2x"><img src="/images/posts/css-paint-in-action-bar-chart/css-paint-in-action-bar-chart.jpg" alt="CSS Paint in Action: Bar Chart" class="safe-picture__img"></picture><div class="safe-gradient"></div><h1 class="post__title">CSS Paint in Action: Bar Chart</h1></header><section class="post__info post-info"><div class="post-info__data"><picture class="post-info__avatar"><source srcset="/images/authors/bobrov/avatar.webp, /images/authors/bobrov/avatar@2x.webp 2x" type="image/webp"><source srcset="/images/authors/bobrov/avatar.jpg, /images/authors/bobrov/avatar@2x.jpg 2x"><img src="/images/authors/bobrov/avatar.jpg" alt="Vitalii Bobrov Photo" class="mdl-list__item-avatar"></picture><div class="post-info__data-wrapper"><div class="post-info__author">Vitalii Bobrov</div><time date-time="2018-03-19T01:00:00+01:00" class="post-info__date">19 March 2018</time></div></div><div class="post-info__side"><div class="post-info__categories"><a href="/category/css" class="mdl-chip post-info__category"><span class="mdl-chip__text">CSS</span> </a><a href="/category/houdini" class="mdl-chip post-info__category"><span class="mdl-chip__text">Houdini</span></a></div></div></section><div class="mdl-card__menu post-share"><button id="share-menu-[object Object]" class="mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect post-share__button js-share-btn" title="Share this post" aria-label="Share this post" data-share-title="CSS Paint in Action: Bar Chart" data-share-text="Want to know how to create bar chart with CSS Paint API?." data-share-url="https://vitaliy-bobrov.github.io/blog/css-paint-in-action-charts"><svg class="mdl-svg post-share__icon"><use xlink:href="#share"/></svg></button><ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect share-menu js-share-menu"><li class="mdl-menu__item share-menu__item"><a href="//www.facebook.com/sharer.php?u=https://vitaliy-bobrov.github.io/blog/css-paint-in-action-charts" class="share-menu__link" target="_blank" rel="nofollow noreferrer noopener"><svg class="share-menu__icon"><use xlink:href="#facebook"/></svg> Facebook</a></li><li class="mdl-menu__item share-menu__item"><a href="//twitter.com/home?status=https://vitaliy-bobrov.github.io/blog/css-paint-in-action-charts" class="share-menu__link" target="_blank" rel="nofollow noreferrer noopener"><svg class="share-menu__icon"><use xlink:href="#twitter"/></svg> Twitter</a></li><li class="mdl-menu__item share-menu__item"><a href="//linkedin.com/shareArticle?url=https://vitaliy-bobrov.github.io/blog/css-paint-in-action-charts" class="share-menu__link" target="_blank" rel="nofollow noreferrer noopener"><svg class="share-menu__icon"><use xlink:href="#linkedin"/></svg> LinkedIn</a></li><li class="mdl-menu__item share-menu__item"><a href="//plus.google.com/share?url=https://vitaliy-bobrov.github.io/blog/css-paint-in-action-charts" class="share-menu__link" target="_blank" rel="nofollow noreferrer noopener"><svg class="share-menu__icon"><use xlink:href="#google-plus"/></svg> Goggle+</a></li></ul></div><section class="post__contents"><p>In my <a href="/blog/exploring-the-css-paint-api/">previous article</a> we discovered CSS Paint API basics and main principles. Today, with this knowledge arsenal we are going to create data visualizations that could be used in production projects – bar chart. More than 65% of the humans are visual learners. Visualization makes it easier to understand, compare, and analyze data. Using CSS Paint API, we can encapsulate all logic related to drawing charts on canvas and expose the high-level declarative interface.</p><p>The most uncomplicated graph we can create is a bar chart. It is the set of rectangles, possibly with a different background color, and the size of each box represents its value compared to the others. Usually, the maximum dataset value is taken as the 100% on the target axis. So in our example, we will use the range from zero to the maximum amount of them given dataset for values axis, as in 90% cases this is what we need to implement. On the secondary axis, we will linearly distribute our bars and separate them with the gap in pixels specified by the passed argument.</p><p>To create custom painter we need to follow three easy steps: declare a custom paint class, register paint, and load worklet. So let’s start with the painter class definition:</p><pre class="lang-highlight"><code class="language-js lang-ts"><span class="hljs-keyword">class</span> BarChartPainter {
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">get</span> inputProperties() {
    <span class="hljs-keyword">return</span> [
      <span class="hljs-string">'--bar-map'</span>,
      <span class="hljs-string">'--bar-gap'</span>
    ];
  }

  paint(ctx, geom, props) {
    <span class="hljs-comment">// Here will be our paint implementation.</span>
  }
}
</code></pre><p class="lang-highlight">So, for now, our <code>paint</code> method does nothing, the only thing we declared is the static <code>inputProperties</code> getter. This getter will return the list of CSS variable our painter relies on, that means that after each change of the value of this variables browser will call our <code>paint</code> method.</p><h2>Dataset</h2><p class="lang-highlight">Our first variable stands for dataset we will use to draw the chart. My first thought was to use Custom Properties API from Houdini for them and use something like <code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-title">color-stop</span>&gt;</span></code> type. <code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-title">color-stop</span>&gt;</span></code> is the pair of percentage or length value and CSS color. Value and color are separated by spaces. The list of <code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-title">color-stop</span>&gt;</span></code> value used for <code>linear-gradient</code> function, to declare that we want to use a list of Typed OM values we need to add <code>+</code> at the end of type declaration – <code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-title">color-stop</span>&gt;</span>+</code>. Unfortunately for now <code class="lang-css"><span class="hljs-tag">CSS</span><span class="hljs-class">.registerProperty</span></code> doesn’t support lists and <code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-title">color-stop</span>&gt;</span></code> type.</p><pre class="lang-highlight"><code class="language-js lang-js">CSS.registerProperty({
  name: <span class="hljs-string">'--data-points'</span>,
  syntax: <span class="hljs-string">'&lt;color-stop&gt;'</span>,
  inherits: <span class="hljs-literal">false</span>
});

CSS.registerProperty({
  name: <span class="hljs-string">'--data-colors'</span>,
  syntax: <span class="hljs-string">'&lt;color&gt;+'</span>,
  inherits: <span class="hljs-literal">false</span>
});

Uncaught DOMException: Failed to execute <span class="hljs-string">'registerProperty'</span> on <span class="hljs-string">'CSS'</span>:
The syntax provided is not a valid custom property syntax.
</code></pre><p class="lang-highlight">Such argument will cause <code>DOMException</code> errors. After my initial idea failed, I decided to follow with CSS variable with special syntax. CSS variables are just strings that will be interpolated in place they are used.</p><pre class="lang-highlight"><code class="language-css lang-css"><span class="hljs-class">.hello-var</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">--my-varialbe</span>:<span class="hljs-value"> <span class="hljs-string">'hello world'</span></span></span>;
}</span>

<span class="hljs-class">.hello-var</span><span class="hljs-pseudo">:after</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">content</span>:<span class="hljs-value"> <span class="hljs-function">var</span>(--my-varialbe)</span></span>;
}</span>
</code></pre><p class="lang-highlight">Text “hello world” will be used as the value for <code>after</code> pseudo-element <code>content</code> property. That is completely equivalent to:</p><pre class="lang-highlight"><code class="language-css lang-css"><span class="hljs-class">.hello-var</span><span class="hljs-pseudo">:after</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">content</span>:<span class="hljs-value"> <span class="hljs-string">'hello world'</span></span></span>;
}</span>
</code></pre><p class="lang-highlight">So I decided to use <code class="lang-ts"><span class="hljs-built_in">number</span></code> and <code>color</code> pairs delimited by a comma. Each number will represent the value for bar and color will be used for the background. This implementation has a big issue as we can’t use commas in color or value. I think it is ok for now to stay with that, as I wouldn’t to complicate tutorial with <code>RexExp</code>. Here how our data set should look like:</p><pre class="lang-highlight"><code class="language-css lang-css"><span class="hljs-class">.bars</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">--bar-map</span>:<span class="hljs-value"> <span class="hljs-number">50</span> <span class="hljs-hexcolor">#666</span>, <span class="hljs-number">70</span> salmon, <span class="hljs-number">35</span> <span class="hljs-hexcolor">#9ee7a1</span>, <span class="hljs-number">15</span> <span class="hljs-hexcolor">#fff</span>, <span class="hljs-number">25</span> orange</span></span>;
}</span>
</code></pre><h2>Data parsing</h2><p>After input format decision made we can implement helper method to parse it in our painter class:</p><pre class="lang-highlight"><code class="language-js lang-js"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BarChartPainter</span> </span>{
  _parseData(input) {
    <span class="hljs-keyword">return</span> input.toString()
    .split(<span class="hljs-string">','</span>)
    .map(entry =&gt; {
      <span class="hljs-keyword">const</span> [value, color] = entry.trim().split(<span class="hljs-string">' '</span>);

      <span class="hljs-keyword">return</span> {
        value: <span class="hljs-built_in">parseFloat</span>(value, <span class="hljs-number">10</span>) || <span class="hljs-number">0</span>,
        color: color || <span class="hljs-string">'black'</span>
      };
    });
  }
}
</code></pre><p>Nothing special here, we pass our CSS variable input and transform to the list of objects. Additionally, we added fallbacks for value and color. Next, we will add the helper method to get the maximum value from given dataset:</p><pre class="lang-highlight"><code class="language-js lang-js"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BarChartPainter</span> </span>{
  _getMax(dataset) {
    <span class="hljs-keyword">return</span> dataset.reduce((maxVal, entry) =&gt; {
      <span class="hljs-keyword">return</span> maxVal &lt; entry.value ? entry.value : maxVal;
    }, <span class="hljs-number">0</span>);
  }
}
</code></pre><h2>Drawing bars</h2><p class="lang-highlight">For the beginning let’s make vertical bars, other orientation support will be in our “To Do” list. We are going to implement main – <code>paint</code> method:</p><pre class="lang-highlight"><code class="language-js lang-js"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BarChartPainter</span> </span>{
  paint(ctx, {width, height}, props) {
    <span class="hljs-keyword">const</span> gap = <span class="hljs-built_in">parseInt</span>(
      (props.get(<span class="hljs-string">'--bar-gap'</span>) || <span class="hljs-number">10</span>).toString(),
      <span class="hljs-number">10</span>
    );
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">this</span>._parseData(props.get(<span class="hljs-string">'--bar-map'</span>));
    <span class="hljs-keyword">const</span> max = <span class="hljs-keyword">this</span>._getMax(data);
    <span class="hljs-keyword">const</span> multiplier = height / max;
    <span class="hljs-keyword">const</span> barW = (width - (gap * (data.length - <span class="hljs-number">1</span>))) / data.length;

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; data.length; i++) {
      <span class="hljs-keyword">const</span> x = i * (barW + gap);
      <span class="hljs-keyword">const</span> barHeight = data[i].value * multiplier;
      <span class="hljs-keyword">const</span> y = domain - barHeight;

      ctx.fillStyle = data[i].color;

      ctx.fillRect(x, y, barW, barHeight);
    }
  }
}
</code></pre><p class="lang-highlight">Let’s look at this method line-by-line. First of all get trying to get <code>--bar-gap</code> variable and parse it as an integer. If no gap defined <code class="lang-js">props.get(<span class="hljs-string">'--bar-gap'</span>)</code> will return <code class="lang-js"><span class="hljs-literal">null</span></code> so we were providing fallback value before calling <code>toString</code>. Then we are parsing our dataset stored in <code>--bar-map</code> variable and getting the maximum value using helpers we defined before. Then we were calculating how much height should be one value point by dividing canvas height by maximum value. After that, we were calculating the width of each bar. And finally, we are iterating our dataset and draw rectangles for each of the value.</p><p>Now we are ready to register our paint:</p><pre class="lang-highlight"><code class="language-js lang-js">registerPaint(<span class="hljs-string">'bar-chart'</span>, BarChartPainter);
</code></pre><p>Here is the full content of our worklet JavaScript file:</p><pre class="lang-highlight"><code class="language-js lang-ts"><span class="hljs-keyword">class</span> BarChartPainter {
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">get</span> inputProperties() {
    <span class="hljs-keyword">return</span> [
      <span class="hljs-string">'--bar-map'</span>,
      <span class="hljs-string">'--bar-gap'</span>
    ];
  }

  _parseData(input) {
    <span class="hljs-keyword">return</span> input.toString()
    .split(<span class="hljs-string">','</span>)
    .map(entry =&gt; {
      <span class="hljs-keyword">const</span> [value, color] = entry.trim().split(<span class="hljs-string">' '</span>);

      <span class="hljs-keyword">return</span> {
        value: <span class="hljs-built_in">parseFloat</span>(value, <span class="hljs-number">10</span>) || <span class="hljs-number">0</span>,
        color: color || <span class="hljs-string">'black'</span>
      };
    });
  }

  _getMax(dataset) {
    <span class="hljs-keyword">return</span> dataset.reduce((maxVal, entry) =&gt; {
      <span class="hljs-keyword">return</span> maxVal &lt; entry.value ? entry.value : maxVal;
    }, <span class="hljs-number">0</span>);
  }

  paint(ctx, {width, height}, props) {
    <span class="hljs-keyword">const</span> gap = <span class="hljs-built_in">parseInt</span>(
      (props.get(<span class="hljs-string">'--bar-gap'</span>) || <span class="hljs-number">10</span>).toString(),
      <span class="hljs-number">10</span>
    );
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">this</span>._parseData(props.get(<span class="hljs-string">'--bar-map'</span>));
    <span class="hljs-keyword">const</span> max = <span class="hljs-keyword">this</span>._getMax(data);
    <span class="hljs-keyword">const</span> multiplier = height / max;
    <span class="hljs-keyword">const</span> barW = (width - (gap * (data.length - <span class="hljs-number">1</span>))) / data.length;

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; data.length; i++) {
      <span class="hljs-keyword">const</span> x = i * (barW + gap);
      <span class="hljs-keyword">const</span> barHeight = data[i].value * multiplier;
      <span class="hljs-keyword">const</span> y = domain - barHeight;

      ctx.fillStyle = data[i].color;

      ctx.fillRect(x, y, barW, barHeight);
    }
  }
}

registerPaint(<span class="hljs-string">'bar-chart'</span>, BarChartPainter);
</code></pre><h2>Loading the worklet</h2><p>So to have the ability to use our custom painter in the stylesheet, we need to load our worklet:</p><pre class="lang-highlight"><code class="language-js lang-js"><span class="hljs-keyword">if</span> (<span class="hljs-string">'paintWorklet'</span> <span class="hljs-keyword">in</span> CSS) {
  CSS.paintWorklet.addModule(<span class="hljs-string">'paint.js'</span>);
}
</code></pre><p class="lang-highlight">I called my file as <code class="lang-css"><span class="hljs-tag">paint</span><span class="hljs-class">.js</span></code> and the loading it using <code class="lang-css"><span class="hljs-tag">CSS</span><span class="hljs-class">.paintWorklet</span><span class="hljs-class">.addModule</span></code> method. Not far time ago <a href="https://twitter.com/dassurma" target="_blank" rel="nofollow noreferrer noopener">Surma</a>, main Houdini project supporter, published interesting <a href="https://twitter.com/DasSurma/status/983305990731894785" target="_blank" rel="nofollow noreferrer noopener">cheat</a> how to avoid additional HTTP request to load worklets. We can’t write worklet code as inline JavaScript because it shouldn’t have access to the global scope. All worklets executed in separate browser context with insufficient functionality for security reasons. Inside this context we can use only small subset of 2D canvas, few global JS functions and helpers, like <code class="lang-js"><span class="hljs-built_in">parseInt</span></code> or <code class="lang-js"><span class="hljs-built_in">Math</span></code>, but no <code class="lang-bash"><span class="hljs-built_in">set</span>Interval</code>, <code class="lang-bash"><span class="hljs-built_in">set</span>Timeout</code> or <code>requestAnimationFrame</code>. The idea behind Surma’s worklet embedding method is to write code inline inside <code>script</code> tag but with different language type, to avoid its execution. Then we can convert it to <code>Blob</code> objects and create object URL from it. Here is the code example:</p><pre class="lang-highlight"><code class="language-html lang-html"><span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">language</span>=<span class="hljs-value">"javascript+paint"</span>&gt;</span><span class="actionscript">
  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BarChartPainter</span> </span>{
    paint(ctx, geom, props) {}
  }

  registerPaint(<span class="hljs-string">'bar-chart'</span>, BarChartPainter);
</span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="javascript">
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">blobWorklet</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">const</span> src = <span class="hljs-built_in">document</span>
      .querySelector(<span class="hljs-string">'script[language$="paint"]'</span>)
      .innerHTML;
    <span class="hljs-keyword">const</span> blob = <span class="hljs-keyword">new</span> Blob([src], {type: <span class="hljs-string">'text/javascript'</span>});

    <span class="hljs-keyword">return</span> URL.createObjectURL(blob);
  }

  <span class="hljs-keyword">if</span> (<span class="hljs-string">'paintWorklet'</span> <span class="hljs-keyword">in</span> CSS) {
    CSS.paintWorklet.addModule(blobWorklet());
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
</code></pre><p>Using this trick, we avoid sending additional HTTP request to load CSS Paint worklet.</p><h2>Using worklet</h2><p>After our painter registered and loaded we can call it in CSS:</p><pre class="lang-highlight"><code class="language-css lang-css"><span class="hljs-class">.bars</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">height</span>:<span class="hljs-value"> <span class="hljs-number">700px</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">max-height</span>:<span class="hljs-value"> <span class="hljs-number">50vh</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">--bar-map</span>:<span class="hljs-value"> <span class="hljs-number">50</span> <span class="hljs-hexcolor">#666</span>, <span class="hljs-number">70</span> salmon, <span class="hljs-number">35</span> <span class="hljs-hexcolor">#9ee7a1</span>, <span class="hljs-number">15</span> <span class="hljs-hexcolor">#fff</span>, <span class="hljs-number">25</span> orange</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">--bar-gap</span>:<span class="hljs-value"> <span class="hljs-number">20</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">background</span>:<span class="hljs-value"> <span class="hljs-hexcolor">#111</span> <span class="hljs-function">paint</span>(bar-chart)</span></span>;
}</span>

<span class="hljs-at_rule">@<span class="hljs-keyword">supports</span> not (background: <span class="hljs-function">paint</span>(bar-chart)) </span>{
  <span class="hljs-class">.bars</span><span class="hljs-pseudo">:after</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">content</span>:<span class="hljs-value"> <span class="hljs-string">'Your browser does not support CSS Paint API :('</span></span></span>;
  }</span>
}
</code></pre><p class="lang-highlight">We declared <code>--bar-map</code> and <code>--bar-gap</code> variables and call custom paint using <code>paint(bar-chart)</code>. We set solid background color as well. Also, I have added feature detection with <code class="lang-css"><span class="hljs-at_rule">@<span class="hljs-keyword">supports</span></span></code> rule. Using this if a browser hasn’t support of CSS Paint API, it will show an appropriate message to the user. Below is the video of the result.</p><p>INSERT VIDEO</p><h2>Improvements</h2><p>We have already created bar chart MVP and now is the time to think about its improvements. Actually, there are a lot of points to improve, and I am not going to cover all of them. If you want to implement more feel free to fork my repository and do it, just don’t forget to share your ideas in the comments below and social networks (in Twitter plz ping <a href="https://twitter.com/bobrov1989" target="_blank" rel="nofollow noreferrer noopener">me</a>).</p><p class="lang-highlight">So the first point I want to do is to add the possibility to define offsets for our chart. And I’m going to use <code>padding</code> property for that. Here is the updated painter class:</p><pre class="lang-highlight"><code class="language-js lang-ts"><span class="hljs-keyword">class</span> BarChartPainter {
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">get</span> inputProperties() {
    <span class="hljs-keyword">return</span> [
      <span class="hljs-string">'--bar-map'</span>,
      <span class="hljs-string">'--bar-gap'</span>,
      <span class="hljs-string">'padding-top'</span>,
      <span class="hljs-string">'padding-right'</span>,
      <span class="hljs-string">'padding-bottom'</span>,
      <span class="hljs-string">'padding-left'</span>
    ];
  }

  paint(ctx, geom, props) {
    <span class="hljs-keyword">const</span> position = props.get(<span class="hljs-string">'--bar-placement'</span>).toString().trim();
    <span class="hljs-keyword">const</span> gap = <span class="hljs-built_in">parseInt</span>((props.get(<span class="hljs-string">'--bar-gap'</span>) || <span class="hljs-number">10</span>).toString(), <span class="hljs-number">10</span>);
    <span class="hljs-keyword">const</span> padding = {
      top: props.get(<span class="hljs-string">'padding-top'</span>).value,
      right: props.get(<span class="hljs-string">'padding-right'</span>).value,
      bottom: props.get(<span class="hljs-string">'padding-bottom'</span>).value,
      left: props.get(<span class="hljs-string">'padding-left'</span>).value
    };
    <span class="hljs-keyword">const</span> width = geom.width - padding.left - padding.right;
    <span class="hljs-keyword">const</span> height = geom.height - padding.top - padding.bottom;
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">this</span>._parseData(props.get(<span class="hljs-string">'--bar-map'</span>));
    <span class="hljs-keyword">const</span> max = <span class="hljs-keyword">this</span>._getMax(data);
    <span class="hljs-keyword">const</span> multiplier = height / max;
    <span class="hljs-keyword">const</span> barW = (width - (gap * (data.length - <span class="hljs-number">1</span>))) / data.length;

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; data.length; i++) {
      <span class="hljs-keyword">const</span> x = i * (barW + gap) + padding.left;
      <span class="hljs-keyword">const</span> barHeight = data[i].value * multiplier;
      <span class="hljs-keyword">const</span> y = domain - barHeight + padding.top;

      ctx.fillStyle = data[i].color;

      ctx.fillRect(x, y, barW, barHeight);
    }
  }
}
</code></pre><p>INSERT VIDEO</p><p class="lang-highlight">Now we are using padding values to calculate bar width and height. Next, I want to add the possibility to change chart orientation. I will introduce <code>--bar-orientation</code> variable with possible values: top, bottom, left and right. Here is the final code:</p><pre class="lang-highlight"><code class="language-js lang-ts"><span class="hljs-keyword">class</span> BarChartPainter {
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">get</span> inputProperties() {
    <span class="hljs-keyword">return</span> [
      <span class="hljs-string">'--bar-map'</span>,
      <span class="hljs-string">'--bar-placement'</span>,
      <span class="hljs-string">'--bar-gap'</span>,
      <span class="hljs-string">'padding-top'</span>,
      <span class="hljs-string">'padding-right'</span>,
      <span class="hljs-string">'padding-bottom'</span>,
      <span class="hljs-string">'padding-left'</span>
    ];
  }

  _parseData(input) {
    <span class="hljs-keyword">return</span> input.toString()
    .split(<span class="hljs-string">','</span>)
    .map(entry =&gt; {
      <span class="hljs-keyword">const</span> [value, color] = entry.trim().split(<span class="hljs-string">' '</span>);

      <span class="hljs-keyword">return</span> {
        value: <span class="hljs-built_in">parseFloat</span>(value, <span class="hljs-number">10</span>) || <span class="hljs-number">0</span>,
        color: color || <span class="hljs-string">'black'</span>
      };
    });
  }

  _getMax(dataset) {
    <span class="hljs-keyword">return</span> dataset.reduce((maxVal, entry) =&gt; {
      <span class="hljs-keyword">return</span> maxVal &lt; entry.value ? entry.value : maxVal;
    }, <span class="hljs-number">0</span>);
  }

  paint(ctx, geom, props) {
    <span class="hljs-keyword">const</span> position = props.get(<span class="hljs-string">'--bar-placement'</span>).toString().trim();
    <span class="hljs-keyword">const</span> gap = <span class="hljs-built_in">parseInt</span>((props.get(<span class="hljs-string">'--bar-gap'</span>) || <span class="hljs-number">10</span>).toString(), <span class="hljs-number">10</span>);
    <span class="hljs-keyword">const</span> padding = {
      top: props.get(<span class="hljs-string">'padding-top'</span>).value,
      right: props.get(<span class="hljs-string">'padding-right'</span>).value,
      bottom: props.get(<span class="hljs-string">'padding-bottom'</span>).value,
      left: props.get(<span class="hljs-string">'padding-left'</span>).value
    };
    <span class="hljs-keyword">const</span> vertical = position === <span class="hljs-string">'top'</span> || position === <span class="hljs-string">'bottom'</span>;
    <span class="hljs-keyword">const</span> width = geom.width - padding.left - padding.right;
    <span class="hljs-keyword">const</span> height = geom.height - padding.top - padding.bottom;
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">this</span>._parseData(props.get(<span class="hljs-string">'--bar-map'</span>));
    <span class="hljs-keyword">const</span> max = <span class="hljs-keyword">this</span>._getMax(data);

    <span class="hljs-keyword">const</span> domain = vertical ? height : width;
    <span class="hljs-keyword">const</span> baseWidth = vertical ? width : height;
    <span class="hljs-keyword">const</span> multiplier = domain / max;
    <span class="hljs-keyword">const</span> barW = (baseWidth - (gap * (data.length - <span class="hljs-number">1</span>))) / data.length;

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; data.length; i++) {
      <span class="hljs-keyword">const</span> x = i * (barW + gap) + padding.left;
      <span class="hljs-keyword">const</span> barH = data[i].value * multiplier;
      <span class="hljs-keyword">const</span> y = {
        top: padding.top,
        right: domain - barH + padding.left,
        bottom: domain - barH + padding.top,
        left: padding.left
      }[position];

      ctx.fillStyle = data[i].color;

      <span class="hljs-keyword">if</span> (vertical) {
        ctx.fillRect(x, y, barW, barH);
      } <span class="hljs-keyword">else</span> {
        ctx.fillRect(y, x, barH, barW);
      }
    }
  }
}
</code></pre><p>And updated styles:</p><pre class="lang-highlight"><code class="language-css lang-css"><span class="hljs-class">.bars</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">height</span>:<span class="hljs-value"> <span class="hljs-number">700px</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">max-height</span>:<span class="hljs-value"> <span class="hljs-number">50vh</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">padding</span>:<span class="hljs-value"> <span class="hljs-number">30px</span> <span class="hljs-number">10px</span> <span class="hljs-number">0</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">--bar-placement</span>:<span class="hljs-value"> bottom</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">--bar-gap</span>:<span class="hljs-value"> <span class="hljs-number">40</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">--bar-map</span>:<span class="hljs-value"> <span class="hljs-number">50</span> <span class="hljs-hexcolor">#666</span>, <span class="hljs-number">70</span> salmon, <span class="hljs-number">35</span> <span class="hljs-hexcolor">#9ee7a1</span>, <span class="hljs-number">15</span> <span class="hljs-hexcolor">#fff</span>, <span class="hljs-number">25</span> orange</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">background</span>:<span class="hljs-value"> <span class="hljs-hexcolor">#111</span> <span class="hljs-function">paint</span>(bar-chart)</span></span>;
}</span>
</code></pre><p>INSERT VIDEO</p><p>As usual you can check <a href="https://github.com/vitaliy-bobrov/css-paint-demos/tree/master/src/bar" target="_blank" rel="nofollow noreferrer noopener">code</a> and <a href="https://vitaliy-bobrov.github.io/css-paint-demos/bar/">demo</a>.</p><h2>Change input format</h2><p class="lang-highlight">After thinking for some time, I decided to change dataset input using "JS in CSS". Yes, you read it correctly, I want to use JavaScript inside CSS. As I said before Our worklet code executed in secure separate context and this case is completely fine to use some JS as CSS variable value. Then I’m going to parse this value in custom painter using <code class="lang-js"><span class="hljs-built_in">JSON</span>.parse</code>. Let look at stylesheet first:</p><pre class="lang-highlight"><code class="language-css lang-bash">.bars {
  height: <span class="hljs-number">700</span>px;
  max-height: <span class="hljs-number">50</span>vh;
  padding: <span class="hljs-number">10</span>px;
  background: <span class="hljs-comment">#111 paint(bar-chart);</span>
  --bar-placement: bottom;
  --bar-gap: <span class="hljs-number">40</span>;
  --bar-map: [
    {
      <span class="hljs-string">"value"</span>: <span class="hljs-number">55</span>,
      <span class="hljs-string">"color"</span>: <span class="hljs-string">"rgba(250, 128, 114, .8)"</span>
    },
    {
      <span class="hljs-string">"value"</span>: <span class="hljs-number">10</span>,
      <span class="hljs-string">"color"</span>: <span class="hljs-string">"rgba(102, 51, 153, .9)"</span>
    },
    {
      <span class="hljs-string">"value"</span>: <span class="hljs-number">120</span>,
      <span class="hljs-string">"color"</span>: <span class="hljs-string">"hsl(39, 100%, 50%)"</span>
    },
    {
      <span class="hljs-string">"value"</span>: <span class="hljs-number">36.8</span>,
      <span class="hljs-string">"color"</span>: <span class="hljs-string">"#666"</span>
    },
    {
      <span class="hljs-string">"value"</span>: <span class="hljs-number">97.5</span>,
      <span class="hljs-string">"color"</span>: <span class="hljs-string">"#9ee7a1"</span>
    }
  ];
}
</code></pre><p class="lang-highlight">So I defined JSON array with data objects in my CSS! Such rule looks strange but more verbose then special string before. So now I can remove <code>_parseData</code> method from painter class and use <code class="lang-js"><span class="hljs-built_in">JSON</span>.parse</code> instead:</p><pre class="lang-highlight"><code class="language-js lang-ts"><span class="hljs-keyword">class</span> BarChartPainter {
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">get</span> inputProperties() {
    <span class="hljs-keyword">return</span> [
      <span class="hljs-string">'--bar-map'</span>,
      <span class="hljs-string">'--bar-placement'</span>,
      <span class="hljs-string">'--bar-gap'</span>,
      <span class="hljs-string">'padding-top'</span>,
      <span class="hljs-string">'padding-right'</span>,
      <span class="hljs-string">'padding-bottom'</span>,
      <span class="hljs-string">'padding-left'</span>
    ];
  }

  _getMax(dataset) {
    <span class="hljs-keyword">return</span> dataset.reduce((maxVal, entry) =&gt; {
      <span class="hljs-keyword">return</span> maxVal &lt; entry.value ? entry.value : maxVal;
    }, <span class="hljs-number">0</span>);
  }

  paint(ctx, geom, props) {
    <span class="hljs-keyword">const</span> position = props.get(<span class="hljs-string">'--bar-placement'</span>).toString().trim();
    <span class="hljs-keyword">const</span> gap = <span class="hljs-built_in">parseInt</span>((props.get(<span class="hljs-string">'--bar-gap'</span>) || <span class="hljs-number">10</span>).toString(), <span class="hljs-number">10</span>);
    <span class="hljs-keyword">const</span> padding = {
      top: props.get(<span class="hljs-string">'padding-top'</span>).value,
      right: props.get(<span class="hljs-string">'padding-right'</span>).value,
      bottom: props.get(<span class="hljs-string">'padding-bottom'</span>).value,
      left: props.get(<span class="hljs-string">'padding-left'</span>).value
    };
    <span class="hljs-keyword">const</span> vertical = position === <span class="hljs-string">'top'</span> || position === <span class="hljs-string">'bottom'</span>;
    <span class="hljs-keyword">const</span> width = geom.width - padding.left - padding.right;
    <span class="hljs-keyword">const</span> height = geom.height - padding.top - padding.bottom;
    <span class="hljs-comment">// Much simplier data parsing!</span>
    <span class="hljs-keyword">const</span> data = <span class="hljs-built_in">JSON</span>.parse(props.get(<span class="hljs-string">'--bar-map'</span>).toString());

    <span class="hljs-keyword">const</span> max = <span class="hljs-keyword">this</span>._getMax(data);

    <span class="hljs-keyword">const</span> domain = vertical ? height : width;
    <span class="hljs-keyword">const</span> baseWidth = vertical ? width : height;
    <span class="hljs-keyword">const</span> multiplier = domain / max;
    <span class="hljs-keyword">const</span> barW = (baseWidth - (gap * (data.length - <span class="hljs-number">1</span>))) / data.length;

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; data.length; i++) {
      <span class="hljs-keyword">const</span> x = i * (barW + gap) + padding.left;
      <span class="hljs-keyword">const</span> barH = data[i].value * multiplier;
      <span class="hljs-keyword">const</span> y = {
        top: padding.top,
        right: domain - barH + padding.left,
        bottom: domain - barH + padding.top,
        left: padding.left
      }[position];

      ctx.fillStyle = data[i].color;

      <span class="hljs-keyword">if</span> (vertical) {
        ctx.fillRect(x, y, barW, barH);
      } <span class="hljs-keyword">else</span> {
        ctx.fillRect(y, x, barH, barW);
      }
    }
  }
}
</code></pre><p class="lang-highlight">How is it useful? Now we can get CSS variables in JavaScript, change the data and animate it! Then we need to call <code class="lang-js"><span class="hljs-built_in">JSON</span>.stringify</code> and set the new value. Without JavaScript we can swap the data, on hover for example:</p><pre class="lang-highlight"><code class="language-css lang-js">.bars:hover {
  --bar-map: [
    {
      <span class="hljs-string">"value"</span>: <span class="hljs-number">5</span>,
      <span class="hljs-string">"color"</span>: <span class="hljs-string">"rgba(250, 128, 114, .8)"</span>
    },
    {
      <span class="hljs-string">"value"</span>: <span class="hljs-number">100</span>,
      <span class="hljs-string">"color"</span>: <span class="hljs-string">"rgba(102, 51, 153, .9)"</span>
    },
    {
      <span class="hljs-string">"value"</span>: <span class="hljs-number">21</span>,
      <span class="hljs-string">"color"</span>: <span class="hljs-string">"hsl(39, 100%, 50%)"</span>
    },
    {
      <span class="hljs-string">"value"</span>: <span class="hljs-number">120</span>,
      <span class="hljs-string">"color"</span>: <span class="hljs-string">"#666"</span>
    },
    {
      <span class="hljs-string">"value"</span>: <span class="hljs-number">37</span>,
      <span class="hljs-string">"color"</span>: <span class="hljs-string">"#9ee7a1"</span>
    }
  ];
}
</code></pre><p>INSERT VIDEO</p><p><a href="https://github.com/vitaliy-bobrov/css-paint-demos/tree/master/src/bar-js-in-css" target="_blank" rel="nofollow noreferrer noopener">Code</a> and <a href="https://vitaliy-bobrov.github.io/css-paint-demos/bar-js-in-css/">demo</a>.</p><p>Now let’s try to animate dataset in JavaScript:</p><pre class="lang-highlight"><code class="language-js lang-js"><span class="hljs-keyword">const</span> canvas = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'.bars'</span>);
<span class="hljs-keyword">const</span> style = getComputedStyle(canvas);
<span class="hljs-keyword">const</span> initialValues = <span class="hljs-built_in">JSON</span>.parse(style.getPropertyValue(<span class="hljs-string">'--bar-map'</span>))
  .map(v =&gt; v.value);
<span class="hljs-keyword">const</span> TIME = <span class="hljs-number">1000</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">rand</span>(<span class="hljs-params">max, min</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * (max - min + <span class="hljs-number">1</span>)) + min;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">animate</span>(<span class="hljs-params">values, time</span>) </span>{
  <span class="hljs-keyword">const</span> start = performance.now();
  <span class="hljs-keyword">const</span> style = getComputedStyle(canvas);
  <span class="hljs-keyword">const</span> init = <span class="hljs-built_in">JSON</span>.parse(style.getPropertyValue(<span class="hljs-string">'--bar-map'</span>));
  <span class="hljs-keyword">const</span> from = init.map(v =&gt; v.value);
  <span class="hljs-keyword">const</span> increments = from.map((v, i) =&gt; {
    <span class="hljs-keyword">return</span> -(v - values[i]) / time;
  });

  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">raf</span>(<span class="hljs-params">now</span>) </span>{
    <span class="hljs-keyword">const</span> count = <span class="hljs-built_in">Math</span>.floor(now - start);
    <span class="hljs-keyword">const</span> style = getComputedStyle(canvas);
    <span class="hljs-keyword">const</span> dataset = <span class="hljs-built_in">JSON</span>.parse(style.getPropertyValue(<span class="hljs-string">'--bar-map'</span>));
    <span class="hljs-keyword">const</span> value = dataset.map((s, i) =&gt; {
      <span class="hljs-keyword">return</span> {
        ...s,
        value: from[i] + (increments[i] * count)
      };
    });

    canvas.style.setProperty(<span class="hljs-string">'--bar-map'</span>, <span class="hljs-built_in">JSON</span>.stringify(value));

    <span class="hljs-keyword">if</span>(count &gt; time) {
      <span class="hljs-keyword">const</span> final = dataset.map((s, i) =&gt; {
        <span class="hljs-keyword">return</span> {
          ...s,
          value: values[i]
        };
      });
      canvas.style.setProperty(<span class="hljs-string">'--bar-map'</span>, <span class="hljs-built_in">JSON</span>.stringify(final));

      <span class="hljs-keyword">return</span>;
    }

    requestAnimationFrame(raf);
  }
}

canvas.addEventListener(<span class="hljs-string">'mouseenter'</span>, event =&gt; {
  <span class="hljs-keyword">const</span> values = initialValues.map(() =&gt; rand(<span class="hljs-number">0</span>, <span class="hljs-number">120</span>));

  requestAnimationFrame(animate(values, TIME));
});

canvas.addEventListener(<span class="hljs-string">'mouseleave'</span>, event =&gt; {
  requestAnimationFrame(animate(initialValues, TIME));
});
</code></pre><p class="lang-highlight">So using <code>requestAnimationFrame</code> on mouse enter I animated dataset from the initial value to random data set and in opposite direction on mouse leave. Also, I’ve added <code>--bar-max</code> variable to set the range for the main axis from zero to this value. Here is the updated painter class:</p><pre class="lang-highlight"><code class="language-js lang-ts"><span class="hljs-keyword">class</span> BarChartPainter {
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">get</span> inputProperties() {
    <span class="hljs-keyword">return</span> [
      <span class="hljs-string">'--bar-map'</span>,
      <span class="hljs-string">'--bar-placement'</span>,
      <span class="hljs-string">'--bar-gap'</span>,
      <span class="hljs-string">'--bar-max'</span>,
      <span class="hljs-string">'padding-top'</span>,
      <span class="hljs-string">'padding-right'</span>,
      <span class="hljs-string">'padding-bottom'</span>,
      <span class="hljs-string">'padding-left'</span>
    ];
  }

  paint(ctx, geom, props) {
    <span class="hljs-keyword">const</span> position = props.get(<span class="hljs-string">'--bar-placement'</span>).toString().trim();
    <span class="hljs-keyword">const</span> gap = <span class="hljs-built_in">parseInt</span>((props.get(<span class="hljs-string">'--bar-gap'</span>) || <span class="hljs-number">10</span>).toString(), <span class="hljs-number">10</span>);
    <span class="hljs-keyword">const</span> max = <span class="hljs-built_in">parseInt</span>(props.get(<span class="hljs-string">'--bar-max'</span>).toString(), <span class="hljs-number">10</span>);
    <span class="hljs-keyword">const</span> padding = {
      top: props.get(<span class="hljs-string">'padding-top'</span>).value,
      right: props.get(<span class="hljs-string">'padding-right'</span>).value,
      bottom: props.get(<span class="hljs-string">'padding-bottom'</span>).value,
      left: props.get(<span class="hljs-string">'padding-left'</span>).value
    };
    <span class="hljs-keyword">const</span> vertical = position === <span class="hljs-string">'top'</span> || position === <span class="hljs-string">'bottom'</span>;
    <span class="hljs-keyword">const</span> width = geom.width - padding.left - padding.right;
    <span class="hljs-keyword">const</span> height = geom.height - padding.top - padding.bottom;
    <span class="hljs-keyword">const</span> data = <span class="hljs-built_in">JSON</span>.parse(props.get(<span class="hljs-string">'--bar-map'</span>).toString());

    <span class="hljs-keyword">const</span> domain = vertical ? height : width;
    <span class="hljs-keyword">const</span> baseWidth = vertical ? width : height;
    <span class="hljs-keyword">const</span> multiplier = domain / max;
    <span class="hljs-keyword">const</span> barW = (baseWidth - (gap * (data.length - <span class="hljs-number">1</span>))) / data.length;

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; data.length; i++) {
      <span class="hljs-keyword">const</span> x = i * (barW + gap) + padding.left;
      <span class="hljs-keyword">const</span> barH = data[i].value * multiplier;
      <span class="hljs-keyword">const</span> y = {
        top: padding.top,
        right: domain - barH + padding.left,
        bottom: domain - barH + padding.top,
        left: padding.left
      }[position];

      ctx.fillStyle = data[i].color;

      <span class="hljs-keyword">if</span> (vertical) {
        ctx.fillRect(x, y, barW, barH);
      } <span class="hljs-keyword">else</span> {
        ctx.fillRect(y, x, barH, barW);
      }
    }
  }
}
</code></pre><p>INSERT VIDEO</p><p><a href="https://github.com/vitaliy-bobrov/css-paint-demos/tree/master/src/bar-animate" target="_blank" rel="nofollow noreferrer noopener">Code</a> and <a href="https://vitaliy-bobrov.github.io/css-paint-demos/bar-animate/">demo</a>.</p><h2>Recap</h2><p class="lang-highlight">Today we implemented basic bar chart, then extend its functionality, tried to use JavaScript in CSS and animate data with <code>requestAnimationFrame</code>. I hope this was awesome, and as I still experimenting with Houdini APIs more exciting posts will come. Let’s keep in touch!</p></section></article><div id="disqus_thread" class="mdl-card mdl-shadow--3dp mdl-cell mdl-cell--12-col comments-widget"></div></section></main><div aria-live="assertive" aria-atomic="true" aria-relevant="text" class="mdl-snackbar mdl-js-snackbar"><div class="mdl-snackbar__text"></div><button type="button" class="mdl-snackbar__action"></button></div><footer role="contentinfo" class="mdl-mini-footer page-footer"><a href="#top" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--primary mdl-button--fab mdl-button--mini-fab to-top js-to-top"><svg class="mdl-svg to-top__icon"><use xlink:href="#expand-less"/></svg> Go to the top</a><section class="mdl-mini-footer--left-section page-footer__left-section"><a href="https://twitter.com/bobrov1989" target="_blank" rel="nofollow noreferrer noopener" class="mdl-mini-footer--social-btn" title="Twitter"><svg class="mdl-mini-footer--social-btn__icon"><use xlink:href="#twitter"/></svg> </a><a href="https://github.com/vitaliy-bobrov" target="_blank" rel="nofollow noreferrer noopener" class="mdl-mini-footer--social-btn" title="GitHub"><svg class="mdl-mini-footer--social-btn__icon"><use xlink:href="#github"/></svg></a></section><section class="mdl-copyright"><p>&copy; 2018 Bobrov Blog</p></section><section class="mdl-mini-footer--right-section page-footer__right-section"></section></footer></div><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
    ga('create', 'UA-90372372-1', 'auto');
    ga('set', 'transport', 'beacon');
    ga('send', 'pageview');</script><script async src="https://www.google-analytics.com/analytics.js"></script><script src="/js/main.min.js" async defer></script><script>var disqus_config = function() {
        this.page.url = 'https://vitaliy-bobrov.github.io/blog/css-paint-in-action-charts';
        this.page.identifier = 'css_paint_in_action_bar_chart';
        this.page.title = 'CSS Paint in Action: Bar Chart';
      };

      (function(d) {
        var s = d.createElement('script');
        s.src = '//bobrov-blog.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
      })(document);</script></body></html>