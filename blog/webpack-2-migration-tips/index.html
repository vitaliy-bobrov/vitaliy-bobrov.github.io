<html><head><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@bobrov1989"><meta name="twitter:title" content="Webpack 2 Migration Tips"><meta name="twitter:description" content="Webpack 2 has been just released, it brings a lot of improvement and cool features, as well as breaking changes in configuration."><meta name="twitter:image" content="https://bobrov.dev/images/posts/webpack-2-migration-tips/webpack-2-migration-tips-og.jpg"><meta name="twitter:image:alt" content="Webpack 2 Migration Tips"></head><body><p>Webpack 2 has been just released, it brings a lot of improvement and cool features, as well as breaking changes in configuration. Not all issues are easy to find by googling, to solve it fast. That is why I want to share tips that might help you to update you Webpack configuration and don’t break your bundle.</p>
<p>First of all, you need to check all new and more user-friendly <a href="https://webpack.js.org/configuration/" target="_blank" rel="nofollow noreferrer noopener">documentation</a>. It is not full now, but anyway, this is the official guide and will be handy.</p>
<h2>Remove deprecated custom webpack options</h2>
<p>So let’s start, the first issue that will break your build – exception related to custom properties in your config object. Now properties are limited to allowed list and checked by Webpack. Not all “loaders” allow configuration with new <code>options</code> parameter, for such Webpack loaders you should use <code>LoaderOptionsPlugin</code> until they are up-to-date with new rules. From my experience, this was related to <code>sass</code> loader. Here is the example:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">...</span>
plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>LoaderOptionsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    sassLoader<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      includePaths<span class="token punctuation">:</span> <span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"./mdl"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      precision<span class="token punctuation">:</span> <span class="token number">10</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    context<span class="token punctuation">:</span> __dirname
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre>
<p>You might mention that I’ve also added context option, it is not a mistake. This was necessary to pass context to got sass non-relative imports like <code>@import '~mdl/component'</code> working.</p>
<h2>Configure Babel</h2>
<p>If you are using Babel to transpile your code to ES5, there is a good news for you, from the 2nd version Webpack supports native imports. So you don’t need to transform such statements as <code>import moment from 'moment'</code> to CommonJS modules, Webpack normally handles this. To configure Babel properly just add option to preset <code>es2015</code> in your <code>.babelrc</code> file:</p>
<pre class="language-json"><code class="language-json"><span class="token property">"presets"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token string">"es2015"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token property">"modules"</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span>
</code></pre>
<p>That will enable usual <code>preset-es2015</code> with the disabled native module to CommonJS transform.</p>
<h2>Rename configuration properties</h2>
<p>In new Webpack, some of the properties were renamed. You should rename your <code>module.loaders</code> to <code>module.rules</code> and inside each rule change <code>loader</code> property to <code>use</code> array, like this:</p>
<pre class="language-js"><code class="language-js"><span class="token operator">...</span>
module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      test<span class="token punctuation">:</span> <span class="token regex">/\.ts$/</span><span class="token punctuation">,</span>
      use<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token string">'typescript-loader'</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
</code></pre>
<h2>Change ugly loaders chain</h2>
<p>From now old-style short syntax for loaders definition is deprecated, you should use an array of strings/objects instead. Also, automatic loader resolve is disabled by default, prefer to write full loader name. Example of transformed loader <code>style!css?sourceMap!postcss!sass?sourceMap</code>:</p>
<pre class="language-js"><code class="language-js">module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      test<span class="token punctuation">:</span> <span class="token regex">/\.(scss|sass)$/</span><span class="token punctuation">,</span>
      use<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          loader<span class="token punctuation">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
          options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            sourceMap<span class="token punctuation">:</span> <span class="token boolean">true</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          loader<span class="token punctuation">:</span> <span class="token string">'postcss-loader'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          loader<span class="token punctuation">:</span> <span class="token string">'sass-loader'</span><span class="token punctuation">,</span>
          options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            sourceMap<span class="token punctuation">:</span> <span class="token boolean">true</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Here you can also mention that if loader has no options, it could be declared as a simple string instead object with <code>loader</code> key.</p>
<h2>Extract Text Plugin</h2>
<p>When this post was written <code>ExtractTextPlugin</code> hasn’t stable release for Webpack 2, that is why you need to specify the latest version of the v2 branch while installation <code>npm install extract-text-webpack-plugin@2.0.0-beta.5</code>. Also in my configuration it won’t get to work with CSS preprocessor, the solution was to change config:</p>
<pre class="language-js"><code class="language-js">module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      test<span class="token punctuation">:</span> <span class="token regex">/\.(scss|sass)$/</span><span class="token punctuation">,</span>
      use<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        ExtractTextPlugin<span class="token punctuation">.</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token string">'style-loader'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          loader<span class="token punctuation">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
          options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            sourceMap<span class="token punctuation">:</span> <span class="token boolean">true</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">'postcss-loader'</span>
        <span class="token punctuation">{</span>
          loader<span class="token punctuation">:</span> <span class="token string">'sass-loader'</span><span class="token punctuation">,</span>
          options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            sourceMap<span class="token punctuation">:</span> <span class="token boolean">true</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">ExtractTextPlugin</span><span class="token punctuation">(</span><span class="token string">'styles.css'</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre>
<p>That was the typical issues I’ve faced while upgrading my projects build, and you can find out more in official documentation. Hope my tips will save your time and reduce a headache before docs are entirely fulfilled. Write your tip in comments.</p>
<script defer src="https://cdn.commento.io/js/commento.js" data-css-override="https://bobrov.dev/css/commento.css"></script></body></html>