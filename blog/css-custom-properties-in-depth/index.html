<html><head><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@bobrov1989"><meta name="twitter:title" content="CSS Custom Properties in Depth"><meta name="twitter:description" content="CSS Properties and Values API the vital part of Houdini project. This deep dive demonstrates its power on real examples."><meta name="twitter:image" content="https://bobrov.dev/images/posts/css-custom-properties-in-depth/css-custom-properties-in-depth-og.jpg"><meta name="twitter:image:alt" content="CSS Custom Properties in Depth"></head><body><p>‚ÄúCSS Properties and Values API Level 1‚Äù is a brand new draft for CSS specification module. It gives developers the power to extend stylesheet dictionary. I have already mentioned custom properties in my previous articles: <a href="https://bobrov.dev/blog/css-paint-in-action-bar-chart/">‚ÄúExploring the CSS Paint API‚Äù</a> and <a href="https://bobrov.dev/blog/css-paint-in-action-bar-chart/">‚ÄúCSS Paint in Action: Bar Chart‚Äù</a>. But today I want to introduce them in as many details as possible. So let‚Äôs start our journey into properties and values far depths ‚öì!</p>
<p class="post__series">The topic splitted into two parts. Now you are reading the first one. You can check out the second part <a href="https://bobrov.dev/blog/css-custom-properties-in-depth-part-2/">here</a>.</p>
<h2>What are custom properties?</h2>
<p>CSS Properties and Values API is the part of Houdini project that allows <strong>you</strong> as developer create own variables to use later in your styles. The idea behind them is pretty similar to variables we have for many years in SASS, LESS or Stylus. The main difference between preprocessor variables and CSS properties that they are <strong>not</strong> static and existing at compile time only. You can change them in more specific selector block, for example on <code>:hover</code> or a <code>media-query</code> block. You could access them from JavaScript to read and modify. We will see all those features later in cases.</p>
<h2>How to define and use the custom property?</h2>
<p>There is special syntax for all custom properties ‚Äì a name of each property should be prefixed with <code>--</code> symbols. The name itself should be in lowercase (preferred) or uppercase letters (as CSS built-in properties are case insensitive) delimiter by <code>-</code>. As a value, we can use everything we want ‚Äì strings, numbers, colors, JavaScript code. Let‚Äôs create few custom properties:</p>
<pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.element</span> </span><span class="token punctuation">{</span>
  <span class="token property">--my-num-prop</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">;</span>
  <span class="token property">--string-prop</span><span class="token punctuation">:</span> text<span class="token punctuation">;</span>
  <span class="token property">--another-string</span><span class="token punctuation">:</span> <span class="token string">'content'</span><span class="token punctuation">;</span>
  <span class="token property">--length-prop</span><span class="token punctuation">:</span> <span class="token number">100</span>px<span class="token punctuation">;</span>
  <span class="token property">--js-prop</span><span class="token punctuation">:</span> if <span class="token punctuation">(</span>a > b<span class="token punctuation">)</span> return <span class="token number">30</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>To use it as the value of any CSS property we have <code>var</code> function. We should call <code>var</code> and pass variable name in it. Also, we allowed defining default fallback value for that property if it wasn‚Äôt initialized.</p>
<pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.element</span> </span><span class="token punctuation">{</span>
  <span class="token property">--offset</span><span class="token punctuation">:</span> <span class="token number">10</span>px<span class="token punctuation">;</span>
  <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--offset, <span class="token number">30</span>px<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The only thing you should remember is CSS parsing process that means you can‚Äôt use <code>:</code> or <code>;</code> outside quotes as they will be used as delimiters by CSS engine.</p>
<pre class="language-css"><code class="language-css"><span class="token comment">/* Will be parsed wrongly */</span>
<span class="token selector"><span class="token class">.element</span> </span><span class="token punctuation">{</span>
  <span class="token property">--offset</span><span class="token punctuation">:</span> <span class="token property">a</span><span class="token punctuation">:</span> something<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>By default, uninitialized variables have no value until we don‚Äôt configure another behavior. In this case, the fallback value will be used:</p>
<pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.element</span> </span><span class="token punctuation">{</span>
  <span class="token comment">/* margin: 30px */</span>
  <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--offset, <span class="token number">30</span>px<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>And one more important thing ‚Äì we can use another property as a default value. And this variable could also have a fallback:</p>
<pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.element</span> </span><span class="token punctuation">{</span>
  <span class="token comment">/* margin: 30px */</span>
  <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--offset, <span class="token function">var</span><span class="token punctuation">(</span>--root-offset, <span class="token number">30</span>px<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>In previous examples, we defined the property on the element itself, but we can use <code>:root</code> to create global variables. Root is standing for CSS OM root node that similar to <code>html</code> tag.</p>
<pre class="language-css"><code class="language-css"><span class="token selector"><span class="token pseudo-class">:root</span> </span><span class="token punctuation">{</span>
  <span class="token property">--theme-color</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector"><span class="token class">.element</span> </span><span class="token punctuation">{</span>
  <span class="token comment">/* blue */</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--theme-color, red<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>CSS custom properties also use cascade, that means we can override them by increasing CSS specificity:</p>
<pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.element</span> </span><span class="token punctuation">{</span>
  <span class="token property">--theme-color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--theme-color<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector"><span class="token class">.element.dark</span> </span><span class="token punctuation">{</span>
  <span class="token comment">/* background: black */</span>
  <span class="token property">--theme-color</span><span class="token punctuation">:</span> black<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Or use them in media queries and other CSS blocks:</p>
<pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.element</span> </span><span class="token punctuation">{</span>
  <span class="token property">--theme-color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--theme-color<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector"><span class="token class">.element</span><span class="token pseudo-class">:hover</span> </span><span class="token punctuation">{</span>
  <span class="token comment">/* background: red */</span>
  <span class="token property">--theme-color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token atrule"><span class="token rule">@media</span> all and <span class="token punctuation">(</span><span class="token property">min-width</span><span class="token punctuation">:</span> <span class="token number">1024</span>px<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
  <span class="token selector"><span class="token class">.element</span> </span><span class="token punctuation">{</span>
    <span class="token comment">/* background: black */</span>
    <span class="token property">--theme-color</span><span class="token punctuation">:</span> black<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2>What is the difference between CSS variable and custom property?</h2>
<p>Actually, there is no difference between CSS variable and CSS custom property, correctly to call both as custom properties. The only thing is that when we declare a custom property with <code>CSS.registerProperty</code>, you will get more control over it. Under more control I mean that you will be able to assign CSS type, set initial value and inheritance.</p>
<h2>Browsers support</h2>
<p>If we are speaking about CSS variables, the browsers support is incredible! All ‚Äúevergreen‚Äù one has full support.</p>
<p class="js-lazy-load"><img src="/images/posts/css-custom-properties-in-depth/img/caniuse.jpg" alt="CSS Variables support according to CanIUse.com"></p>
<p>Unfortunately, can‚Äôt say the same about custom properties üò¢. Only Chrome and Firefox started initial implementation of the spec.</p>
<p class="js-lazy-load"><img src="/images/posts/css-custom-properties-in-depth/img/ishoudinireadyyet.jpg" alt="CSS Properties and Values browsers implementation status on May 2018"></p>
<p>It will be great to be prepared before custom properties will be released in stable browser branch. You can always check the current status of every Houdini feature <a href="https://ishoudinireadyyet.com/" target="_blank" rel="nofollow noreferrer noopener">here</a>.</p>
<h3><strong>Note:</strong></h3>
<p><em>Work with <code>registerProperty</code> requires you to enable ‚ÄúExperimental Web Platform features‚Äù</em> ‚Äì <code>chrome://flags/#enable-experimental-web-platform-features</code> <em>to try it in Chrome.</em></p>
<p class="js-lazy-load"><img src="/images/posts/css-custom-properties-in-depth/img/chrome-flags.jpg" alt="Chrome v66 " experimental web platform features" enabled on chrome: flags"></p>
<h2>How to register custom property?</h2>
<p>To register custom property, you need to use the static <code>CSS.registerProperty</code>  method and pass configuration object. The code might look like this:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">'registerProperty'</span> <span class="token keyword">in</span> <span class="token constant">CSS</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">registerProperty</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'--my-custom-prop'</span><span class="token punctuation">,</span>
    syntax<span class="token punctuation">:</span> <span class="token string">'<color>'</color></span><span class="token punctuation">,</span>
    inherits<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    initialValue<span class="token punctuation">:</span> <span class="token string">'black'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>So, first of all, we are detecting feature support in our browser, as a part of progressive enhancement. If <code>registerProperty</code> not supported in the browser, we still able to use CSS variables in styles. Let‚Äôs have a closer look at each configuration parameter. The configuration object is required, if we try to call the method without it, we will get JS exception.</p>
<h3>name</h3>
<p>This is the only required parameter, if we try to register property without <code>name</code> provided we will get an exception ‚Äì "<em>Uncaught TypeError: Failed to execute ‚ÄòregisterProperty‚Äô on 'CSS‚Äô: required member name is undefined.</em>".</p>
<p>The other thing regarding property name that you must follow the naming rule ‚Äì name should start with <code>--</code> symbols. The reason for that is to have the ability to use CSS custom properties with CSS pre/post-processors and separate them from built-in CSS properties. If you try to give a name in an incorrect format, you will see the error ‚Äì "<em>DOMException: Failed to execute ‚ÄòregisterProperty‚Äô on 'CSS‚Äô: Custom property names must start with '‚Äì‚Äô.</em>".</p>
<p>If a property with that name has been already registered, a browser will throw next error ‚Äì "<em>Failed to execute ‚ÄòregisterProperty‚Äô on 'CSS‚Äô: The name provided has already been registered.</em>".</p>
<h3>syntax</h3>
<p>Syntax stands for our property type definition. Its default value is <code>*</code> that is similar to TypeScript <code>any</code> type. This means that you can assign any value to your property. The type definition syntax is straightforward ‚Äì <strong><type_name></type_name></strong>, where <code>TYPE_NAME</code> should be replaced with actual CSS type you want to assign. In our example we used <code>color</code> type, that gives ability to assign any CSS color value, for example: <code>rebeccapurple</code>, <code>rgba(0, 0, 0, .5)</code>, <code>#ff00ff</code>, <code>hls(240, 10%, 50%)</code>. We will look what types are available later in this article.</p>
<p>Similarly to TypeScript, it is possible to define the union of types and list of arguments. To declare union, we should separate types with <code>|</code> as the delimiter:</p>
<pre class="language-js"><code class="language-js"><span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">registerProperty</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'--my-size'</span><span class="token punctuation">,</span>
  syntax<span class="token punctuation">:</span> <span class="token string">'<length> | <percentage>'</percentage></length></span><span class="token punctuation">,</span>
  inherits<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  initialValue<span class="token punctuation">:</span> <span class="token string">'100%'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>In this example we declare that <code>--my-size</code> property accepts length OR percentage types, like <code>10px</code>, <code>3em</code>, <code>10vw</code>, <code>10%</code>. If the provided value does not match to those types, the property will use fallback or initial value instead.</p>
<p>To specify a list of values as a type, you should add <code>+</code> sign at the end of the type definition, example:</p>
<pre class="language-js"><code class="language-js"><span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">registerProperty</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'--my-colors'</span><span class="token punctuation">,</span>
  syntax<span class="token punctuation">:</span> <span class="token string">'<color>+'</color></span><span class="token punctuation">,</span>
  inherits<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  initialValue<span class="token punctuation">:</span> <span class="token string">'black white'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>In this example we want our property to have one or more colors delimited with a space. If the syntax is invalid browser will throw an error ‚Äì "<em>Failed to execute ‚ÄòregisterProperty‚Äô on 'CSS‚Äô: The syntax provided is not a valid custom property syntax.</em>".</p>
<p>If you want values list to be separated with commas you should use <code>#</code> at the syntax type end:</p>
<pre class="language-js"><code class="language-js"><span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">registerProperty</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'--my-colors'</span><span class="token punctuation">,</span>
  syntax<span class="token punctuation">:</span> <span class="token string">'<color>#'</color></span><span class="token punctuation">,</span>
  inherits<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  initialValue<span class="token punctuation">:</span> <span class="token string">'black, white'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>There are much more possibilities to describe types that unfortunately not supported by the current CSS Custom Properties and Values specification. Hope to see them all in the next specification release üôè.</p>
<h3>initialValue</h3>
<p>You might notice that I have used the <code>initialValue</code> parameter in the previous section examples. An initial value is required if the <code>syntax</code> was specified as any value different from <code>*</code>. If you trying to register the property with some type without providing <code>initialValue</code>, you‚Äôll face such error ‚Äì "<em>DOMException: Failed to execute ‚ÄòregisterProperty‚Äô on 'CSS‚Äô: An initial value must be provided if the syntax is not ‚Äò*‚Äô</em>". Also, initial value should match the type specified as syntax, in another case you will see an error ‚Äì "<em>DOMException: Failed to execute ‚ÄòregisterProperty‚Äô on 'CSS‚Äô: The initial value provided does not parse for the given syntax.</em>". For <code>*</code> syntax type <code>initialValue</code> is optional and could have any value:</p>
<pre class="language-js"><code class="language-js"><span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">registerProperty</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'--my-any-prop'</span><span class="token punctuation">,</span>
  syntax<span class="token punctuation">:</span> <span class="token string">'*'</span><span class="token punctuation">,</span>
  inherits<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  initialValue<span class="token punctuation">:</span> <span class="token string">'10px'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>CSS variables created without <code>registerProperty</code> have <code>initialValue</code> as well, it is empty by default. That means that if a property weren‚Äôt initialized, a fallback value would be used.</p>
<pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.element</span> </span><span class="token punctuation">{</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--theme-color, red<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The value of <code>background</code> will be red, as <code>--theme-color</code> wasn‚Äôt initialized and the initial value is empty. But if we will register our property:</p>
<pre class="language-js"><code class="language-js"><span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">registerProperty</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'--theme-color'</span><span class="token punctuation">,</span>
  syntax<span class="token punctuation">:</span> <span class="token string">'<color>'</color></span><span class="token punctuation">,</span>
  inherits<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  initialValue<span class="token punctuation">:</span> <span class="token string">'blue'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.element</span> </span><span class="token punctuation">{</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--theme-color, red<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The value of the <code>background</code> will be blue, as it specified as the initial value for <code>--theme-color</code> in property configuration.</p>
<p>The important thing here is that the <code>initial</code> keyword. Let me show the code:</p>
<pre class="language-js"><code class="language-js"><span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">registerProperty</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'--theme-color'</span><span class="token punctuation">,</span>
  syntax<span class="token punctuation">:</span> <span class="token string">'<color>'</color></span><span class="token punctuation">,</span>
  initialValue<span class="token punctuation">:</span> <span class="token string">'blue'</span><span class="token punctuation">,</span>
  inherits<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation"><</span>section</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>red-theme<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation"><</span>article</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>default-theme<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation"><!--</span-->article</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation"><!--</span-->section</span><span class="token punctuation">></span></span>
</span></span></code></pre>
<pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.red-theme</span> </span><span class="token punctuation">{</span>
  <span class="token property">--theme-color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--theme-color<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector"><span class="token class">.default-theme</span> </span><span class="token punctuation">{</span>
  <span class="token property">--theme-color</span><span class="token punctuation">:</span> initial<span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--theme-color<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>In this example element with class name, <code>default-theme</code> will inherit <code>--theme-color</code> property and then resets it to the initial value. So its background color will be blue.</p>
<h3>inherits</h3>
<p>Inherits is a boolean parameter, that obliviously stands for custom property inheritance from DOM tree. It is <code>false</code> by default and after the latest spec update is required. The reason for such default is performance, as browser don‚Äôt need to walk through DOM tree to define which nodes inherit properties. You need to set inheritance to <code>true</code> if you want the property to be inherited:</p>
<pre class="language-js"><code class="language-js"><span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">registerProperty</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'--my-col'</span><span class="token punctuation">,</span>
  syntax<span class="token punctuation">:</span> <span class="token string">'<color>'</color></span><span class="token punctuation">,</span>
  initialValue<span class="token punctuation">:</span> <span class="token string">'red'</span><span class="token punctuation">,</span>
  inherits<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation"><</span>ul</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation"><</span>li</span><span class="token punctuation">></span></span>item 1<span class="token tag"><span class="token tag"><span class="token punctuation"><!--</span-->li</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation"><</span>li</span><span class="token punctuation">></span></span>item 2<span class="token tag"><span class="token tag"><span class="token punctuation"><!--</span-->li</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation"><</span>li</span><span class="token punctuation">></span></span>item 3<span class="token tag"><span class="token tag"><span class="token punctuation"><!--</span-->li</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation"><!--</span-->ul</span><span class="token punctuation">></span></span>
</span></span></span></span></code></pre>
<pre class="language-css"><code class="language-css"><span class="token selector">ul </span><span class="token punctuation">{</span>
  <span class="token property">--my-col</span><span class="token punctuation">:</span> <span class="token hexcode">#ff00ff</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">li </span><span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--my-col, blue<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>In this example, we have a simple unordered list in HTML. Then we assign the value to <code>--my-col</code> property that accepts CSS colors. Next, we are using this property for list item text color value with fallback specified as well. Each of items will have <code>#ff00ff</code> text color because the property was inherited from <code>ul</code> element in the DOM tree.</p>
<p>Actually, CSS variable created in stylesheet only equals to the next registered custom property:</p>
<pre class="language-js"><code class="language-js"><span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">registerProperty</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'--my-var'</span><span class="token punctuation">,</span>
  syntax<span class="token punctuation">:</span> <span class="token string">'*'</span><span class="token punctuation">,</span>
  inherits<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2>Why we might need a type of custom properties?</h2>
<p>There are few cases when we want our custom properties to be strictly typed: value validation, and animations.</p>
<h3>CSS value validation</h3>
<p>This is the straightforward use case as if we expect CSS property to have an only valid type. If the type does not match value assignment for the property will be ignored and inherited/initial/fallback value will be used. Also, types could be used in JavaScript, in the main context or in some worklet, like CSS Paint.</p>
<pre class="language-js"><code class="language-js"><span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">registerProperty</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'--theme-color'</span><span class="token punctuation">,</span>
  syntax<span class="token punctuation">:</span> <span class="token string">'<color>'</color></span><span class="token punctuation">,</span>
  inherits<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  initialValue<span class="token punctuation">:</span> <span class="token string">'blue'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.dark-theme-section</span> </span><span class="token punctuation">{</span>
  <span class="token property">--theme-color</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>We declared <code>--theme-color</code> property that accepts only CSS color as a value. Then in our stylesheet we assigned <code>1</code> as the value for that property. As <code>1</code> is not valid color value, the property will use initial value. Let‚Äôs we try to get the value in JavaScript:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> section <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.dark-theme-section'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> styles <span class="token operator">=</span> <span class="token function">getComputedStyle</span><span class="token punctuation">(</span>section<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> themeColor <span class="token operator">=</span> styles<span class="token punctuation">.</span><span class="token function">getPropertyValue</span><span class="token punctuation">(</span><span class="token string">'--theme-color'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>themeColor<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "blue"</span>


<span class="token keyword">const</span> styleMap <span class="token operator">=</span> section<span class="token punctuation">.</span><span class="token function">computedStyleMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> typedValue <span class="token operator">=</span> styleMap<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'--theme-color'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>typedValue<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// CSSKeywordValue {value: "blue"}</span>
</code></pre>
<p>We can access our property value in JS, and the only valid one will be used.</p>
<h3>Animations</h3>
<p>If we try to animate CSS variables in styles with <code>transition</code> or <code>animation</code> it won‚Äôt work, the value will be changed at 50% timeframe point without any smooth interpolation.</p>
<pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.no-smoosh</span> </span><span class="token punctuation">{</span>
  <span class="token property">--bg-color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--bg-color<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">transition</span><span class="token punctuation">:</span> --bg-color <span class="token number">.3</span>s linear<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector"><span class="token class">.no-smoosh</span><span class="token pseudo-class">:hover</span> </span><span class="token punctuation">{</span>
  <span class="token property">--bg-color</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>This happens because for browsers custom property without the type is just string and it has no idea how to interpolate one string into another. But browser already has the internal functionality to interpolate built-in CSS value of different types, like length, percentage, color, etc. So to make custom property soothly animated, we need to tell the browser what type to expect for particular custom property:</p>
<pre class="language-js"><code class="language-js"><span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">registerProperty</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'--bg-color'</span><span class="token punctuation">,</span>
  syntax<span class="token punctuation">:</span> <span class="token string">'<color>'</color></span><span class="token punctuation">,</span>
  inherits<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  initialValue<span class="token punctuation">:</span> <span class="token string">'red'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.smoosh</span> </span><span class="token punctuation">{</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--bg-color<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">transition</span><span class="token punctuation">:</span> --bg-color <span class="token number">.3</span>s linear<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector"><span class="token class">.smoosh</span><span class="token pseudo-class">:hover</span> </span><span class="token punctuation">{</span>
  <span class="token property">--bg-color</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>In this case, the <code>background</code> will be smoothly changed from red to blue.</p>
<h2>What types are available?</h2>
<p>Unfortunately, not all CSS types available for custom property syntax in the current spec version. For now, it is limited to the next list:</p>
<ul><li><code>length</code></li>
<li><code>number</code></li>
<li><code>percentage</code></li>
<li><code>length-percentage</code></li>
<li><code>color</code></li>
<li><code>image</code></li>
<li><code>url</code></li>
<li><code>integer</code></li>
<li><code>angle</code></li>
<li><code>time</code></li>
<li><code>resolution</code></li>
<li><code>transform-list</code></li>
<li><code>transform-function</code></li>
<li><code>custom-ident</code></li>
</ul>
<p>There are interfaces for <code><url></url></code> and <code><img></code> in Blink core, but they still in development. That is why it is impossible to test them now. And it seems that specification for this types usage could be slightly changed in the future.</p>
<p>All of this types could be used as input arguments in Houdini worklets, for example, the CSS Paint API.</p>
<h2>Conclusion</h2>
<p>Houdini ‚ÄúCustom Properties and Values‚Äù is the very powerful specification that opens a vast field for experiments. Working on this post, I realized that topic and amount of info and ideas I want to share is too big. That is why I decided to split it at least into two parts. In the next part of the article, I will make the in-depth overview of each available type. Check out the <a href="https://bobrov.dev/blog/css-custom-properties-in-depth-part-2/">second part</a>! Hope you enjoyed our journey to the deep of the spec üòä! Read & share! See you in the future üë®‚Äç‚öïÔ∏èüë≤üöô.</p>
<script defer src="https://cdn.commento.io/js/commento.js" data-css-override="https://bobrov.dev/css/commento.css"></script></body></html>