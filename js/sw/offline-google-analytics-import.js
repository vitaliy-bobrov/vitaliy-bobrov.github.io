"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e.goog=e.goog||{},e.goog.offlineGoogleAnalytics=t())}(void 0,function(){function e(e,t){return t={exports:{}},e(t,t.exports),t.exports}var t={CACHE_NAME:"offline-google-analytics",IDB:{NAME:"offline-google-analytics",STORE:"urls",VERSION:1},MAX_ANALYTICS_BATCH_SIZE:20,STOP_RETRYING_AFTER:1728e5,URL:{ANALYTICS_JS_PATH:"/analytics.js",COLLECT_PATH:"/collect",HOST:"www.google-analytics.com"}},n=e(function(e){!function(){function t(e){return Array.prototype.slice.call(e)}function n(e){return new Promise(function(t,n){e.onsuccess=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function o(e,t,o){var r,i=new Promise(function(i,u){r=e[t].apply(e,o),n(r).then(i,u)});return i.request=r,i}function r(e,t,n){var r=o(e,t,n);return r.then(function(e){if(e)return new f(e,r.request)})}function i(e,t,n){n.forEach(function(n){Object.defineProperty(e.prototype,n,{get:function(){return this[t][n]},set:function(e){this[t][n]=e}})})}function u(e,t,n,r){r.forEach(function(r){r in n.prototype&&(e.prototype[r]=function(){return o(this[t],r,arguments)})})}function c(e,t,n,o){o.forEach(function(o){o in n.prototype&&(e.prototype[o]=function(){return this[t][o].apply(this[t],arguments)})})}function s(e,t,n,o){o.forEach(function(o){o in n.prototype&&(e.prototype[o]=function(){return r(this[t],o,arguments)})})}function a(e){this._index=e}function f(e,t){this._cursor=e,this._request=t}function l(e){this._store=e}function h(e){this._tx=e,this.complete=new Promise(function(t,n){e.oncomplete=function(){t()},e.onerror=function(){n(e.error)},e.onabort=function(){n(e.error)}})}function p(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new h(n)}function _(e){this._db=e}i(a,"_index",["name","keyPath","multiEntry","unique"]),u(a,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),s(a,"_index",IDBIndex,["openCursor","openKeyCursor"]),i(f,"_cursor",["direction","key","primaryKey","value"]),u(f,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(e){e in IDBCursor.prototype&&(f.prototype[e]=function(){var t=this,o=arguments;return Promise.resolve().then(function(){return t._cursor[e].apply(t._cursor,o),n(t._request).then(function(e){if(e)return new f(e,t._request)})})})}),l.prototype.createIndex=function(){return new a(this._store.createIndex.apply(this._store,arguments))},l.prototype.index=function(){return new a(this._store.index.apply(this._store,arguments))},i(l,"_store",["name","keyPath","indexNames","autoIncrement"]),u(l,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),s(l,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),c(l,"_store",IDBObjectStore,["deleteIndex"]),h.prototype.objectStore=function(){return new l(this._tx.objectStore.apply(this._tx,arguments))},i(h,"_tx",["objectStoreNames","mode"]),c(h,"_tx",IDBTransaction,["abort"]),p.prototype.createObjectStore=function(){return new l(this._db.createObjectStore.apply(this._db,arguments))},i(p,"_db",["name","version","objectStoreNames"]),c(p,"_db",IDBDatabase,["deleteObjectStore","close"]),_.prototype.transaction=function(){return new h(this._db.transaction.apply(this._db,arguments))},i(_,"_db",["name","version","objectStoreNames"]),c(_,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(e){[l,a].forEach(function(n){n.prototype[e.replace("open","iterate")]=function(){var n=t(arguments),o=n[n.length-1],r=this._store||this._index,i=r[e].apply(r,n.slice(0,-1));i.onsuccess=function(){o(i.result)}}})}),[a,l].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,t){var n=this,o=[];return new Promise(function(r){n.iterateCursor(e,function(e){return e?(o.push(e.value),void 0!==t&&o.length==t?void r(o):void e.continue()):void r(o)})})})});var d={open:function(e,t,n){var r=o(indexedDB,"open",[e,t]),i=r.request;return i.onupgradeneeded=function(e){n&&n(new p(i.result,e.oldVersion,i.transaction))},r.then(function(e){return new _(e)})},delete:function(e){return o(indexedDB,"deleteDatabase",[e])}};e.exports=d}()}),o=function(){function e(t,n,o){if(_classCallCheck(this,e),void 0==t||void 0==n||void 0==o)throw Error("name, version, storeName must be passed to the constructor.");this._name=t,this._version=n,this._storeName=o}return _createClass(e,[{key:"_getDb",value:function(){var e=this;return this._dbPromise?this._dbPromise:(this._dbPromise=n.open(this._name,this._version,function(t){t.createObjectStore(e._storeName)}).then(function(e){return e}),this._dbPromise)}},{key:"close",value:function(){var e=this;if(this._dbPromise)return this._dbPromise.then(function(t){t.close(),e._dbPromise=null})}},{key:"put",value:function(e,t){var n=this;return this._getDb().then(function(o){var r=o.transaction(n._storeName,"readwrite"),i=r.objectStore(n._storeName);return i.put(t,e),r.complete})}},{key:"delete",value:function(e){var t=this;return this._getDb().then(function(n){var o=n.transaction(t._storeName,"readwrite"),r=o.objectStore(t._storeName);return r.delete(e),o.complete})}},{key:"get",value:function(e){var t=this;return this._getDb().then(function(n){return n.transaction(t._storeName).objectStore(t._storeName).get(e)})}},{key:"getAllValues",value:function(){var e=this;return this._getDb().then(function(t){return t.transaction(e._storeName).objectStore(e._storeName).getAll()})}},{key:"getAllKeys",value:function(){var e=this;return this._getDb().then(function(t){return t.transaction(e._storeName).objectStore(e._storeName).getAllKeys()})}}]),e}(),r=new o(t.IDB.NAME,t.IDB.VERSION,t.IDB.STORE),i=function(e,t){var n=new URL(e.url);return e.text().then(function(e){return e&&(n.search=e),r.put(n.toString(),t||Date.now())})},u=function(){return self&&self.goog&&self.goog.DEBUG?console.debug.bind(console):function(){}},c=new o(t.IDB.NAME,t.IDB.VERSION,t.IDB.STORE),s=function(e){return e=e||{},c.getAllKeys().then(function(n){return Promise.all(n.map(function(n){return c.get(n).then(function(o){var r=Date.now()-o,i=new URL(n);if(!(r>t.STOP_RETRYING_AFTER)&&"searchParams"in i){var u=e.parameterOverrides||{};u.qt=r,Object.keys(u).sort().forEach(function(e){i.searchParams.set(e,u[e])});var c=e.hitFilter;if("function"==typeof c)try{c(i.searchParams)}catch(e){return}return fetch(i.toString())}}).then(function(){return c.delete(n)})}))})},a=function(e){e=e||{};var n=!1;self.addEventListener("fetch",function(o){var r=new URL(o.request.url),c=o.request;if(r.hostname===t.URL.HOST)if(r.pathname===t.URL.COLLECT_PATH){var a=c.clone();o.respondWith(fetch(c).then(function(t){return n&&s(e),n=!1,t},function(e){return u("Enqueuing failed request..."),n=!0,i(a).then(function(){return Response.error()})}))}else r.pathname===t.URL.ANALYTICS_JS_PATH&&o.respondWith(caches.open(t.CACHE_NAME).then(function(e){return fetch(c).then(function(t){return e.put(c,t.clone()).then(function(){return t})}).catch(function(t){return u(t),e.match(c)})}))}),s(e)},f={initialize:a};return f});